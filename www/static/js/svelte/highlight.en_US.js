!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/highlight",t):e.highlight=t()}(this,function(){"use strict";function e(){}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t){t.appendChild(e)}function i(e,t,n){t.insertBefore(e,n)}function s(e){e.parentNode.removeChild(e)}function r(e){for(var t=0;t<e.length;t+=1)e[t]&&e[t].d()}function o(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function a(e,t,n){e.addEventListener(t,n,!1)}function l(e,t,n){e.removeEventListener(t,n,!1)}function c(e,t,n){e.style.setProperty(t,n)}function u(e,t){for(var n=0;n<e.options.length;n+=1){var i=e.options[n];if(i.__value===t)return void(i.selected=!0)}}function d(){return Object.create(null)}function f(t){this.destroy=e,this.fire("destroy"),this.set=this.get=e,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function g(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function v(e,t){return e!=e?t==t:e!==t}function p(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var i=0;i<n.length;i+=1){var s=n[i];s.__calling||(s.__calling=!0,s.call(this,t),s.__calling=!1)}}function m(e){return e?this._state[e]:this._state}function y(e,t,n){var i=t.bind(this);return n&&!1===n.init||i(this.get()[e],void 0),this.on(n&&n.defer?"update":"state",function(t){t.changed[e]&&i(t.current[e],t.previous&&t.previous[e])})}function b(e,t){if("teardown"===e)return this.on("destroy",t);var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}}function x(e){for(;e&&e.length;)e.shift()()}function k(){this.store._remove(this)}var E={destroy:f,get:m,fire:p,observe:y,on:b,set:function(e){this._set(t({},e)),this.root._lock||(this.root._lock=!0,x(this.root._beforecreate),x(this.root._oncreate),x(this.root._aftercreate),this.root._lock=!1)},teardown:f,_recompute:e,_set:function(e){var n=this._state,i={},s=!1;for(var r in e)this._differs(e[r],n[r])&&(i[r]=s=!0);s&&(this._state=t(t({},n),e),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(this.fire("state",{changed:i,current:this._state,previous:n}),this._fragment.p(i,this._state),this.fire("update",{changed:i,current:this._state,previous:n})))},_mount:function(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:g};var w={add:function(e){var t=this,n=this.get().highlighted;n.indexOf(e)<0&&n.push(e),this.set({highlighted:n}),setTimeout(function(){return t.set({selected:"---"})},30)},remove:function(e){var t=this.get().highlighted;t.splice(t.indexOf(e),1),this.set({highlighted:t})}};function N(e){return JSON.parse(JSON.stringify(e))}function C(t,r){var a,l,c,u=r.element,d=(r.each_value,r.element_index,u.label);return{c:function(){a=o("option"),l=h(d),this.h()},h:function(){a.__value=c=u.key,a.value=a.__value},m:function(e,t){i(a,e,t),n(l,a)},p:function(e,t){u=t.element,t.each_value,t.element_index,e.elements&&d!==(d=u.label)&&(l.data=d),e.elements&&c!==(c=u.key)&&(a.__value=c),a.value=a.__value},u:function(){s(a)},d:e}}function O(e,t){var r,c,u,d,f,_,g,v=t.el,p=(t.each_value_1,t.el_index,v.key);return{c:function(){r=o("span"),c=o("i"),u=h(" "),d=h(p),g=h(" Â "),this.h()},h:function(){a(c,"click",S),c.className="fa fa-remove",c._svelte={component:e,each_value_1:t.each_value_1,el_index:t.el_index},r.dataset.series=f=v.key,r.className=_="badge "+(v.valid?"badge-info":"")},m:function(e,t){i(r,e,t),n(c,r),n(u,r),n(d,r),i(g,e,t)},p:function(e,t){v=t.el,t.each_value_1,t.el_index,c._svelte.each_value_1=t.each_value_1,c._svelte.el_index=t.el_index,e.highlightedElements&&p!==(p=v.key)&&(d.data=p),e.highlightedElements&&f!==(f=v.key)&&(r.dataset.series=f),e.highlightedElements&&_!==(_="badge "+(v.valid?"badge-info":""))&&(r.className=_)},u:function(){s(r),s(g)},d:function(){l(c,"click",S)}}}function S(e){var t=this._svelte.component,n=this._svelte.each_value_1[this._svelte.el_index];t.remove(n.key)}function P(e){!function(e,t){e._handlers=d(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}(this,e),this._state=t(t(this.store._init(["vis"]),{selected:"---",highlighted:[]}),e.data),this.store._add(this,["vis"]),this._recompute({$vis:1,highlighted:1,elements:1},this._state),this._handlers.destroy=[k];var f=this;e.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(e,d){for(var f,_,g,v,p,m,y,b,x,k,E,w,N=!1,S=d.elements,P=[],L=0;L<S.length;L+=1)P[L]=C(0,t(t({},d),{each_value:S,element:S[L],element_index:L}));function $(){N=!0,e.set({selected:function(e){var t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(p)}),N=!1}var T=d.highlightedElements,j=[];for(L=0;L<T.length;L+=1)j[L]=O(e,t(t({},d),{each_value_1:T,el:T[L],el_index:L}));return{c:function(){f=o("div"),_=o("label"),g=h("\n    "),v=o("div"),p=o("select"),m=o("option"),y=h("- "),b=o("noscript"),x=o("noscript"),k=h(" -");for(var e=0;e<P.length;e+=1)P[e].c();for(E=h("\n    "),w=o("p"),e=0;e<j.length;e+=1)j[e].c();this.h()},h:function(){_.className="separator",m.__value="---",m.value=m.__value,a(p,"change",$),"selected"in d||e.root._beforecreate.push($),p.id="highlight-series",p.className="span2",w.className="highlighted-series",c(w,"margin-top","5px"),f.className="story-highlight control-group",c(f,"clear","both")},m:function(e,t){i(f,e,t),n(_,f),_.innerHTML="Highlight the most import elements (optional)",n(g,f),n(v,f),n(p,v),n(m,p),n(y,m),n(b,m),b.insertAdjacentHTML("afterend","select element"),n(x,m),n(k,m);for(var s=0;s<P.length;s+=1)P[s].m(p,null);for(u(p,d.selected),n(E,f),n(w,f),s=0;s<j.length;s+=1)j[s].m(w,null)},p:function(n,i){var s=i.elements;if(n.elements){for(var r=0;r<s.length;r+=1){var o=t(t({},i),{each_value:s,element:s[r],element_index:r});P[r]?P[r].p(n,o):(P[r]=C(0,o),P[r].c(),P[r].m(p,null))}for(;r<P.length;r+=1)P[r].u(),P[r].d();P.length=s.length}N||u(p,i.selected);var h=i.highlightedElements;if(n.highlightedElements){for(r=0;r<h.length;r+=1){var a=t(t({},i),{each_value_1:h,el:h[r],el_index:r});j[r]?j[r].p(n,a):(j[r]=O(e,a),j[r].c(),j[r].m(w,null))}for(;r<j.length;r+=1)j[r].u(),j[r].d();j.length=h.length}},u:function(){_.innerHTML="",function(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}(b,x),s(f);for(var e=0;e<P.length;e+=1)P[e].u();for(e=0;e<j.length;e+=1)j[e].u()},d:function(){r(P),l(p,"change",$),r(j)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var e=this;this.store.observe("vis",function(t){t&&(e.set({highlighted:N(t.get("highlighted-series"))}),t.chart().onChange(function(n,i){"metadata.visualize.highlighted-series"==i&&e.set({highlighted:N(t.get("highlighted-series"))})}))}),this.observe("highlighted",function(t){var n=e.store.get().vis;n&&JSON.stringify(n.get("highlighted-series"))!=JSON.stringify(t)&&n&&n.chart().set("metadata.visualize.highlighted-series",N(t))}),this.observe("selected",function(t){t&&"---"!=t&&e.add(t)})}).call(f),f.fire("update",{changed:{highlighted:1,elements:1,$vis:1,selected:1,highlightedElements:1},current:f._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),x(this._beforecreate),x(this._oncreate))}function L(e,n){this._observers={pre:d(),post:d()},this._handlers={},this._dependents=[],this._computed=d(),this._sortedComputedProperties=[],this._state=t({},e),this._differs=n&&n.immutable?v:g}t(P.prototype,E),t(P.prototype,w),P.prototype._recompute=function(e,t){var n;e.$vis&&this._differs(t.elements,t.elements=(n=t.$vis)?n.keys().sort().map(function(e){var t=n.keyLabel(e);return{key:e,label:e+(e!=t?" ("+t+")":"")}}):[])&&(e.elements=!0),(e.highlighted||e.elements)&&this._differs(t.highlightedElements,t.highlightedElements=function(e){var t=e.highlighted,n=e.elements,i=_.indexBy(n,"key");return t.map(function(e){return{key:e,valid:i[e]}})}(t))&&(e.highlightedElements=!0)},t(L.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},n=0;n<e.length;n+=1){var i=e[n];t["$"+i]=this._state[i]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,n=this._sortedComputedProperties=[],i=d();function s(r){if(e[r])throw new Error("Cyclical dependency detected");if(!i[r]){i[r]=!0;var o=t[r];o&&(e[r]=!0,o.deps.forEach(s),n.push(o))}}for(var r in this._computed)e=d(),s(r)},compute:function(e,t,n){var i,s=this,r={deps:t,update:function(r,o,h){var a=t.map(function(e){return e in o&&(h=!0),r[e]});if(h){var l=n.apply(null,a);s._differs(l,i)&&(i=l,o[e]=!0,r[e]=i)}}};r.update(this._state,{},!0),this._computed[e]=r,this._sortComputedProperties()},fire:p,get:m,observe:y,on:b,onchange:function(e){return console.warn("store.onchange is deprecated in favour of store.on('state', event => {...})"),this.on("state",function(t){e(t.current,t.changed)})},set:function(e){var n=this._state,i=this._changed={},s=!1;for(var r in e){if(this._computed[r])throw new Error("'"+r+"' is a read-only property");this._differs(e[r],n[r])&&(i[r]=s=!0)}if(s){this._state=t(t({},n),e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,i);this.fire("state",{changed:i,current:this._state,previous:n});var h=this._dependents.slice();for(o=0;o<h.length;o+=1){var a=h[o],l={};s=!1;for(var c=0;c<a.props.length;c+=1){var u=a.props[c];u in i&&(l["$"+u]=this._state[u],s=!0)}s&&a.component.set(l)}this.fire("update",{changed:i,current:this._state,previous:n})}}});return{App:P,store:new L({}),data:{chart:{id:""}},init:function(e){window.dw.backend.on("dataset-loaded",function(){e.store.set({dataset:chart.dataset()})}).on("theme-changed-and-loaded",function(){e.store.set({theme:window.dw.theme(chart.get("theme"))})}).on("backend-vis-loaded",function(t){e.store.set({vis:t})})}}});
