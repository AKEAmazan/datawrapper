!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Handsontable")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable"],t):e.describe=t(e.HOT)}(this,function(e){"use strict";function t(){}function s(e){for(var t,s,n=arguments,r=1,a=arguments.length;r<a;r++)for(t in s=n[r])e[t]=s[t];return e}function n(e,t){t.appendChild(e)}function r(e,t,s){t.insertBefore(e,s)}function a(e){e.parentNode.removeChild(e)}function o(e){return document.createElement(e)}function i(e){return document.createTextNode(e)}function c(e,t,s){e.addEventListener(t,s,!1)}function h(e,t,s){e.removeEventListener(t,s,!1)}function u(e,t,s){e.style.setProperty(t,s)}function l(){return Object.create(null)}function d(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function f(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,s,n,r){for(var a in t)if(s[a]){var o=n[a],i=r[a],c=t[a];if(c)for(var h=0;h<c.length;h+=1){var u=c[h];u.__calling||(u.__calling=!0,u.call(e,o,i),u.__calling=!1)}}}function v(e){return e?this._state[e]:this._state}function _(e,t){e._observers={pre:l(),post:l()},e._handlers=l(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function m(e,t,s){var n=s&&s.defer?this._observers.post:this._observers.pre;return(n[e]||(n[e]=[])).push(t),s&&!1===s.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var s=n[e].indexOf(t);~s&&n[e].splice(s,1)}}}function g(e){for(;e&&e.length;)e.pop()()}e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:d,get:v,fire:function(e,t){var s=e in this._handlers&&this._handlers[e].slice();if(s)for(var n=0;n<s.length;n+=1)s[n].call(this,t)},observe:m,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var s=this._handlers[e]||(this._handlers[e]=[]);return s.push(t),{cancel:function(){var e=s.indexOf(t);~e&&s.splice(e,1)}}},set:function(e){this._set(s({},e)),this.root._lock||(this.root._lock=!0,g(this.root._beforecreate),g(this.root._oncreate),g(this.root._aftercreate),this.root._lock=!1)},teardown:d,_recompute:t,_set:function(e){var t=this._state,n={},r=!1;for(var a in e)f(e[a],t[a])&&(n[a]=r=!0);r&&(this._state=s({},t,e),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(p(this,this._observers.pre,n,this._state,t),this._fragment.p(n,this._state),p(this,this._observers.post,n,this._state,t)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var w={update:function(){var t=this,s=this.get(),n=s.data,r=s.transpose,a=s.firstRowIsHeader,o=s.skipRows,i=s.hot;if(n){var c=this.store.get("dw_chart"),h=c.dataset(dw.datasource.delimited({csv:n,transpose:r,firstRowIsHeader:a,skipRows:o}).parse()).dataset();this.set({columnOrder:h.columnOrder()});var u=[[]];h.eachColumn(function(e){return u[0].push(e.title())}),h.eachRow(function(e){var t=[];h.eachColumn(function(s){return t.push(s.raw(e))}),u.push(t)}),i.loadData(u),i.updateSettings({cells:function(s,n){return{readOnly:t.get().readonly||h.numColumns()>n&&h.column(n).isComputed&&0===s,renderer:b(t,h,e,{})}},manualColumnMove:[]}),this.set({has_changes:c.get("metadata.data.changes",[]).length>0}),i.render()}}};function b(e,t,s,n){var r={date:"fa fa-clock-o"};return function(n,a,o,i,c,h,u){if(!(t.numColumns()<=i)){var l=t.column(i),d=e.get(),f=d.searchResults,p=d.currentResult;if((o=n.toPhysicalRow(o))>0)h=chart.columnFormatter(l)(l.val(o-1),!0);parseInt(h)<0&&a.classList.add("negative"),a.classList.add(l.type()+"Type"),"text"==l.type()&&h.length>70&&(h=h.substr(0,60)+"…"),0===o?(a.classList.add("firstRow"),r[l.type()]&&(h='<i class="'+r[l.type()]+'"></i> '+h)):a.classList.add(o%2?"oddRow":"evenRow"),f.forEach(function(e){e.row==o&&e.col==i&&a.classList.add("htSearchResult")}),p&&p.row==o&&p.col==i&&a.classList.add("htCurrentSearchResult"),o>0&&!l.type(!0).isValid(l.val(o-1))&&a.classList.add("parsingError"),u.readOnly&&a.classList.add("readOnly"),chart.dataCellChanged(i,o)&&a.classList.add("changed"),function(e,t,n,r,a,o,i){var c=dw.utils.purifyHtml(s.helper.stringify(o));t.innerHTML=c}(0,a,0,0,0,h)}}}function I(n){_(this,n),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,search:"",searchResults:[]},n.data),this._recompute({searchResults:1,searchIndex:1},this._state);var i,c,h=function(){var t=this,s=new e(this.refs.hot,{data:[],rowHeaders:function(e){return s.getPlugin("ColumnSorting").translateRow(e)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0},columnSorting:!0,sortIndicator:!0,sortFunction:function(e,t){return function(n,r){var a,o=s.getPlugin("columnSorting");if(0===n[0])return-1;switch(t.type){case"date":a=o.dateSort;break;case"numeric":a=o.numericSort;break;default:a=o.defaultSort}return a(e,t)(n,r)}},search:"search"});window.HT=s,this.set({hot:s}),e.hooks.add("afterSetDataAtCell",function(e){var n=!1;e.forEach(function(e){var r=e[0],a=e[1],o=e[2],i=e[3];if(o!=i){var c=t.store.get("dw_chart"),h=t.get().transpose,u=c.get("metadata.data.changes");if(r=s.toPhysicalRow(r),h){var l=r;r=a,a=l}u.push({row:r,column:a,value:i,time:(new Date).getTime()}),c.set("metadata.data.changes",u),n=!0}}),n&&setTimeout(function(){t.update(),chart.save()},100)}),e.hooks.add("afterColumnMove",function(n,r){if(n.length){var a=t.get().columnOrder,o=a.slice(0),i=a[r],c=o.splice(n[0],n.length),h=i?o.indexOf(i):o.length;o.splice.apply(o,[h,0].concat(c)),t.store.get("dw_chart").set("metadata.data.column-order",o.slice(0)),t.set({columnOrder:o}),e.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,h,s.countRows()-1,h+c.length-1)},10)}),t.update()}}),e.hooks.add("afterRender",function(){var e=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;t.refs.hot.style.height=Math.min(400,e+10)+"px"}),this.observe("data",function(){return t.update()}),this.observe("transpose",function(){return t.update()}),this.observe("firstRowIsHeader",function(){return t.update()}),this.observe("search",function(e){var n=s.search.query(e);t.set({searchResults:n}),s.render()}),this.observe("currentResult",function(e){e&&s&&(s.render(),s.scrollViewportTo(e.row,e.col),setTimeout(function(){s.scrollViewportTo(e.row,e.col)},100))})}.bind(this);n.root?this.root._oncreate.push(h):this._oncreate=[h],this._fragment=(this._state,i=this,{c:function(){c=o("div"),this.h()},h:function(){c.id="data-preview"},m:function(e,t){r(c,e,t),i.refs.hot=c},p:t,u:function(){a(c)},d:function(){i.refs.hot===c&&(i.refs.hot=null)}}),n.target&&(this._fragment.c(),this._fragment.m(n.target,n.anchor||null),g(this._oncreate))}function y(e){_(this,e),this._state=s({},e.data),this._fragment=function(e,t){var s,l,d,f,p;function v(){t.set({value:d.checked})}return{c:function(){s=o("div"),l=o("label"),d=o("input"),f=i(" "),p=i(e.label),this.h()},h:function(){c(d,"change",v),d.type="checkbox",l.className="checkbox",u(l,"text-align","left"),u(l,"width","100%"),u(l,"position","relative"),u(l,"left","0"),s.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,a){r(s,t,a),n(l,s),n(d,l),d.checked=e.value,n(f,l),n(p,l)},p:function(e,t){d.checked=t.value,e.label&&(p.data=t.label)},u:function(){a(s)},d:function(){h(d,"change",v)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null))}s(I.prototype,w,R),I.prototype._recompute=function(e,t){(e.searchResults||e.searchIndex)&&f(t.currentResult,t.currentResult=function(e,t){if(!e||!e.length)return null;var s=e.length;if(t<0||t>=s){for(;t<0;)t+=s;t>s&&(t%=s)}return e[t]}(t.searchResults,t.searchIndex))&&(e.currentResult=!0)},s(y.prototype,R);function x(e){!function(e,t,s){e.setAttribute(t,s)}(e,"svelte-1903720201","")}function H(e,t){var s,u,l,d;function f(e){t.nextResult(-1)}function p(e){t.nextResult(1)}return{c:function(){s=o("div"),(u=o("button")).innerHTML='<i class="fa fa-chevron-up"></i>',l=i("\n                      "),(d=o("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){x(u),u.className="btn",c(u,"click",f),x(d),d.className="btn",c(d,"click",p),s.className="btn-group"},m:function(e,t){r(s,e,t),n(u,s),n(l,s),n(d,s)},u:function(){a(s)},d:function(){h(u,"click",f),h(d,"click",p)}}}function k(e,s){var n,o,c,h,u,l,d,f=e.searchIndexSafe+1,p=e.searchResults.length;return{c:function(){n=i(f),o=i("\n                        "),c=i("von"),h=i("\n                        "),u=i(p),l=i("\n                        "),d=i("Treffern")},m:function(e,t){r(n,e,t),r(o,e,t),r(c,e,t),r(h,e,t),r(u,e,t),r(l,e,t),r(d,e,t)},p:function(e,t){e.searchIndexSafe&&f!==(f=t.searchIndexSafe+1)&&(n.data=f),e.searchResults&&p!==(p=t.searchResults.length)&&(u.data=p)},u:function(){a(n),a(o),a(c),a(h),a(u),a(l),a(d)},d:t}}function C(e,s){var n;return{c:function(){n=i("Keine Treffer")},m:function(e,t){r(n,e,t)},p:t,u:function(){a(n)},d:t}}function N(e,t){var s,n=S(e),i=n&&n(e,t);return{c:function(){s=o("div"),i&&i.c(),this.h()},h:function(){x(s),s.className="results"},m:function(e,t){r(s,e,t),i&&i.m(s,null)},p:function(e,r){n===(n=S(r))&&i?i.p(e,r):(i&&(i.u(),i.d()),(i=n&&n(r,t))&&i.c(),i&&i.m(s,null))},u:function(){a(s),i&&i.u()},d:function(){i&&i.d()}}}function S(e){return e.searchResults.length>0?k:e.search?C:null}function T(e){_(this,e),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,searchResults:[]},e.data),this._recompute({searchIndex:1,searchResults:1},this._state);var t=function(){var e=this;window.addEventListener("keypress",function(t){t.ctrlKey&&"f"==t.key&&(t.preventDefault(),e.refs.search!=window.document.activeElement?e.refs.search.focus():e.nextResult(1))});var t=function(t,s){e.observe(t,function(t){e.store.get("dw_chart").set("metadata."+s,t)})};t("transpose","data.transpose"),t("firstRowIsHeader","data.horizontal-header")}.bind(this);e.root?this.root._oncreate.push(t):(this._oncreate=[t],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){var u,l,d,f,p,v,_,m,g,R,w,b,k,C,S,T,D,L,E,O,P,M,z,Z,B,j,q,A,F,K,V,$,W,G,J,Q,U,X,Y,ee,te,se,ne={},re=!1,ae={},oe={label:"Erste Zeile als Beschriftung"};"firstRowIsHeader"in e&&(oe.value=e.firstRowIsHeader,ne.value=!0);var ie=new y({root:t.root,data:oe,_bind:function(e,n){t.get();var r={};!ne.value&&e.value&&(r.firstRowIsHeader=n.value),ne=s({},e),t._set(r),ne={}}});function ce(e){t.toggleTranspose()}function he(){re=!0,t.set({search:Z.value}),re=!1}function ue(e){t.keyPress(e)}t.root._beforecreate.push(function(){t.get();var e=ie.get(),s={};e&&(ne.value||(s.firstRowIsHeader=e.value),ne={value:!0},t._set(s),ne={})});var le=e.searchResults.length>0&&H(0,t),de=e.search&&N(e,t),fe={};"chartData"in e&&(fe.data=e.chartData,ae.data=!0),"transpose"in e&&(fe.transpose=e.transpose,ae.transpose=!0),"firstRowIsHeader"in e&&(fe.firstRowIsHeader=e.firstRowIsHeader,ae.firstRowIsHeader=!0),"search"in e&&(fe.search=e.search,ae.search=!0),"searchResults"in e&&(fe.searchResults=e.searchResults,ae.searchResults=!0),"searchIndex"in e&&(fe.searchIndex=e.searchIndex,ae.searchIndex=!0);var pe=new I({root:t.root,data:fe,_bind:function(e,n){t.get();var r={};!ae.data&&e.data&&(r.chartData=n.data),!ae.transpose&&e.transpose&&(r.transpose=n.transpose),!ae.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=n.firstRowIsHeader),!ae.search&&e.search&&(r.search=n.search),!ae.searchResults&&e.searchResults&&(r.searchResults=n.searchResults),!ae.searchIndex&&e.searchIndex&&(r.searchIndex=n.searchIndex),ae=s({},e),t._set(r),ae={}}});function ve(e){t.revertChanges()}return t.root._beforecreate.push(function(){t.get();var e=pe.get(),s={};e&&(ae.data||(s.chartData=e.data),ae.transpose||(s.transpose=e.transpose),ae.firstRowIsHeader||(s.firstRowIsHeader=e.firstRowIsHeader),ae.search||(s.search=e.search),ae.searchResults||(s.searchResults=e.searchResults),ae.searchIndex||(s.searchIndex=e.searchIndex),ae={data:!0,transpose:!0,firstRowIsHeader:!0,search:!0,searchResults:!0,searchIndex:!0},t._set(s),ae={})}),t.refs.hot=pe,{c:function(){u=o("div"),l=o("div"),d=o("div"),f=o("div"),p=o("h3"),v=i("Überprüfe dass die Daten richtig aussehen"),_=i("\n\n                "),m=o("p"),g=i("Interpretiert Datawrapper deine Daten korrekt? In der nebenstehenden Tabelle sollten Zahlenspalten in blau, Datums-Spalten in grün und Textspalten in schwarz angezeigt werden."),R=i("\n\n                "),ie._fragment.c(),w=i("\n\n                "),(b=o("div")).innerHTML='<a class="btn submit" href="upload"><i class="icon-chevron-left"></i> Zurück</a>\n                    <a href="visualize" class="submit btn btn-primary" id="describe-proceed">Weiter <i class="icon-chevron-right icon-white"></i></a>',k=i("\n        "),C=o("div"),S=o("button"),T=o("img"),D=i(" "),L=i("Zeilen und Spalten vertauschen (transponieren)"),E=i("\n\n            "),O=o("div"),P=o("i"),M=i("\n                "),z=o("div"),Z=o("input"),j=i("\n                    "),le&&le.c(),q=i("\n\n                "),de&&de.c(),A=i("\n\n            "),pe._fragment.c(),F=i("\n\n            "),K=o("div"),V=o("button"),$=o("i"),W=i(" "),G=i("Spalte hinzufügen"),J=i("..."),Q=i("\n\n                "),U=o("button"),X=o("i"),Y=i(" "),ee=i("Änderungen zurücksetzen"),te=i("..."),this.h()},h:function(){p.className="first",b.className="btn-group",f.className="sidebar",d.className="span4",x(C),x(S),x(T),T.src="/static/css/chart-editor/transpose.png",S.className="btn transpose",c(S,"click",ce),x(O),x(P),P.className="fa fa-search",x(Z),c(Z,"input",he),Z.type="text",Z.placeholder="Search data table",Z.className=B=e.searchResults.length>0?"with-results":"",c(Z,"keypress",ue),z.className="input-append",O.className="search-box pull-right",x(K),$.className="fa fa-calculator",V.className="btn computed-columns",x(U),X.className="fa fa-undo",U.className=se="btn "+(e.has_changes?"":"disabled"),U.id="reset-data-changes",c(U,"click",ve),K.className="buttons below-table pull-right",C.className="span8",l.className="row",u.className="chart-editor"},m:function(s,a){r(u,s,a),n(l,u),n(d,l),n(f,d),n(p,f),n(v,p),n(_,f),n(m,f),n(g,m),n(R,f),ie._mount(f,null),n(w,f),n(b,f),n(k,l),n(C,l),n(S,C),n(T,S),n(D,S),n(L,S),n(E,C),n(O,C),n(P,O),n(M,O),n(z,O),n(Z,z),t.refs.search=Z,Z.value=e.search,n(j,z),le&&le.m(z,null),n(q,O),de&&de.m(O,null),n(A,C),pe._mount(C,null),n(F,C),n(K,C),n(V,K),n($,V),n(W,V),n(G,V),n(J,V),n(Q,K),n(U,K),n(X,U),n(Y,U),n(ee,U),n(te,U)},p:function(e,s){var n={label:"Erste Zeile als Beschriftung"};!ne.value&&e.firstRowIsHeader&&(n.value=s.firstRowIsHeader,ne.value=!0),ie._set(n),ne={},re||(Z.value=s.search),e.searchResults&&B!==(B=s.searchResults.length>0?"with-results":"")&&(Z.className=B),s.searchResults.length>0?le||((le=H(0,t)).c(),le.m(z,null)):le&&(le.u(),le.d(),le=null),s.search?de?de.p(e,s):((de=N(s,t)).c(),de.m(O,null)):de&&(de.u(),de.d(),de=null);var r={};!ae.data&&e.chartData&&(r.data=s.chartData,ae.data=!0),!ae.transpose&&e.transpose&&(r.transpose=s.transpose,ae.transpose=!0),!ae.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=s.firstRowIsHeader,ae.firstRowIsHeader=!0),!ae.search&&e.search&&(r.search=s.search,ae.search=!0),!ae.searchResults&&e.searchResults&&(r.searchResults=s.searchResults,ae.searchResults=!0),!ae.searchIndex&&e.searchIndex&&(r.searchIndex=s.searchIndex,ae.searchIndex=!0),pe._set(r),ae={},e.has_changes&&se!==(se="btn "+(s.has_changes?"":"disabled"))&&(U.className=se)},u:function(){a(u),le&&le.u(),de&&de.u()},d:function(){ie.destroy(!1),h(S,"click",ce),h(Z,"input",he),h(Z,"keypress",ue),t.refs.search===Z&&(t.refs.search=null),le&&le.d(),de&&de.d(),pe.destroy(!1),t.refs.hot===pe&&(t.refs.hot=null),h(U,"click",ve)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,g(this._beforecreate),g(this._oncreate),g(this._aftercreate),this._lock=!1)}function D(e){this._observers={pre:l(),post:l()},this._changeHandlers=[],this._dependents=[],this._computed=l(),this._sortedComputedProperties=[],this._state=s({},e)}s(T.prototype,{nextResult:function(e){var t=this.get(),s=t.searchIndex,n=t.searchResults;(s+=e)<0&&(s+=n.length),s%=n.length,this.set({searchIndex:s})},keyPress:function(e){"F3"!=e.key&&"Enter"!=e.key||this.nextResult(e.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})},revertChanges:function(){var e=this.store.get("dw_chart");e.set("metadata.data.changes",[]),e.save(),this.refs.hot.update()}},R),T.prototype._recompute=function(e,t){var s,n;(e.searchIndex||e.searchResults)&&f(t.searchIndexSafe,t.searchIndexSafe=(s=t.searchIndex,n=t.searchResults,s<0&&(s+=n.length),s%=n.length))&&(e.searchIndexSafe=!0)},s(D.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},s=0;s<e.length;s+=1){var n=e[s];t["$"+n]=this._state[n]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,s=this._sortedComputedProperties=[],n=l();function r(a){if(e[a])throw new Error("Cyclical dependency detected");if(!n[a]){n[a]=!0;var o=t[a];o&&(e[a]=!0,o.deps.forEach(r),s.push(o))}}for(var a in this._computed)e=l(),r(a)},compute:function(e,t,s){var n,r={deps:t,update:function(r,a,o){var i=t.map(function(e){return e in a&&(o=!0),r[e]});if(o){var c=s.apply(null,i);f(c,n)&&(n=c,a[e]=!0,r[e]=n)}}};r.update(this._state,{},!0),this._computed[e]=r,this._sortComputedProperties()},get:v,observe:m,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var t=this._state,n=this._changed={},r=!1;for(var a in e){if(this._computed[a])throw new Error("'"+a+"' is a read-only property");f(e[a],t[a])&&(n[a]=r=!0)}if(r){this._state=s({},t,e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,n);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,n);p(this,this._observers.pre,n,this._state,t);var i=this._dependents.slice();for(o=0;o<i.length;o+=1){var c=i[o],h={};r=!1;for(var u=0;u<c.props.length;u+=1){var l=c.props[u];l in n&&(h["$"+l]=this._state[l],r=!0)}r&&c.component.set(h)}p(this,this._observers.post,n,this._state,t)}}});return{App:T,store:new D({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
