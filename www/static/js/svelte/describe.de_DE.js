!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Handsontable")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable"],t):e.describe=t(e.HOT)}(this,function(e){"use strict";function t(){}function s(e){for(var t,s,n=arguments,r=1,a=arguments.length;r<a;r++)for(t in s=n[r])e[t]=s[t];return e}function n(e,t){t.appendChild(e)}function r(e,t,s){t.insertBefore(e,s)}function a(e){e.parentNode.removeChild(e)}function i(e){return document.createElement(e)}function o(e){return document.createTextNode(e)}function c(e,t,s){e.addEventListener(t,s,!1)}function u(e,t,s){e.removeEventListener(t,s,!1)}function h(e,t,s){e.style.setProperty(t,s)}function l(){return Object.create(null)}function d(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function f(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,s,n,r){for(var a in t)if(s[a]){var i=n[a],o=r[a],c=t[a];if(c)for(var u=0;u<c.length;u+=1){var h=c[u];h.__calling||(h.__calling=!0,h.call(e,i,o),h.__calling=!1)}}}function v(e){return e?this._state[e]:this._state}function m(e,t){e._observers={pre:l(),post:l()},e._handlers=l(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function _(e,t,s){var n=s&&s.defer?this._observers.post:this._observers.pre;return(n[e]||(n[e]=[])).push(t),s&&!1===s.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var s=n[e].indexOf(t);~s&&n[e].splice(s,1)}}}function g(e){for(;e&&e.length;)e.pop()()}e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:d,get:v,fire:function(e,t){var s=e in this._handlers&&this._handlers[e].slice();if(s)for(var n=0;n<s.length;n+=1)s[n].call(this,t)},observe:_,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var s=this._handlers[e]||(this._handlers[e]=[]);return s.push(t),{cancel:function(){var e=s.indexOf(t);~e&&s.splice(e,1)}}},set:function(e){this._set(s({},e)),this.root._lock||(this.root._lock=!0,g(this.root._beforecreate),g(this.root._oncreate),g(this.root._aftercreate),this.root._lock=!1)},teardown:d,_recompute:t,_set:function(e){var t=this._state,n={},r=!1;for(var a in e)f(e[a],t[a])&&(n[a]=r=!0);r&&(this._state=s({},t,e),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(p(this,this._observers.pre,n,this._state,t),this._fragment.p(n,this._state),p(this,this._observers.post,n,this._state,t)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var w={update:function(){var t=this,s=this.get(),n=s.data,r=s.transpose,a=s.firstRowIsHeader,i=s.skipRows,o=s.hot;if(n){var c=this.store.get("dw_chart").dataset(dw.datasource.delimited({csv:n,transpose:r,firstRowIsHeader:a,skipRows:i}).parse()).dataset();this.set({columnOrder:c.columnOrder()});var u=[[]];c.eachColumn(function(e){return u[0].push(e.title())}),c.eachRow(function(e){var t=[];c.eachColumn(function(s){return t.push(s.raw(e))}),u.push(t)}),o.loadData(u),o.updateSettings({cells:function(s,n){return{readOnly:t.get().readonly||c.numColumns()>n&&c.column(n).isComputed&&0===s,renderer:b(t,c,e,{})}},manualColumnMove:[]}),document.querySelector(".htCore thead tr:first-child th:first-child div.relative").addEventListener("click",function(){console.log("CLICKEEDDDD!")}),o.render()}}};function b(e,t,s,n){var r={date:"fa fa-clock-o"};return function(n,a,i,o,c,u,h){if(!(t.numColumns()<=o)){var l=t.column(o),d=e.get(),f=d.searchResults,p=d.currentResult;if((i=n.toPhysicalRow(i))>0)u=chart.columnFormatter(l)(l.val(i-1),!0);parseInt(u)<0&&a.classList.add("negative"),a.classList.add(l.type()+"Type"),"text"==l.type()&&u.length>70&&(u=u.substr(0,60)+"…"),0===i?(a.classList.add("firstRow"),r[l.type()]&&(u='<i class="'+r[l.type()]+'"></i> '+u)):a.classList.add(i%2?"oddRow":"evenRow"),f.forEach(function(e){e.row==i&&e.col==o&&a.classList.add("htSearchResult")}),p&&p.row==i&&p.col==o&&a.classList.add("htCurrentSearchResult"),i>0&&!l.type(!0).isValid(l.val(i-1))&&a.classList.add("parsingError"),h.readOnly&&a.classList.add("readOnly"),chart.dataCellChanged(o,i)&&a.classList.add("changed"),function(e,t,n,r,a,i,o){var c=dw.utils.purifyHtml(s.helper.stringify(i));t.innerHTML=c}(0,a,0,0,0,u)}}}function I(n){m(this,n),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,search:"",searchResults:[]},n.data),this._recompute({searchResults:1,searchIndex:1},this._state);var o,c,u=function(){var t=this,s=new e(this.refs.hot,{data:[],rowHeaders:function(e){return s.getPlugin("ColumnSorting").translateRow(e)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0},columnSorting:!0,sortIndicator:!0,sortFunction:function(e,t){return function(n,r){var a,i=s.getPlugin("columnSorting");if(0===n[0])return-1;switch(t.type){case"date":a=i.dateSort;break;case"numeric":a=i.numericSort;break;default:a=i.defaultSort}return a(e,t)(n,r)}},search:"search"});window.HT=s,this.set({hot:s}),e.hooks.add("afterSetDataAtCell",function(e){var n=!1;e.forEach(function(e){var r=e[0],a=e[1],i=e[2],o=e[3];if(i!=o){var c=t.store.get("dw_chart"),u=t.get().transpose,h=c.get("metadata.data.changes");if(r=s.toPhysicalRow(r),u){var l=r;r=a,a=l}h.push({row:r,column:a,value:o,time:(new Date).getTime()}),c.set("metadata.data.changes",h),n=!0}}),n&&setTimeout(function(){t.update(),chart.save()},100)}),e.hooks.add("afterColumnMove",function(n,r){if(n.length){var a=t.get().columnOrder,i=a.slice(0),o=a[r],c=i.splice(n[0],n.length),u=o?i.indexOf(o):i.length;i.splice.apply(i,[u,0].concat(c)),t.store.get("dw_chart").set("metadata.data.column-order",i.slice(0)),t.set({columnOrder:i}),e.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,u,s.countRows()-1,u+c.length-1)},10)}),t.update()}}),e.hooks.add("afterRender",function(){var e=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;t.refs.hot.style.height=Math.min(400,e+10)+"px"}),this.observe("data",function(){return t.update()}),this.observe("transpose",function(){return t.update()}),this.observe("firstRowIsHeader",function(){return t.update()}),this.observe("search",function(e){var n=s.search.query(e);t.set({searchResults:n}),s.render()}),this.observe("currentResult",function(e){e&&s&&(s.render(),s.scrollViewportTo(e.row,e.col),setTimeout(function(){s.scrollViewportTo(e.row,e.col)},100))})}.bind(this);n.root?this.root._oncreate.push(u):this._oncreate=[u],this._fragment=(this._state,o=this,{c:function(){c=i("div"),this.h()},h:function(){c.id="data-preview"},m:function(e,t){r(c,e,t),o.refs.hot=c},p:t,u:function(){a(c)},d:function(){o.refs.hot===c&&(o.refs.hot=null)}}),n.target&&(this._fragment.c(),this._fragment.m(n.target,n.anchor||null),g(this._oncreate))}function y(e){m(this,e),this._state=s({},e.data),this._fragment=function(e,t){var s,l,d,f,p;function v(){t.set({value:d.checked})}return{c:function(){s=i("div"),l=i("label"),d=i("input"),f=o(" "),p=o(e.label),this.h()},h:function(){c(d,"change",v),d.type="checkbox",l.className="checkbox",h(l,"text-align","left"),h(l,"width","100%"),h(l,"position","relative"),h(l,"left","0"),s.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,a){r(s,t,a),n(l,s),n(d,l),d.checked=e.value,n(f,l),n(p,l)},p:function(e,t){d.checked=t.value,e.label&&(p.data=t.label)},u:function(){a(s)},d:function(){u(d,"change",v)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null))}s(I.prototype,w,R),I.prototype._recompute=function(e,t){(e.searchResults||e.searchIndex)&&f(t.currentResult,t.currentResult=function(e,t){if(!e||!e.length)return null;var s=e.length;if(t<0||t>=s){for(;t<0;)t+=s;t>s&&(t%=s)}return e[t]}(t.searchResults,t.searchIndex))&&(e.currentResult=!0)},s(y.prototype,R);function x(e){!function(e,t,s){e.setAttribute(t,s)}(e,"svelte-1903720201","")}function H(e,t){var s,h,l,d;function f(e){t.nextResult(-1)}function p(e){t.nextResult(1)}return{c:function(){s=i("div"),(h=i("button")).innerHTML='<i class="fa fa-chevron-up"></i>',l=o("\n                      "),(d=i("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){x(h),h.className="btn",c(h,"click",f),x(d),d.className="btn",c(d,"click",p),s.className="btn-group"},m:function(e,t){r(s,e,t),n(h,s),n(l,s),n(d,s)},u:function(){a(s)},d:function(){u(h,"click",f),u(d,"click",p)}}}function k(e,s){var n,i,c,u,h,l,d,f=e.searchIndexSafe+1,p=e.searchResults.length;return{c:function(){n=o(f),i=o("\n                        "),c=o("von"),u=o("\n                        "),h=o(p),l=o("\n                        "),d=o("Treffern")},m:function(e,t){r(n,e,t),r(i,e,t),r(c,e,t),r(u,e,t),r(h,e,t),r(l,e,t),r(d,e,t)},p:function(e,t){e.searchIndexSafe&&f!==(f=t.searchIndexSafe+1)&&(n.data=f),e.searchResults&&p!==(p=t.searchResults.length)&&(h.data=p)},u:function(){a(n),a(i),a(c),a(u),a(h),a(l),a(d)},d:t}}function C(e,s){var n;return{c:function(){n=o("Keine Treffer")},m:function(e,t){r(n,e,t)},p:t,u:function(){a(n)},d:t}}function N(e,t){var s,n=S(e),o=n&&n(e,t);return{c:function(){s=i("div"),o&&o.c(),this.h()},h:function(){x(s),s.className="results"},m:function(e,t){r(s,e,t),o&&o.m(s,null)},p:function(e,r){n===(n=S(r))&&o?o.p(e,r):(o&&(o.u(),o.d()),(o=n&&n(r,t))&&o.c(),o&&o.m(s,null))},u:function(){a(s),o&&o.u()},d:function(){o&&o.d()}}}function S(e){return e.searchResults.length>0?k:e.search?C:null}function T(e){m(this,e),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,searchResults:[]},e.data),this._recompute({searchIndex:1,searchResults:1},this._state);var t=function(){var e=this;window.addEventListener("keypress",function(t){t.ctrlKey&&"f"==t.key&&(t.preventDefault(),e.refs.search!=window.document.activeElement?e.refs.search.focus():e.nextResult(1))});var t=function(t,s){e.observe(t,function(t){e.store.get("dw_chart").set("metadata."+s,t)})};t("transpose","data.transpose"),t("firstRowIsHeader","data.horizontal-header")}.bind(this);e.root?this.root._oncreate.push(t):(this._oncreate=[t],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){var h,l,d,f,p,v,m,_,g,R,w,b,k,C,S,T,D,L,E,O,P,M,z,Z,q,B,K,j,A,F,V,$,W,G,J,Q,U,X,Y,ee,te,se={},ne=!1,re={},ae={label:"Erste Zeile als Beschriftung"};"firstRowIsHeader"in e&&(ae.value=e.firstRowIsHeader,se.value=!0);var ie=new y({root:t.root,data:ae,_bind:function(e,n){t.get();var r={};!se.value&&e.value&&(r.firstRowIsHeader=n.value),se=s({},e),t._set(r),se={}}});function oe(e){t.toggleTranspose()}function ce(){ne=!0,t.set({search:Z.value}),ne=!1}function ue(e){t.keyPress(e)}t.root._beforecreate.push(function(){t.get();var e=ie.get(),s={};e&&(se.value||(s.firstRowIsHeader=e.value),se={value:!0},t._set(s),se={})});var he=e.searchResults.length>0&&H(0,t),le=e.search&&N(e,t),de={};"chartData"in e&&(de.data=e.chartData,re.data=!0),"transpose"in e&&(de.transpose=e.transpose,re.transpose=!0),"firstRowIsHeader"in e&&(de.firstRowIsHeader=e.firstRowIsHeader,re.firstRowIsHeader=!0),"search"in e&&(de.search=e.search,re.search=!0),"searchResults"in e&&(de.searchResults=e.searchResults,re.searchResults=!0),"searchIndex"in e&&(de.searchIndex=e.searchIndex,re.searchIndex=!0);var fe=new I({root:t.root,data:de,_bind:function(e,n){t.get();var r={};!re.data&&e.data&&(r.chartData=n.data),!re.transpose&&e.transpose&&(r.transpose=n.transpose),!re.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=n.firstRowIsHeader),!re.search&&e.search&&(r.search=n.search),!re.searchResults&&e.searchResults&&(r.searchResults=n.searchResults),!re.searchIndex&&e.searchIndex&&(r.searchIndex=n.searchIndex),re=s({},e),t._set(r),re={}}});return t.root._beforecreate.push(function(){t.get();var e=fe.get(),s={};e&&(re.data||(s.chartData=e.data),re.transpose||(s.transpose=e.transpose),re.firstRowIsHeader||(s.firstRowIsHeader=e.firstRowIsHeader),re.search||(s.search=e.search),re.searchResults||(s.searchResults=e.searchResults),re.searchIndex||(s.searchIndex=e.searchIndex),re={data:!0,transpose:!0,firstRowIsHeader:!0,search:!0,searchResults:!0,searchIndex:!0},t._set(s),re={})}),{c:function(){h=i("div"),l=i("div"),d=i("div"),f=i("div"),p=i("h3"),v=o("Überprüfe dass die Daten richtig aussehen"),m=o("\n\n                "),_=i("p"),g=o("Interpretiert Datawrapper deine Daten korrekt? In der nebenstehenden Tabelle sollten Zahlenspalten in blau, Datums-Spalten in grün und Textspalten in schwarz angezeigt werden."),R=o("\n\n                "),ie._fragment.c(),w=o("\n\n                "),(b=i("div")).innerHTML='<a class="btn submit" href="upload"><i class="icon-chevron-left"></i> Zurück</a>\n                    <a href="visualize" class="submit btn btn-primary" id="describe-proceed">Weiter <i class="icon-chevron-right icon-white"></i></a>',k=o("\n        "),C=i("div"),S=i("button"),T=i("img"),D=o(" "),L=o("Zeilen und Spalten vertauschen (transponieren)"),E=o("\n\n            "),O=i("div"),P=i("i"),M=o("\n                "),z=i("div"),Z=i("input"),B=o("\n                    "),he&&he.c(),K=o("\n\n                "),le&&le.c(),j=o("\n\n            "),fe._fragment.c(),A=o("\n\n            "),F=i("div"),V=i("button"),$=i("i"),W=o(" "),G=o("Spalte hinzufügen"),J=o("..."),Q=o("\n\n                "),U=i("button"),X=i("i"),Y=o(" "),ee=o("Änderungen zurücksetzen"),te=o("..."),this.h()},h:function(){p.className="first",b.className="btn-group",f.className="sidebar",d.className="span4",x(C),x(S),x(T),T.src="/static/css/chart-editor/transpose.png",S.className="btn transpose",c(S,"click",oe),x(O),x(P),P.className="fa fa-search",x(Z),c(Z,"input",ce),Z.type="text",Z.placeholder="Search data table",Z.className=q=e.searchResults.length>0?"with-results":"",c(Z,"keypress",ue),z.className="input-append",O.className="search-box pull-right",x(F),$.className="fa fa-calculator",V.className="btn computed-columns",X.className="fa fa-undo",U.className="btn disabled",U.id="reset-data-changes",F.className="buttons below-table pull-right",C.className="span8",l.className="row",h.className="chart-editor"},m:function(s,a){r(h,s,a),n(l,h),n(d,l),n(f,d),n(p,f),n(v,p),n(m,f),n(_,f),n(g,_),n(R,f),ie._mount(f,null),n(w,f),n(b,f),n(k,l),n(C,l),n(S,C),n(T,S),n(D,S),n(L,S),n(E,C),n(O,C),n(P,O),n(M,O),n(z,O),n(Z,z),t.refs.search=Z,Z.value=e.search,n(B,z),he&&he.m(z,null),n(K,O),le&&le.m(O,null),n(j,C),fe._mount(C,null),n(A,C),n(F,C),n(V,F),n($,V),n(W,V),n(G,V),n(J,V),n(Q,F),n(U,F),n(X,U),n(Y,U),n(ee,U),n(te,U)},p:function(e,s){var n={label:"Erste Zeile als Beschriftung"};!se.value&&e.firstRowIsHeader&&(n.value=s.firstRowIsHeader,se.value=!0),ie._set(n),se={},ne||(Z.value=s.search),e.searchResults&&q!==(q=s.searchResults.length>0?"with-results":"")&&(Z.className=q),s.searchResults.length>0?he||((he=H(0,t)).c(),he.m(z,null)):he&&(he.u(),he.d(),he=null),s.search?le?le.p(e,s):((le=N(s,t)).c(),le.m(O,null)):le&&(le.u(),le.d(),le=null);var r={};!re.data&&e.chartData&&(r.data=s.chartData,re.data=!0),!re.transpose&&e.transpose&&(r.transpose=s.transpose,re.transpose=!0),!re.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=s.firstRowIsHeader,re.firstRowIsHeader=!0),!re.search&&e.search&&(r.search=s.search,re.search=!0),!re.searchResults&&e.searchResults&&(r.searchResults=s.searchResults,re.searchResults=!0),!re.searchIndex&&e.searchIndex&&(r.searchIndex=s.searchIndex,re.searchIndex=!0),fe._set(r),re={}},u:function(){a(h),he&&he.u(),le&&le.u()},d:function(){ie.destroy(!1),u(S,"click",oe),u(Z,"input",ce),u(Z,"keypress",ue),t.refs.search===Z&&(t.refs.search=null),he&&he.d(),le&&le.d(),fe.destroy(!1)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,g(this._beforecreate),g(this._oncreate),g(this._aftercreate),this._lock=!1)}function D(e){this._observers={pre:l(),post:l()},this._changeHandlers=[],this._dependents=[],this._computed=l(),this._sortedComputedProperties=[],this._state=s({},e)}s(T.prototype,{nextResult:function(e){var t=this.get(),s=t.searchIndex,n=t.searchResults;(s+=e)<0&&(s+=n.length),s%=n.length,this.set({searchIndex:s})},keyPress:function(e){"F3"!=e.key&&"Enter"!=e.key||this.nextResult(e.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})}},R),T.prototype._recompute=function(e,t){var s,n;(e.searchIndex||e.searchResults)&&f(t.searchIndexSafe,t.searchIndexSafe=(s=t.searchIndex,n=t.searchResults,s<0&&(s+=n.length),s%=n.length))&&(e.searchIndexSafe=!0)},s(D.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},s=0;s<e.length;s+=1){var n=e[s];t["$"+n]=this._state[n]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,s=this._sortedComputedProperties=[],n=l();function r(a){if(e[a])throw new Error("Cyclical dependency detected");if(!n[a]){n[a]=!0;var i=t[a];i&&(e[a]=!0,i.deps.forEach(r),s.push(i))}}for(var a in this._computed)e=l(),r(a)},compute:function(e,t,s){var n,r={deps:t,update:function(r,a,i){var o=t.map(function(e){return e in a&&(i=!0),r[e]});if(i){var c=s.apply(null,o);f(c,n)&&(n=c,a[e]=!0,r[e]=n)}}};r.update(this._state,{},!0),this._computed[e]=r,this._sortComputedProperties()},get:v,observe:_,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var t=this._state,n=this._changed={},r=!1;for(var a in e){if(this._computed[a])throw new Error("'"+a+"' is a read-only property");f(e[a],t[a])&&(n[a]=r=!0)}if(r){this._state=s({},t,e);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,n);for(i=0;i<this._changeHandlers.length;i+=1)this._changeHandlers[i](this._state,n);p(this,this._observers.pre,n,this._state,t);var o=this._dependents.slice();for(i=0;i<o.length;i+=1){var c=o[i],u={};r=!1;for(var h=0;h<c.props.length;h+=1){var l=c.props[h];l in n&&(u["$"+l]=this._state[l],r=!0)}r&&c.component.set(u)}p(this,this._observers.post,n,this._state,t)}}});return{App:T,store:new D({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
