!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/fields",e):(t=t||self).fields=e()}(this,(function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){for(var n in e)t[n]=1;return t}function i(t){t()}function s(t,e){t.appendChild(e)}function o(t,e,n){t.insertBefore(e,n)}function r(t){t.parentNode.removeChild(t)}function a(){return document.createDocumentFragment()}function l(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return document.createComment("")}function c(t,e,n,i){t.addEventListener(e,n,i)}function h(t,e,n,i){t.removeEventListener(e,n,i)}function f(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function p(t,e,n){t.style.setProperty(e,n)}function m(t,e,n){t.classList[n?"add":"remove"](e)}function v(t){return t}function g(e,n,s,o,r){var a,l,u,d=s.call(e,n,o),c=!1;return{t:r?0:1,running:!1,program:null,pending:null,run:function(t,e){var n=this;"function"==typeof d?b.wait().then((function(){d=d(),n._run(t,e)})):this._run(t,e)},_run:function(e,i){a=d.duration||300,l=d.easing||v;var s={start:window.performance.now()+(d.delay||0),b:e,callback:i||t};r&&!c&&(d.css&&d.delay&&(u=n.style.cssText,n.style.cssText+=d.css(0,1)),d.tick&&d.tick(0,1),c=!0),e||(s.group=_.current,_.current.remaining+=1),d.delay?this.pending=s:this.start(s),this.running||(this.running=!0,b.add(this))},start:function(t){if(e.fire((t.b?"intro":"outro")+".start",{node:n}),t.a=this.t,t.delta=t.b-t.a,t.duration=a*Math.abs(t.b-t.a),t.end=t.start+t.duration,d.css){d.delay&&(n.style.cssText=u);var i=function(t,e,n){for(var i=t.a,s=t.b,o=t.delta,r=16.666/t.duration,a="{\n",l=0;l<=1;l+=r){var u=i+o*e(l);a+=100*l+"%{"+n(u,1-u)+"}\n"}return a+"100% {"+n(s,1-s)+"}\n}"}(t,l,d.css);b.addRule(i,t.name="__svelte_"+function(t){for(var e=5381,n=t.length;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(i)),n.style.animation=(n.style.animation||"").split(", ").filter((function(e){return e&&(t.delta<0||!/__svelte/.test(e))})).concat(t.name+" "+t.duration+"ms linear 1 forwards").join(", ")}this.program=t,this.pending=null},update:function(t){var e=this.program;if(e){var n=t-e.start;this.t=e.a+e.delta*l(n/e.duration),d.tick&&d.tick(this.t,1-this.t)}},done:function(){var t=this.program;this.t=t.b,d.tick&&d.tick(this.t,1-this.t),e.fire((t.b?"intro":"outro")+".end",{node:n}),t.b||t.invalidated?d.css&&b.deleteRule(n,t.name):(t.group.callbacks.push((function(){t.callback(),d.css&&b.deleteRule(n,t.name)})),0==--t.group.remaining&&t.group.callbacks.forEach(i)),this.running=!!this.pending},abort:function(t){this.program&&(t&&d.tick&&d.tick(1,0),d.css&&b.deleteRule(n,this.program.name),this.program=this.pending=null,this.running=!1)},invalidate:function(){this.program&&(this.program.invalidated=!0)}}}var _={};var b={running:!1,transitions:[],bound:null,stylesheet:null,activeRules:{},promise:null,add:function(t){this.transitions.push(t),this.running||(this.running=!0,requestAnimationFrame(this.bound||(this.bound=this.next.bind(this))))},addRule:function(t,e){if(!this.stylesheet){var n=l("style");document.head.appendChild(n),b.stylesheet=n.sheet}this.activeRules[e]||(this.activeRules[e]=!0,this.stylesheet.insertRule("@keyframes "+e+" "+t,this.stylesheet.cssRules.length))},next:function(){this.running=!1;for(var t=window.performance.now(),e=this.transitions.length;e--;){var n=this.transitions[e];n.program&&t>=n.program.end&&n.done(),n.pending&&t>=n.pending.start&&n.start(n.pending),n.running?(n.update(t),this.running=!0):n.pending||this.transitions.splice(e,1)}if(this.running)requestAnimationFrame(this.bound);else if(this.stylesheet){for(var i=this.stylesheet.cssRules.length;i--;)this.stylesheet.deleteRule(i);this.activeRules={}}},deleteRule:function(t,e){t.style.animation=t.style.animation.split(", ").filter((function(t){return t&&-1===t.indexOf(e)})).join(", ")},wait:function(){return b.promise||(b.promise=Promise.resolve(),b.promise.then((function(){b.promise=null}))),b.promise}};function y(){return Object.create(null)}function w(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function k(t,e){return t!=t?e==e:t!==e}function x(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var i=0;i<n.length;i+=1){var s=n[i];if(!s.__calling)try{s.__calling=!0,s.call(this,e)}finally{s.__calling=!1}}}function F(t){t._lock=!0,T(t._beforecreate),T(t._oncreate),T(t._aftercreate),t._lock=!1}function N(){return this._state}function C(t,e){t._handlers=y(),t._slots=y(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function R(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function T(t){for(;t&&t.length;)t.shift()()}var q={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:N,fire:x,on:R,set:function(t){this._set(e({},t)),this.root._lock||F(this.root)},_recompute:t,_set:function(t){var n=this._state,i={},s=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(i[o]=s=!0);s&&(this._state=e(e({},n),t),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(this.fire("state",{changed:i,current:this._state,previous:n}),this._fragment.p(i,this._state),this.fire("update",{changed:i,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:w};var E={width:"100px"};function L(t,e){var n;return{c:function(){p(n=l("label"),"width",e.width||E.width),n.className="control-label svelte-1lchyq2",m(n,"disabled",e.disabled)},m:function(t,i){o(t,n,i),n.innerHTML=e.label},p:function(t,e){t.label&&(n.innerHTML=e.label),t.width&&p(n,"width",e.width||E.width),t.disabled&&m(n,"disabled",e.disabled)},d:function(t){t&&r(n)}}}function M(t,e){var n;return{c:function(){(n=l("p")).className="mini-help svelte-1lchyq2"},m:function(t,i){o(t,n,i),n.innerHTML=e.help},p:function(t,e){t.help&&(n.innerHTML=e.help)},d:function(t){t&&r(n)}}}function P(t){var n,i,a,c,h,f,v,g,_,b,y;C(this,t),this._state=e({disabled:!1,help:!1,type:"default",valign:"baseline",inline:!1},t.data),this._intro=!0,this._slotted=t.slots||{},this._fragment=(n=this,i=this._state,_=n._slotted.default,b=i.label&&L(0,i),y=i.help&&M(0,i),{c:function(){a=l("div"),b&&b.c(),c=u("\n    "),h=l("div"),v=u("\n        "),y&&y.c(),h.className="controls svelte-1lchyq2",p(h,"width","calc(100% - "+(i.width||E.width)+" - 40px)"),m(h,"form-inline",i.inline),a.className=g="control-group vis-option-group vis-option-group-"+i.type+" label-"+i.valign+" svelte-1lchyq2"},m:function(t,e){o(t,a,e),b&&b.m(a,null),s(a,c),s(a,h),_&&(s(h,_),s(h,f||(f=d()))),s(h,v),y&&y.m(h,null)},p:function(t,e){e.label?b?b.p(t,e):((b=L(0,e)).c(),b.m(a,c)):b&&(b.d(1),b=null),e.help?y?y.p(t,e):((y=M(0,e)).c(),y.m(h,null)):y&&(y.d(1),y=null),t.width&&p(h,"width","calc(100% - "+(e.width||E.width)+" - 40px)"),t.inline&&m(h,"form-inline",e.inline),(t.type||t.valign)&&g!==(g="control-group vis-option-group vis-option-group-"+e.type+" label-"+e.valign+" svelte-1lchyq2")&&(a.className=g)},d:function(t){t&&r(a),b&&b.d(),_&&function(t,e){for(var n=t.parentNode;n.firstChild!==t;)e.appendChild(n.firstChild)}(f,_),y&&y.d()}}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function A(t){var e=t-1;return e*e*e+1}function j(t,e){var n=e.delay;void 0===n&&(n=0);var i=e.duration;void 0===i&&(i=400);var s=e.easing;void 0===s&&(s=A);var o=getComputedStyle(t),r=+o.opacity,a=parseFloat(o.height),l=parseFloat(o.paddingTop),u=parseFloat(o.paddingBottom),d=parseFloat(o.marginTop),c=parseFloat(o.marginBottom),h=parseFloat(o.borderTopWidth),f=parseFloat(o.borderBottomWidth);return{delay:n,duration:i,easing:s,css:function(t){return"overflow: hidden;opacity: "+Math.min(20*t,1)*r+";height: "+t*a+"px;padding-top: "+t*l+"px;padding-bottom: "+t*u+"px;margin-top: "+t*d+"px;margin-bottom: "+t*c+"px;border-top-width: "+t*h+"px;border-bottom-width: "+t*f+"px;"}}}function H(t,e){var n,i,p,m=!1;function v(){m=!0,t.set({value:n.value}),m=!1}var g={disabled:e.disabled,type:"text",width:e.width,label:e.label,help:e.help},b=new P({root:t.root,store:t.store,slots:{default:a()},data:g}),y=e.disabled&&e.disabled_msg&&z(t,e);return{c:function(){n=l("input"),b._fragment.c(),i=u("\n\n"),y&&y.c(),p=d(),c(n,"input",v),n.disabled=e.disabled,f(n,"type","text"),n.className="input-large svelte-1qnxtfn",n.placeholder=e.placeholder},m:function(t,r){s(b._slotted.default,n),n.value=e.value,b._mount(t,r),o(t,i,r),y&&y.i(t,r),o(t,p,r)},p:function(e,i){!m&&e.value&&(n.value=i.value),e.disabled&&(n.disabled=i.disabled),e.placeholder&&(n.placeholder=i.placeholder);var s={};e.disabled&&(s.disabled=i.disabled),e.width&&(s.width=i.width),e.label&&(s.label=i.label),e.help&&(s.help=i.help),b._set(s),i.disabled&&i.disabled_msg?(y?y.p(e,i):(y=z(t,i))&&y.c(),y.i(p.parentNode,p)):y&&(_.current={remaining:0,callbacks:[]},y.o((function(){y.d(1),y=null})))},d:function(t){h(n,"input",v),b.destroy(t),t&&r(i),y&&y.d(t),t&&r(p)}}}function z(t,e){var n,i,a,u;return{c:function(){n=l("div"),(i=l("div")).className="disabled-msg svelte-1qnxtfn"},m:function(t,r){o(t,n,r),s(n,i),i.innerHTML=e.disabled_msg,u=!0},p:function(t,e){u&&!t.disabled_msg||(i.innerHTML=e.disabled_msg)},i:function(e,i){u||(t.root._intro&&(a&&a.invalidate(),t.root._aftercreate.push((function(){a||(a=g(t,n,j,{},!0)),a.run(1)}))),this.m(e,i))},o:function(e){u&&(a||(a=g(t,n,j,{},!1)),a.run(0,(function(){e(),a=null})),u=!1)},d:function(t){t&&(r(n),a&&a.abort())}}}function B(t){C(this,t),this._state=e({disabled:!1,disabled_msg:"",width:"100px",help:"",placeholder:""},t.data),this._intro=!0,this._fragment=H(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),F(this))}function O(t){var e=t.changed,n=t.current,i=this.store.get().dw_chart;if(e.customFields&&n.customFields){var s=i.get("metadata.custom",{});n.customFields.forEach((function(t){s[t.key]||(s[t.key]="")})),this.set({custom:s,initialized:!0})}e.custom&&n.initialized&&(i.set("metadata.custom",n.custom),i.saveSoon&&i.saveSoon())}function S(t,e,n){var i=Object.create(t);return i.field=e[n],i}function W(t,e){var n,i,a,d,f,p,m=!e.notoggle&&$();function v(e){t.toggle()}for(var g=e.customFields,_=[],b=0;b<g.length;b+=1)_[b]=I(t,S(e,g,b));return{c:function(){n=l("div"),i=l("label"),m&&m.c(),a=u(" Custom fields"),d=u("\n\n    "),f=l("div"),p=l("div");for(var t=0;t<_.length;t+=1)_[t].c();c(i,"click",v),i.className="group-title",f.className="option-group-content vis-option-type-chart-description",n.className="vis-option-type-group group-open"},m:function(e,r){o(e,n,r),s(n,i),m&&m.m(i,null),s(i,a),s(n,d),s(n,f),s(f,p);for(var l=0;l<_.length;l+=1)_[l].m(p,null);t.refs.customFields=p},p:function(e,n){if(n.notoggle?m&&(m.d(1),m=null):m||((m=$()).c(),m.m(i,a)),e.customFields||e.custom){g=n.customFields;for(var s=0;s<g.length;s+=1){var o=S(n,g,s);_[s]?_[s].p(e,o):(_[s]=I(t,o),_[s].c(),_[s].m(p,null))}for(;s<_.length;s+=1)_[s].d(1);_.length=g.length}},d:function(e){e&&r(n),m&&m.d(),h(i,"click",v),function(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(_,e),t.refs.customFields===p&&(t.refs.customFields=null)}}}function $(t,e){var n,i,s;return{c:function(){n=l("i"),i=u("\n        "),s=l("i"),n.className="fa fa-chevron-up expand-group pull-right",s.className="fa fa-chevron-down collapse-group pull-right"},m:function(t,e){o(t,n,e),o(t,i,e),o(t,s,e)},d:function(t){t&&(r(n),r(i),r(s))}}}function D(t,e){var n,i,s,a=!1;function u(){a=!0,e.custom[e.field.key]=n.value,t.set({custom:e.custom,customFields:e.customFields}),a=!1}return{c:function(){c(n=l("textarea"),"input",u),f(n,"labelwidth","auto"),f(n,"label",i=e.field.title),f(n,"help",s=e.field.description)},m:function(t,i){o(t,n,i),n.value=e.custom[e.field.key]},p:function(t,o){e=o,a||!t.custom&&!t.customFields||(n.value=e.custom[e.field.key]),t.customFields&&i!==(i=e.field.title)&&f(n,"label",i),t.customFields&&s!==(s=e.field.description)&&f(n,"help",s)},d:function(t){t&&r(n),h(n,"input",u)}}}function G(t,e){var n={},i={labelWidth:"auto",label:e.field.title,help:e.field.description};void 0!==e.custom[e.field.key]&&(i.value=e.custom[e.field.key],n.value=!0);var s=new B({root:t.root,store:t.store,data:i,_bind:function(i,s){var o={};!n.value&&i.value&&(e.custom[e.field.key]=s.value,o.custom=e.custom),t._set(o),n={}}});return t.root._beforecreate.push((function(){s._bind({value:1},s.get())})),{c:function(){s._fragment.c()},m:function(t,e){s._mount(t,e)},p:function(t,i){e=i;var o={};t.customFields&&(o.label=e.field.title),t.customFields&&(o.help=e.field.description),(!n.value&&t.custom||t.customFields)&&(o.value=e.custom[e.field.key],n.value=void 0!==e.custom[e.field.key]),s._set(o),n={}},d:function(t){s.destroy(t)}}}function I(t,e){var n;function i(t){return"text"==t.field.type?G:"textArea"==t.field.type?D:void 0}var s=i(e),a=s&&s(t,e);return{c:function(){a&&a.c(),n=d()},m:function(t,e){a&&a.m(t,e),o(t,n,e)},p:function(e,o){s===(s=i(o))&&a?a.p(e,o):(a&&a.d(1),(a=s&&s(t,o))&&a.c(),a&&a.m(n.parentNode,n))},d:function(t){a&&a.d(t),t&&r(n)}}}function J(t){var i,s,a,l,u=this;C(this,t),this.refs={},this._state=e({customFields:[],custom:{},initialized:!1},t.data),this._intro=!0,this._handlers.state=[O],O.call(this,{changed:n({},this._state),current:this._state}),this._fragment=(i=this,s=this._state,l=s.customFields.length&&s.initialized&&W(i,s),{c:function(){l&&l.c(),a=d()},m:function(t,e){l&&l.m(t,e),o(t,a,e)},p:function(t,e){e.customFields.length&&e.initialized?l?l.p(t,e):((l=W(i,e)).c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null)},d:function(t){l&&l.d(t),t&&r(a)}}),this.root._oncreate.push((function(){u.fire("update",{changed:n({},u._state),current:u._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),F(this))}function K(t,n){this._handlers={},this._dependents=[],this._computed=y(),this._sortedComputedProperties=[],this._state=e({},t),this._differs=n&&n.immutable?k:w}e(P.prototype,q),e(function(t){C(this,t),this._state=e({placeholder:""},t.data),this._intro=!0,this._fragment=function(t,e){var n,i=!1;function o(){i=!0,t.set({value:n.value}),i=!1}var r={disabled:e.disabled,type:"textarea",width:e.width,label:e.label,help:e.help},u=new P({root:t.root,store:t.store,slots:{default:a()},data:r});return{c:function(){n=l("textarea"),u._fragment.c(),c(n,"input",o),n.placeholder=e.placeholder,p(n,"width",e.width||"auto")},m:function(t,i){s(u._slotted.default,n),n.value=e.value,u._mount(t,i)},p:function(t,e){!i&&t.value&&(n.value=e.value),t.placeholder&&(n.placeholder=e.placeholder),t.width&&p(n,"width",e.width||"auto");var s={};t.disabled&&(s.disabled=e.disabled),t.width&&(s.width=e.width),t.label&&(s.label=e.label),t.help&&(s.help=e.help),u._set(s)},d:function(t){h(n,"input",o),u.destroy(t)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),F(this))}.prototype,q),e(B.prototype,q),e(J.prototype,q),e(K.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var i=t[n];e["$"+i]=this._state[i]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,n){var i=this,s=this._state;this._state=e(e({},s),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,n);this.fire("state",{changed:n,previous:s,current:this._state}),this._dependents.filter((function(t){for(var e={},s=!1,o=0;o<t.props.length;o+=1){var r=t.props[o];r in n&&(e["$"+r]=i._state[r],s=!0)}if(s)return t.component._stage(e),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:n,previous:s,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],i=y();function s(o){var r=e[o];r&&(r.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between "+e+" <-> "+o);s(e)})),i[o]||(i[o]=!0,n.push(r)))}for(var o in this._computed)s(t=o)},compute:function(t,n,i){var s,o=this,r={deps:n,update:function(e,r,a){var l=n.map((function(t){return t in r&&(a=!0),e[t]}));if(a){var u=i.apply(null,l);o._differs(u,s)&&(s=u,r[t]=!0,e[t]=s)}}};this._computed[t]=r,this._sortComputedProperties();var a=e({},this._state),l={};r.update(a,l,!0),this._set(a,l)},fire:x,get:N,on:R,set:function(t){var e=this._state,n=this._changed={},i=!1;for(var s in t){if(this._computed[s])throw new Error("'"+s+"' is a read-only computed property");this._differs(t[s],e[s])&&(n[s]=i=!0)}i&&this._set(t,n)}});return{App:J,data:{chart:{id:""}},store:new K({}),init:function(t){window.dw.backend.on("dataset-loaded",(function(){t.store.set({dataset:chart.dataset()})})).on("theme-changed-and-loaded",(function(){t.store.set({theme:window.dw.theme(chart.get("theme"))})})).on("backend-vis-loaded",(function(e){t.store.set({vis:e})}))}}}));
