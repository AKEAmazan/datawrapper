!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/account",e):t.account=e()}(this,function(){"use strict";function t(){}function n(t,e){for(var n in e)t[n]=e[n];return t}function a(t,e){e.appendChild(t)}function s(t,e,n){e.insertBefore(t,n)}function o(t){t.parentNode.removeChild(t)}function i(t){return document.createElement(t)}function r(t){return document.createTextNode(t)}function c(t,e,n){t.addEventListener(e,n,!1)}function l(t,e,n){t.removeEventListener(e,n,!1)}function u(t,e,n){t.setAttribute(e,n)}function d(t,e,n){t.style.setProperty(e,n)}function f(){return Object.create(null)}function p(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function h(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function m(t,e){return t!=t?e==e:t!==e}function v(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var a=0;a<n.length;a+=1){var s=n[a];s.__calling||(s.__calling=!0,s.call(this,e),s.__calling=!1)}}function g(t){return t?this._state[t]:this._state}function w(t,e,n){var a=e.bind(this);return n&&!1===n.init||a(this.get()[t],void 0),this.on(n&&n.defer?"update":"state",function(e){e.changed[t]&&a(e.current[t],e.previous&&e.previous[t])})}function b(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function y(t){for(;t&&t.length;)t.shift()()}var N={destroy:p,get:g,fire:v,observe:w,on:b,set:function(t){this._set(n({},t)),this.root._lock||(this.root._lock=!0,y(this.root._beforecreate),y(this.root._oncreate),y(this.root._aftercreate),this.root._lock=!1)},teardown:p,_recompute:t,_set:function(t){var e=this._state,a={},s=!1;for(var o in t)this._differs(t[o],e[o])&&(a[o]=s=!0);s&&(this._state=n(n({},e),t),this._recompute(a,this._state),this._bind&&this._bind(a,this._state),this._fragment&&(this.fire("state",{changed:a,current:this._state,previous:e}),this._fragment.p(a,this._state),this.fire("update",{changed:a,current:this._state,previous:e})))},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:h};function k(t,e){return void 0===e&&(e="core"),t=t.trim(),dw.backend.__messages[e]?dw.backend.__messages[e][t]||dw.backend.__messages.core[t]||t:"MISSING:"+t}var x={changeEmail:function(){var t=$(e.target),n={email:$("#email").val()};t.addClass("loading"),$.ajax({url:"/api/users/{{ user.id }}",type:"PUT",dataType:"json",data:JSON.stringify(n),success:function(e){t.removeClass("loading"),"ok"==e.status?(_.each(e.data.messages,function(t){dw.backend.logMessage(t,$("#edit-account-email .control-group")[0],"info")}),_.each(e.data.errors,function(t){dw.backend.logMessage(t,$("#edit-account-email .control-group")[0],"warning")}),$(".profile .reset").prop("disabled",!0)):dw.backend.logError(e.message,$("#edit-account-email .control-group")[0])}})},changePassword:function(){var t=$(e.target),n=($($(".settings.password .control-group")[0]),$.trim($("#cur-pwd").val())),a=$.trim($("#pwd").val()),s=$.trim($("#pwd2").val());dw.backend.clearAlerts(),!0===dw.backend.checkPassword(n,a,s)&&(t.addClass("loading"),$.getJSON("/api/auth/salt",function(e){if("ok"==e.status){var s=e.data.salt;hmac=CryptoJS.HmacSHA256,payload={oldpwhash:hmac(n,s).toString(),pwd:CryptoJS.HmacSHA256(a,s).toString()},$("#pwd").val(""),$("#pwd2").val(""),$("#cur-pwd").val(""),$.ajax({url:"/api/users/{{ user.id }}",type:"PUT",data:JSON.stringify(payload),dataType:"json",success:function(e){t.removeClass("loading"),"ok"==e.status&&(_.each(e.data.messages,function(t){dw.backend.logMessage(t,$("#edit-account-password .control-group")[0],"info")}),_.each(e.data.errors,function(t){dw.backend.logMessage(t,$("#edit-account-password .control-group")[0],"warning")}),e.data.errors.length||dw.backend.logMessage('{ __("Congrats! Your password has been changed.") }',$("#edit-account-password .control-group")[0]))}})}}))},deleteAccount:function(){$.getJSON("/api/auth/salt",function(t){if("ok"==t.status){var e=CryptoJS.HmacSHA256($("#confirm-pwd").val(),t.data.salt).toString();$.ajax({url:"/api/users/current?pwd="+e,type:"DELETE",data:JSON.stringify({pwd:e}),dataType:"json"}).done(function(t){"ok"==t.status?($("#confirmDeletion .modal-body").remove(),$("#confirmDeletion .modal-footer").remove(),$("#confirmDeletion .post-delete").css({"text-align":"center",padding:"30px"}),$("#confirmDeletion .post-delete").addClass("modal-body"),$("#confirmDeletion .post-delete").show()):dw.backend.logError(t.message,$("#confirm-pwd").parent())}).fail(function(t){dw.backend.logError("could not delete user: "+JSON.stringify(t),$("#confirm-pwd").parent())})}else dw.backend.logError("could not load salt",$("#confirm-pwd").parent())})}};function P(t,e){var n,c,l,u,d,f,p,h,m,v=k("Edit profile"),g=k("Change the e-mail address or password you use to log into Datawrapper.");function w(t){return t.changePassword?E:t.deleteAccount?C:t.deleteAccount2?A:t.deleteAccount3?S:t.changeEmail?I:M}var b=w(e),_=b(t,e);return{c:function(){n=i("div"),c=i("div"),l=i("h1"),u=r(v),d=r("\n        "),f=i("h2"),p=r(g),h=r("\n\n"),_.c(),m=document.createComment(""),this.h()},h:function(){c.className="span10 offset1",n.className="row"},m:function(t,e){s(n,t,e),a(c,n),a(l,c),a(u,l),a(d,c),a(f,c),a(p,f),s(h,t,e),_.m(t,e),s(m,t,e)},p:function(e,n){b===(b=w(n))&&_?_.p(e,n):(_.u(),_.d(),(_=b(t,n)).c(),_.m(m.parentNode,m))},u:function(){o(n),o(h),_.u(),o(m)},d:function(){_.d()}}}function E(t,e){var n,f,p,h,m,v,g,w,b,_,y,N,x,P,$,E,C,A,S,I,M,T,D,H,j,J,O,Y,F,L,B,q,z,G,R,U,K,Q,V,W,X,Z,tt,et,nt,at,st,ot,it,rt=k("Change password"),ct=k("For security reasons we ask you to provide your current password. Please make sure you use a strong password."),lt=k("Current Password"),ut=k("For security reasons, please provide your current password."),dt=k("New Password"),ft=k("(repeat)"),pt=k("Show password in clear text"),ht=k("Back"),mt=k("Change Password");function vt(){t.set({showPasswordInPlaintext:W.checked})}function gt(e){t.set({changePassword:!1})}return{c:function(){n=i("div"),f=i("div"),p=i("div"),h=i("h2"),m=r(rt),v=r("\n\t            "),g=i("p"),w=r(ct),b=r("\n\t            "),_=i("fieldset"),y=i("div"),N=i("label"),x=r(lt),P=r("\n\t                    "),$=i("div"),E=i("input"),C=r("\n\t                        "),A=i("p"),S=r(ut),I=r("\n\t                "),M=i("div"),T=i("label"),D=r(dt),H=r("\n\t                    "),j=i("div"),J=i("input"),Y=r("\n\t                "),F=i("div"),L=i("label"),B=r(ft),q=r("\n\t                    "),z=i("div"),G=i("input"),U=r("\n\t                "),K=i("div"),Q=i("div"),V=i("label"),W=i("input"),X=r("\n\t                        \t"),Z=r(pt),tt=r("\n\n\t                "),et=i("div"),nt=i("button"),at=r(ht),st=r("\n\t                    "),ot=i("button"),it=r(mt),this.h()},h:function(){N.className="control-label",N.htmlFor="cur-pwd",u(E,"type","password"),E.className="input-xlarge",A.className="help-block",$.className="controls",y.className="control-group",T.className="control-label",T.htmlFor="pwd",u(J,"type",O=e.showPasswordInPlaintext?"text":"password"),J.className="input-xlarge",j.className="controls",M.className="control-group",L.className="control-label",L.htmlFor="pwd2",u(G,"type",R=e.showPasswordInPlaintext?"text":"password"),G.className="input-xlarge",z.className="controls",F.className="control-group",c(W,"change",vt),u(W,"type","checkbox"),V.className="checkbox",Q.className="controls",K.className="control-group",c(nt,"click",gt),nt.className="btn btn-save btn-default btn-back",ot.className="btn btn-save btn-primary",ot.type="submit",ot.id="change-password",d(ot,"float","right"),p.className="form-horizontal edit-account-confirm",f.className="span6 offset3",n.className="row"},m:function(t,o){s(n,t,o),a(f,n),a(p,f),a(h,p),a(m,h),a(v,p),a(g,p),a(w,g),a(b,p),a(_,p),a(y,_),a(N,y),a(x,N),a(P,y),a($,y),a(E,$),a(C,$),a(A,$),a(S,A),a(I,_),a(M,_),a(T,M),a(D,T),a(H,M),a(j,M),a(J,j),a(Y,_),a(F,_),a(L,F),a(B,L),a(q,F),a(z,F),a(G,z),a(U,_),a(K,_),a(Q,K),a(V,Q),a(W,V),W.checked=e.showPasswordInPlaintext,a(X,V),a(Z,V),a(tt,_),a(et,_),a(nt,et),a(at,nt),a(st,et),a(ot,et),a(it,ot)},p:function(t,e){t.showPasswordInPlaintext&&O!==(O=e.showPasswordInPlaintext?"text":"password")&&u(J,"type",O),t.showPasswordInPlaintext&&R!==(R=e.showPasswordInPlaintext?"text":"password")&&u(G,"type",R),W.checked=e.showPasswordInPlaintext},u:function(){o(n)},d:function(){l(W,"change",vt),l(nt,"click",gt)}}}function C(e,n){var u,f,p,h,m,v,g,w,b,_,y,N,x,P,$,E,C,A,S,I,M=k("Are you sure you want to delete your account?"),T=k("No, go back"),D=k("or"),H=k("Yes, delete my account");function j(t){e.set({deleteAccount:!1})}function J(t){e.set({deleteAccount:!1,deleteAccount2:!0})}return{c:function(){u=i("div"),f=i("div"),(p=i("div")).innerHTML='<i class="fa fa-times"></i>',h=r("\n\n\t        "),m=i("h2"),v=r(M),g=r("\n\n\n\t        "),w=i("div"),b=i("button"),_=i("i"),y=r("   "),N=r(T),x=r("\n\n\t\t        "),P=i("div"),$=r(D),E=r("\n\n\t\t        "),C=i("button"),A=i("i"),S=r("   "),I=r(H),this.h()},h:function(){p.className="iconholder svelte-u71xal",d(m,"margin-bottom","20px"),m.className="svelte-u71xal",_.className="fa fa-chevron-left",c(b,"click",j),b.className="btn btn-back btn-primary",d(P,"display","block"),d(P,"margin","0px 10px"),A.className="fa fa-times",c(C,"click",J),C.className="btn btn-default",d(w,"display","flex"),d(w,"justify-content","center"),d(w,"align-items","center"),f.className="span6 offset3",d(f,"text-align","center"),u.className="row delete-account svelte-u71xal"},m:function(t,e){s(u,t,e),a(f,u),a(p,f),a(h,f),a(m,f),a(v,m),a(g,f),a(w,f),a(b,w),a(_,b),a(y,b),a(N,b),a(x,w),a(P,w),a($,P),a(E,w),a(C,w),a(A,C),a(S,C),a(I,C)},p:t,u:function(){o(u)},d:function(){l(b,"click",j),l(C,"click",J)}}}function A(e,n){var f,p,h,m,v,g,w,b,_,y,N,x,P,$,E,C,A,S,I,M,T,D,H,j,J,O,Y,F,L,B,q,z,G,R,U,K,Q,V,W,X=k("Account deletion"),Z=k("Think about it one more time. Have you considered all the consequences of deleting your account?"),tt=k("If you simply want to use Datawrapper for free, you can downgrade your account without deleting it. That way, you keep access to your chart."),et=k("You cannot login and logout anymore."),nt=k("You cannot edit or remove your charts anymore."),at=k("Note that this will only delete your account. Your charts will not be removed. If you want to remove your charts, please do it manually."),st=k("Please enter your password to confirm the deletion request:"),ot=k("Do you still <b>really</b> want to delete your Datawrapper account?"),it=k("No, I changed my mind.."),rt=k("Yes, delete it!");function ct(t){e.set({deleteAccount2:!1})}function lt(t){e.set({deleteAccount2:!1,deleteAccount3:!0})}return{c:function(){f=i("div"),p=i("div"),h=i("h2"),m=r(X),v=r("\n\t        "),g=i("p"),w=r(Z),b=r("\n\t        "),_=i("ul"),y=i("li"),N=r(tt),x=i("li"),P=r(et),$=i("li"),E=r(nt),C=r("\n\t        "),A=i("p"),S=r(at),I=r("\n\t        "),M=i("div"),T=i("p"),D=i("b"),H=r(st),j=r("\n\t            "),J=i("div"),O=i("input"),Y=r("\n\t            "),F=i("p"),L=r("\n\t            "),B=i("div"),q=i("button"),z=i("i"),G=r(" \n\t                \t"),R=r(it),U=r("\n\t                "),K=i("button"),Q=i("i"),V=r(" \n\t            \t    "),W=r(rt),this.h()},h:function(){d(h,"margin-bottom","20px"),h.className="svelte-u71xal",u(O,"type","password"),O.id="confirm-pwd",O.placeholder=k("Password"),J.className="control-group",z.className="fa fa-chevron-left",c(q,"click",ct),q.className="btn btn-info",Q.className="fa fa-times",c(K,"click",lt),d(K,"float","right"),K.className="btn btn-danger",B.className="control-group",M.className="",p.className="span6 offset3",f.className="row delete-account svelte-u71xal"},m:function(t,e){s(f,t,e),a(p,f),a(h,p),a(m,h),a(v,p),a(g,p),a(w,g),a(b,p),a(_,p),a(y,_),a(N,y),a(x,_),a(P,x),a($,_),a(E,$),a(C,p),a(A,p),a(S,A),a(I,p),a(M,p),a(T,M),a(D,T),a(H,D),a(j,M),a(J,M),a(O,J),a(Y,M),a(F,M),F.innerHTML=ot,a(L,M),a(B,M),a(q,B),a(z,q),a(G,q),a(R,q),a(U,B),a(K,B),a(Q,K),a(V,K),a(W,K)},p:t,u:function(){F.innerHTML="",o(f)},d:function(){l(q,"click",ct),l(K,"click",lt)}}}function S(e,n){var c,l,u,f,p,h,m,v=k("Your account has been deleted."),g=k("Goodbye!");return{c:function(){c=i("div"),l=i("div"),u=i("h2"),f=r(v),p=r("\n\t        "),h=i("a"),m=r(g),this.h()},h:function(){d(u,"margin-bottom","20px"),d(u,"text-align","center"),u.className="svelte-u71xal",h.href="/",h.className="btn btn-primary btn-large",l.className="span6 offset3",d(l,"text-align","center"),c.className="row delete-account svelte-u71xal"},m:function(t,e){s(c,t,e),a(l,c),a(u,l),a(f,u),a(p,l),a(h,l),a(m,h)},p:t,u:function(){o(c)},d:t}}function I(t,e){var n,f,p,h,m,v,g,w,b,_,y,N,x,P,$,E,C,A,S,I,M,T,D,H,j,J=k("Change E-Mail"),O=k("Please note that you'll have to confirm your new e-mail address again after changing it."),Y=k("E-Mail"),F=!1,L=k("Back"),B=k("Change E-Mail");function q(){F=!0,t.set({email:C.value}),F=!1}function z(e){t.set({changeEmail:!1})}function G(e){t.changeEmail()}return{c:function(){n=i("div"),f=i("div"),p=i("div"),h=i("h2"),m=r(J),v=r("\n\t            "),g=i("p"),w=r(O),b=r("\n\t            "),_=i("fieldset"),y=i("div"),N=i("label"),x=r(Y),P=r(":"),$=r("\n\t                    "),E=i("div"),C=i("input"),S=r("\n\t                \n\t                "),I=i("div"),M=i("button"),T=r(L),D=r("\n\t                    "),H=i("button"),j=r(B),this.h()},h:function(){N.className="control-label",N.htmlFor="email",c(C,"input",q),C.disabled=A=!e.changeEmail,u(C,"type","text"),E.className="controls",y.className="control-group",c(M,"click",z),M.className="btn btn-default",c(H,"click",G),d(H,"float","right"),H.className="btn btn-save btn-primary",I.className="",p.className="form-horizontal edit-account",f.className="span6 offset3",n.className="row"},m:function(t,o){s(n,t,o),a(f,n),a(p,f),a(h,p),a(m,h),a(v,p),a(g,p),a(w,g),a(b,p),a(_,p),a(y,_),a(N,y),a(x,N),a(P,N),a($,y),a(E,y),a(C,E),C.value=e.email,a(S,_),a(I,_),a(M,I),a(T,M),a(D,I),a(H,I),a(j,H)},p:function(t,e){F||(C.value=e.email),t.changeEmail&&A!==(A=!e.changeEmail)&&(C.disabled=A)},u:function(){o(n)},d:function(){l(C,"input",q),l(M,"click",z),l(H,"click",G)}}}function M(t,e){var n,f,p,h,m,v,g,w,b,_,y,N,x,P,$,E,C,A,S,I,M,T,D,H,j,J,O,Y,F,L,B,q,z,G=k("E-Mail"),R=!1,U=k("Change E-Mail"),K=k("Password"),Q=k("Change Password"),V=k("or"),W=k("delete your account");function X(){R=!0,t.set({email:b.value}),R=!1}function Z(e){t.set({changeEmail:!0})}function tt(e){t.set({changePassword:!0})}function et(e){t.set({deleteAccount:!0})}return{c:function(){n=i("div"),f=i("div"),p=i("div"),h=i("div"),m=r(G),v=r(":"),g=r("\n\t\t\t\t"),w=i("div"),b=i("input"),y=r("\n\t\t\t\t"),N=i("div"),x=i("button"),P=r(U),$=r("\n\n\t    \t"),E=i("div"),C=i("div"),A=r(K),S=r(":"),I=r("\n\t\t\t\t"),M=i("div"),T=i("input"),D=r("\n\t\t\t\t"),H=i("div"),j=i("button"),J=r(Q),O=r("\n\n\t    \t"),Y=i("div"),F=r(V),L=r(" "),B=i("span"),q=r(W),z=r("."),this.h()},h:function(){h.className="svelte-u71xal",c(b,"input",X),b.disabled=_=!e.changeEmail,u(b,"type","text"),w.className="svelte-u71xal",c(x,"click",Z),x.className="btn btn-save btn-default",N.className="svelte-u71xal",p.className="svelte-u71xal",C.className="svelte-u71xal",T.disabled=!0,T.value="abcdefgh",u(T,"type","password"),M.className="svelte-u71xal",c(j,"click",tt),j.className="btn btn-save btn-default",H.className="svelte-u71xal",E.className="svelte-u71xal",c(B,"click",et),B.className="link svelte-u71xal",u(B,"href","#"),d(Y,"text-align","center"),d(Y,"display","block"),Y.className="svelte-u71xal",f.className="span6 offset3",n.className="row edit-account svelte-u71xal",d(n,"margin-top","20px")},m:function(t,o){s(n,t,o),a(f,n),a(p,f),a(h,p),a(m,h),a(v,h),a(g,p),a(w,p),a(b,w),b.value=e.email,a(y,p),a(N,p),a(x,N),a(P,x),a($,f),a(E,f),a(C,E),a(A,C),a(S,C),a(I,E),a(M,E),a(T,M),a(D,E),a(H,E),a(j,H),a(J,j),a(O,f),a(Y,f),a(F,Y),a(L,Y),a(B,Y),a(q,B),a(z,Y)},p:function(t,e){R||(b.value=e.email),t.changeEmail&&_!==(_=!e.changeEmail)&&(b.disabled=_)},u:function(){o(n)},d:function(){l(b,"input",X),l(x,"click",Z),l(j,"click",tt),l(B,"click",et)}}}function T(t){!function(t,e){t._handlers=f(),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=t.root.store||e.store}(this,t),this._state=n({changePassword:!1,changeEmail:!1,deleteAccount:!1,showPasswordInPlaintext:!1},t.data),this._fragment=P(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function D(t,e){this._observers={pre:f(),post:f()},this._handlers={},this._dependents=[],this._computed=f(),this._sortedComputedProperties=[],this._state=n({},t),this._differs=e&&e.immutable?m:h}n(T.prototype,N),n(T.prototype,x),n(D.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var a=t[n];e["$"+a]=this._state[a]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],a=f();function s(o){if(t[o])throw new Error("Cyclical dependency detected");if(!a[o]){a[o]=!0;var i=e[o];i&&(t[o]=!0,i.deps.forEach(s),n.push(i))}}for(var o in this._computed)t=f(),s(o)},compute:function(t,e,n){var a,s=this,o={deps:e,update:function(o,i,r){var c=e.map(function(t){return t in i&&(r=!0),o[t]});if(r){var l=n.apply(null,c);s._differs(l,a)&&(a=l,i[t]=!0,o[t]=a)}}};o.update(this._state,{},!0),this._computed[t]=o,this._sortComputedProperties()},fire:v,get:g,observe:w,on:b,onchange:function(t){return console.warn("store.onchange is deprecated in favour of store.on('state', event => {...})"),this.on("state",function(e){t(e.current,e.changed)})},set:function(t){var e=this._state,a=this._changed={},s=!1;for(var o in t){if(this._computed[o])throw new Error("'"+o+"' is a read-only property");this._differs(t[o],e[o])&&(a[o]=s=!0)}if(s){this._state=n(n({},e),t);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,a);this.fire("state",{changed:a,current:this._state,previous:e});var r=this._dependents.slice();for(i=0;i<r.length;i+=1){var c=r[i],l={};s=!1;for(var u=0;u<c.props.length;u+=1){var d=c.props[u];d in a&&(l["$"+d]=this._state[d],s=!0)}s&&c.component.set(l)}this.fire("update",{changed:a,current:this._state,previous:e})}}});return{App:T,store:new D({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
