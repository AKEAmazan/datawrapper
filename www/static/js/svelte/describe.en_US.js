!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Handsontable")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable"],t):e.describe=t(e.HOT)}(this,function(e){"use strict";function t(){}function s(e){for(var t,s,r=arguments,a=1,n=arguments.length;a<n;a++)for(t in s=r[a])e[t]=s[t];return e}function r(e,t){t.appendChild(e)}function a(e,t,s){t.insertBefore(e,s)}function n(e){e.parentNode.removeChild(e)}function o(e){return document.createElement(e)}function i(e){return document.createTextNode(e)}function c(e,t,s){e.addEventListener(t,s,!1)}function h(e,t,s){e.removeEventListener(t,s,!1)}function u(e,t,s){e.style.setProperty(t,s)}function l(){return Object.create(null)}function d(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function f(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,s,r,a){for(var n in t)if(s[n]){var o=r[n],i=a[n],c=t[n];if(c)for(var h=0;h<c.length;h+=1){var u=c[h];u.__calling||(u.__calling=!0,u.call(e,o,i),u.__calling=!1)}}}function _(e){return e?this._state[e]:this._state}function v(e,t){e._observers={pre:l(),post:l()},e._handlers=l(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function m(e,t,s){var r=s&&s.defer?this._observers.post:this._observers.pre;return(r[e]||(r[e]=[])).push(t),s&&!1===s.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var s=r[e].indexOf(t);~s&&r[e].splice(s,1)}}}function g(e){for(;e&&e.length;)e.pop()()}e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:d,get:_,fire:function(e,t){var s=e in this._handlers&&this._handlers[e].slice();if(s)for(var r=0;r<s.length;r+=1)s[r].call(this,t)},observe:m,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var s=this._handlers[e]||(this._handlers[e]=[]);return s.push(t),{cancel:function(){var e=s.indexOf(t);~e&&s.splice(e,1)}}},set:function(e){this._set(s({},e)),this.root._lock||(this.root._lock=!0,g(this.root._beforecreate),g(this.root._oncreate),g(this.root._aftercreate),this.root._lock=!1)},teardown:d,_recompute:t,_set:function(e){var t=this._state,r={},a=!1;for(var n in e)f(e[n],t[n])&&(r[n]=a=!0);a&&(this._state=s({},t,e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(p(this,this._observers.pre,r,this._state,t),this._fragment.p(r,this._state),p(this,this._observers.post,r,this._state,t)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var w={update:function(){var t=this,s=this.get(),r=s.data,a=s.transpose,n=s.firstRowIsHeader,o=s.skipRows,i=s.hot;if(r){var c=this.store.get("dw_chart").dataset(dw.datasource.delimited({csv:r,transpose:a,firstRowIsHeader:n,skipRows:o}).parse()).dataset();this.set({columnOrder:c.columnOrder()}),console.log("col order 1",this.get("columnOrder"));var h=[[]];c.eachColumn(function(e){return h[0].push(e.title())}),c.eachRow(function(e){var t=[];c.eachColumn(function(s){return t.push(s.val(e))}),h.push(t)}),i.loadData(h),i.updateSettings({cells:function(s,r){return{readOnly:t.get().readonly||c.column(r).isComputed&&0===s,renderer:b(t,c,e,{})}},manualColumnMove:[]}),i.render()}}};function b(e,t,s,r){var a={date:"fa fa-clock-o"};function n(e,t,r,a,n,o,i){var c=dw.utils.purifyHtml(s.helper.stringify(o));t.innerHTML=c}return function(s,r,o,i,c,h,u){var l=t.column(i),d=e.get(),f=d.searchResults,p=d.currentResult;o>0&&(h=chart.columnFormatter(l)(l.val(o-1),!0));parseInt(h)<0&&r.classList.add("negative"),r.classList.add(l.type()+"Type"),0===o?(r.classList.add("firstRow"),a[l.type()]&&(h='<i class="'+a[l.type()]+'"></i> '+h)):r.classList.add(o%2?"oddRow":"evenRow"),f.forEach(function(e){e.row==o&&e.col==i&&r.classList.add("htSearchResult")}),p&&p.row==o&&p.col==i&&r.classList.add("htCurrentSearchResult"),o>0&&!l.type(!0).isValid(l.val(o-1))&&r.classList.add("parsingError"),u.readOnly&&r.classList.add("readOnly"),chart.dataCellChanged(i,o)&&r.classList.add("changed"),Reflect.apply(n,this,arguments)}}function I(r){v(this,r),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,search:"",searchResults:[]},r.data),this._recompute({searchResults:1,searchIndex:1},this._state);var i,c,h=function(){var t=this,s=new e(this.refs.hot,{data:[],rowHeaders:function(e){return s.getPlugin("ColumnSorting").translateRow(e)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",columnSorting:!0,sortIndicator:!0,sortFunction:function(e,t){return function(r,a){var n,o=s.getPlugin("columnSorting");if(0===r[0])return-1;switch(t.type){case"date":n=o.dateSort;break;case"numeric":n=o.numericSort;break;default:n=o.defaultSort}return n(e,t)(r,a)}},search:"search"});window.HT=s,console.log(s,window.HT),this.set({hot:s}),e.hooks.add("afterSetDataAtCell",function(e,t,s,r){console.log("afterSetDataAtCell",e,t,s,r)}),e.hooks.add("afterColumnMove",function(r,a){if(r.length){var n=t.get().columnOrder,o=n.slice(0),i=n[a],c=o.splice(r[0],r.length),h=i?o.indexOf(i):o.length;o.splice.apply(o,[h,0].concat(c)),t.store.get("dw_chart").set("metadata.data.column-order",o.slice(0)),t.set({columnOrder:o}),e.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,h,s.countRows()-1,h+c.length-1)},10)}),t.update()}}),this.observe("data",function(){return t.update()}),this.observe("search",function(e){var r=s.search.query(e);t.set({searchResults:r}),s.render()}),this.observe("currentResult",function(e){e&&s&&(s.render(),s.scrollViewportTo(e.row,e.col),setTimeout(function(){s.scrollViewportTo(e.row,e.col)},100))})}.bind(this);r.root?this.root._oncreate.push(h):this._oncreate=[h],this._fragment=(this._state,i=this,{c:function(){c=o("div"),this.h()},h:function(){c.id="data-preview"},m:function(e,t){a(c,e,t),i.refs.hot=c},p:t,u:function(){n(c)},d:function(){i.refs.hot===c&&(i.refs.hot=null)}}),r.target&&(this._fragment.c(),this._fragment.m(r.target,r.anchor||null),g(this._oncreate))}function y(e){v(this,e),this._state=s({},e.data),this._fragment=function(e,t){var s,l,d,f,p;function _(){t.set({value:d.checked})}return{c:function(){s=o("div"),l=o("label"),d=o("input"),f=i("Â "),p=i(e.label),this.h()},h:function(){c(d,"change",_),d.type="checkbox",l.className="checkbox",u(l,"text-align","left"),u(l,"width","100%"),u(l,"position","relative"),u(l,"left","0"),s.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,n){a(s,t,n),r(l,s),r(d,l),d.checked=e.value,r(f,l),r(p,l)},p:function(e,t){d.checked=t.value,e.label&&(p.data=t.label)},u:function(){n(s)},d:function(){h(d,"change",_)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null))}s(I.prototype,w,R),I.prototype._recompute=function(e,t){(e.searchResults||e.searchIndex)&&f(t.currentResult,t.currentResult=function(e,t){if(!e||!e.length)return null;var s=e.length;if(t<0||t>=s){for(;t<0;)t+=s;t>s&&(t%=s)}return console.log(e[t]),e[t]}(t.searchResults,t.searchIndex))&&(e.currentResult=!0)},s(y.prototype,R);function x(e){!function(e,t,s){e.setAttribute(t,s)}(e,"svelte-771273718","")}function H(e,s){var r,o,c,h,u=e.searchIndexSafe+1,l=e.searchResults.length;return{c:function(){r=i(u),o=i(" of "),c=i(l),h=i(" cells matching")},m:function(e,t){a(r,e,t),a(o,e,t),a(c,e,t),a(h,e,t)},p:function(e,t){e.searchIndexSafe&&u!==(u=t.searchIndexSafe+1)&&(r.data=u),e.searchResults&&l!==(l=t.searchResults.length)&&(c.data=l)},u:function(){n(r),n(o),n(c),n(h)},d:t}}function k(e,s){var r;return{c:function(){r=i("No matches found")},m:function(e,t){a(r,e,t)},p:t,u:function(){n(r)},d:t}}function C(e){return e.searchResults.length>0?H:e.search?k:null}function N(e){v(this,e),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,searchResults:[]},e.data),this._recompute({searchIndex:1,searchResults:1},this._state);var t=function(){var e=this;console.log("chart",this.store.get("dw_chart")),window.addEventListener("keypress",function(t){console.log("event",t),t.ctrlKey&&"f"==t.key&&(console.log("search!"),t.preventDefault(),e.refs.search!=window.document.activeElement?e.refs.search.focus():e.nextResult(1))})}.bind(this);e.root?this.root._oncreate.push(t):(this._oncreate=[t],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){var u,l,d,f,p,_,v,m,g,R,w,b,H,k,N,S,T,L,O,D,P,E,M,A,F,j,V,q,K,$,B,z,G,J,Q,U,W,X,Y={},Z={},ee=!1,te={},se={label:"First row as label"};"firstRowIsHeader"in e&&(se.value=e.firstRowIsHeader,Y.value=!0);var re=new y({root:t.root,data:se,_bind:function(e,r){t.get();var a={};!Y.value&&e.value&&(a.firstRowIsHeader=r.value),Y=s({},e),t._set(a),Y={}}});t.root._beforecreate.push(function(){t.get();var e=re.get(),s={};e&&(Y.value||(s.firstRowIsHeader=e.value),Y={value:!0},t._set(s),Y={})});var ae={label:"transpose"};"transpose"in e&&(ae.value=e.transpose,Z.value=!0);var ne=new y({root:t.root,data:ae,_bind:function(e,r){t.get();var a={};!Z.value&&e.value&&(a.transpose=r.value),Z=s({},e),t._set(a),Z={}}});function oe(){ee=!0,t.set({search:k.value}),ee=!1}function ie(e){t.keyPress(e)}function ce(e){t.nextResult(-1)}function he(e){t.nextResult(1)}t.root._beforecreate.push(function(){t.get();var e=ne.get(),s={};e&&(Z.value||(s.transpose=e.value),Z={value:!0},t._set(s),Z={})});var ue=C(e),le=ue&&ue(e,t),de={};"chartData"in e&&(de.data=e.chartData,te.data=!0),"transpose"in e&&(de.transpose=e.transpose,te.transpose=!0),"firstRowIsHeader"in e&&(de.firstRowIsHeader=e.firstRowIsHeader,te.firstRowIsHeader=!0),"search"in e&&(de.search=e.search,te.search=!0),"searchResults"in e&&(de.searchResults=e.searchResults,te.searchResults=!0),"searchIndex"in e&&(de.searchIndex=e.searchIndex,te.searchIndex=!0);var fe=new I({root:t.root,data:de,_bind:function(e,r){t.get();var a={};!te.data&&e.data&&(a.chartData=r.data),!te.transpose&&e.transpose&&(a.transpose=r.transpose),!te.firstRowIsHeader&&e.firstRowIsHeader&&(a.firstRowIsHeader=r.firstRowIsHeader),!te.search&&e.search&&(a.search=r.search),!te.searchResults&&e.searchResults&&(a.searchResults=r.searchResults),!te.searchIndex&&e.searchIndex&&(a.searchIndex=r.searchIndex),te=s({},e),t._set(a),te={}}});function pe(e){t.toggleTranspose()}return t.root._beforecreate.push(function(){t.get();var e=fe.get(),s={};e&&(te.data||(s.chartData=e.data),te.transpose||(s.transpose=e.transpose),te.firstRowIsHeader||(s.firstRowIsHeader=e.firstRowIsHeader),te.search||(s.search=e.search),te.searchResults||(s.searchResults=e.searchResults),te.searchIndex||(s.searchIndex=e.searchIndex),te={data:!0,transpose:!0,firstRowIsHeader:!0,search:!0,searchResults:!0,searchIndex:!0},t._set(s),te={})}),{c:function(){u=o("div"),l=o("div"),d=o("div"),f=o("h3"),p=i("Make sure the data looks right"),_=i("\n\n            "),v=o("p"),m=i("Please make sure that Datawrapper interprets your data correctly. In the table number columns should be shown in blue, dates in green and text in black."),g=i("\n\n            "),re._fragment.c(),R=i("\n            "),ne._fragment.c(),w=i("\n        "),b=o("div"),H=o("div"),k=o("input"),N=i("\n                "),S=o("div"),(T=o("button")).innerHTML='<i class="fa fa-chevron-up"></i>',L=i("\n                  "),(O=o("button")).innerHTML='<i class="fa fa-chevron-down"></i>',D=i("\n\n            "),P=o("div"),le&&le.c(),E=i("\n\n            "),fe._fragment.c(),M=i("\n\n            "),A=o("div"),F=o("button"),j=i("Transpose dataset"),V=i("\n                "),q=o("button"),K=o("i"),$=i(" "),B=i("Add column"),z=i("..."),G=i("\n\n                "),J=o("button"),Q=o("i"),U=i(" "),W=i("Revert changes"),X=i("..."),this.h()},h:function(){f.className="first",d.className="span4",c(k,"input",oe),k.type="text",k.placeholder="Search data table",c(k,"keypress",ie),T.className="btn",c(T,"click",ce),O.className="btn",c(O,"click",he),S.className="btn-group",H.className="input-append",x(P),P.className="results",x(A),F.className="btn transpose",c(F,"click",pe),K.className="fa fa-calculator",q.className="btn computed-columns",Q.className="fa fa-undo",J.className="btn disabled",J.id="reset-data-changes",A.className="buttons below-table pull-right",b.className="span8",l.className="row",u.className="chart-editor"},m:function(s,n){a(u,s,n),r(l,u),r(d,l),r(f,d),r(p,f),r(_,d),r(v,d),r(m,v),r(g,d),re._mount(d,null),r(R,d),ne._mount(d,null),r(w,l),r(b,l),r(H,b),r(k,H),t.refs.search=k,k.value=e.search,r(N,H),r(S,H),r(T,S),r(L,S),r(O,S),r(D,b),r(P,b),le&&le.m(P,null),r(E,b),fe._mount(b,null),r(M,b),r(A,b),r(F,A),r(j,F),r(V,A),r(q,A),r(K,q),r($,q),r(B,q),r(z,q),r(G,A),r(J,A),r(Q,J),r(U,J),r(W,J),r(X,J)},p:function(e,s){var r={label:"First row as label"};!Y.value&&e.firstRowIsHeader&&(r.value=s.firstRowIsHeader,Y.value=!0),re._set(r),Y={};var a={};!Z.value&&e.transpose&&(a.value=s.transpose,Z.value=!0),ne._set(a),Z={},ee||(k.value=s.search),ue===(ue=C(s))&&le?le.p(e,s):(le&&(le.u(),le.d()),(le=ue&&ue(s,t))&&le.c(),le&&le.m(P,null));var n={};!te.data&&e.chartData&&(n.data=s.chartData,te.data=!0),!te.transpose&&e.transpose&&(n.transpose=s.transpose,te.transpose=!0),!te.firstRowIsHeader&&e.firstRowIsHeader&&(n.firstRowIsHeader=s.firstRowIsHeader,te.firstRowIsHeader=!0),!te.search&&e.search&&(n.search=s.search,te.search=!0),!te.searchResults&&e.searchResults&&(n.searchResults=s.searchResults,te.searchResults=!0),!te.searchIndex&&e.searchIndex&&(n.searchIndex=s.searchIndex,te.searchIndex=!0),fe._set(n),te={}},u:function(){n(u),le&&le.u()},d:function(){re.destroy(!1),ne.destroy(!1),h(k,"input",oe),h(k,"keypress",ie),t.refs.search===k&&(t.refs.search=null),h(T,"click",ce),h(O,"click",he),le&&le.d(),fe.destroy(!1),h(F,"click",pe)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,g(this._beforecreate),g(this._oncreate),g(this._aftercreate),this._lock=!1)}function S(e){this._observers={pre:l(),post:l()},this._changeHandlers=[],this._dependents=[],this._computed=l(),this._sortedComputedProperties=[],this._state=s({},e)}s(N.prototype,{nextResult:function(e){var t=this.get(),s=t.searchIndex,r=t.searchResults;(s+=e)<0&&(s+=r.length),s%=r.length,this.set({searchIndex:s})},keyPress:function(e){"F3"==e.key&&this.nextResult(e.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})}},R),N.prototype._recompute=function(e,t){var s,r;(e.searchIndex||e.searchResults)&&f(t.searchIndexSafe,t.searchIndexSafe=(s=t.searchIndex,r=t.searchResults,s<0&&(s+=r.length),s%=r.length))&&(e.searchIndexSafe=!0)},s(S.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},s=0;s<e.length;s+=1){var r=e[s];t["$"+r]=this._state[r]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,s=this._sortedComputedProperties=[],r=l();function a(n){if(e[n])throw new Error("Cyclical dependency detected");if(!r[n]){r[n]=!0;var o=t[n];o&&(e[n]=!0,o.deps.forEach(a),s.push(o))}}for(var n in this._computed)e=l(),a(n)},compute:function(e,t,s){var r,a={deps:t,update:function(a,n,o){var i=t.map(function(e){return e in n&&(o=!0),a[e]});if(o){var c=s.apply(null,i);f(c,r)&&(r=c,n[e]=!0,a[e]=r)}}};a.update(this._state,{},!0),this._computed[e]=a,this._sortComputedProperties()},get:_,observe:m,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var t=this._state,r=this._changed={},a=!1;for(var n in e){if(this._computed[n])throw new Error("'"+n+"' is a read-only property");f(e[n],t[n])&&(r[n]=a=!0)}if(a){this._state=s({},t,e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,r);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,r);p(this,this._observers.pre,r,this._state,t);var i=this._dependents.slice();for(o=0;o<i.length;o+=1){var c=i[o],h={};a=!1;for(var u=0;u<c.props.length;u+=1){var l=c.props[u];l in r&&(h["$"+l]=this._state[l],a=!0)}a&&c.component.set(h)}p(this,this._observers.post,r,this._state,t)}}});return{App:N,store:new S({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
