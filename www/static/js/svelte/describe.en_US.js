!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Handsontable")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable"],t):e.describe=t(e.HOT)}(this,function(e){"use strict";function t(){}function s(e){for(var t,s,a=arguments,r=1,n=arguments.length;r<n;r++)for(t in s=a[r])e[t]=s[t];return e}function a(e,t){t.appendChild(e)}function r(e,t,s){t.insertBefore(e,s)}function n(e){e.parentNode.removeChild(e)}function o(e){return document.createElement(e)}function i(e){return document.createTextNode(e)}function c(e,t,s){e.addEventListener(t,s,!1)}function h(e,t,s){e.removeEventListener(t,s,!1)}function u(e,t,s){e.style.setProperty(t,s)}function l(){return Object.create(null)}function d(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function f(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,s,a,r){for(var n in t)if(s[n]){var o=a[n],i=r[n],c=t[n];if(c)for(var h=0;h<c.length;h+=1){var u=c[h];u.__calling||(u.__calling=!0,u.call(e,o,i),u.__calling=!1)}}}function m(e){return e?this._state[e]:this._state}function _(e,t){e._observers={pre:l(),post:l()},e._handlers=l(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function v(e,t,s){var a=s&&s.defer?this._observers.post:this._observers.pre;return(a[e]||(a[e]=[])).push(t),s&&!1===s.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var s=a[e].indexOf(t);~s&&a[e].splice(s,1)}}}function g(e){for(;e&&e.length;)e.pop()()}e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:d,get:m,fire:function(e,t){var s=e in this._handlers&&this._handlers[e].slice();if(s)for(var a=0;a<s.length;a+=1)s[a].call(this,t)},observe:v,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var s=this._handlers[e]||(this._handlers[e]=[]);return s.push(t),{cancel:function(){var e=s.indexOf(t);~e&&s.splice(e,1)}}},set:function(e){this._set(s({},e)),this.root._lock||(this.root._lock=!0,g(this.root._beforecreate),g(this.root._oncreate),g(this.root._aftercreate),this.root._lock=!1)},teardown:d,_recompute:t,_set:function(e){var t=this._state,a={},r=!1;for(var n in e)f(e[n],t[n])&&(a[n]=r=!0);r&&(this._state=s({},t,e),this._recompute(a,this._state),this._bind&&this._bind(a,this._state),this._fragment&&(p(this,this._observers.pre,a,this._state,t),this._fragment.p(a,this._state),p(this,this._observers.post,a,this._state,t)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var w={update:function(){var t=this,s=this.get(),a=s.data,r=s.transpose,n=s.firstRowIsHeader,o=s.skipRows,i=s.hot;if(a){var c=this.store.get("dw_chart"),h=c.dataset(dw.datasource.delimited({csv:a,transpose:r,firstRowIsHeader:n,skipRows:o}).parse()).dataset();this.set({columnOrder:h.columnOrder()});var u=[[]];h.eachColumn(function(e){return u[0].push(e.title())}),h.eachRow(function(e){var t=[];h.eachColumn(function(s){return t.push(s.raw(e))}),u.push(t)}),i.loadData(u),i.updateSettings({cells:function(s,a){return{readOnly:t.get().readonly||h.numColumns()>a&&h.column(a).isComputed&&0===s,renderer:b(t,h,e,{})}},manualColumnMove:[]}),this.set({has_changes:c.get("metadata.data.changes",[]).length>0}),i.render()}}};function b(e,t,s,a){var r={date:"fa fa-clock-o"};return function(a,n,o,i,c,h,u){if(!(t.numColumns()<=i)){var l=t.column(i),d=e.get(),f=d.searchResults,p=d.currentResult;if((o=a.toPhysicalRow(o))>0)h=chart.columnFormatter(l)(l.val(o-1),!0);parseInt(h)<0&&n.classList.add("negative"),n.classList.add(l.type()+"Type"),"text"==l.type()&&h.length>70&&(h=h.substr(0,60)+"…"),0===o?(n.classList.add("firstRow"),r[l.type()]&&(h='<i class="'+r[l.type()]+'"></i> '+h)):n.classList.add(o%2?"oddRow":"evenRow"),f.forEach(function(e){e.row==o&&e.col==i&&n.classList.add("htSearchResult")}),p&&p.row==o&&p.col==i&&n.classList.add("htCurrentSearchResult"),o>0&&!l.type(!0).isValid(l.val(o-1))&&n.classList.add("parsingError"),u.readOnly&&n.classList.add("readOnly"),chart.dataCellChanged(i,o)&&n.classList.add("changed"),function(e,t,a,r,n,o,i){var c=dw.utils.purifyHtml(s.helper.stringify(o));t.innerHTML=c}(0,n,0,0,0,h)}}}function I(a){_(this,a),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,search:"",searchResults:[]},a.data),this._recompute({searchResults:1,searchIndex:1},this._state);var i,c,h=function(){var t=this,s=new e(this.refs.hot,{data:[],rowHeaders:function(e){return s.getPlugin("ColumnSorting").translateRow(e)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0},columnSorting:!0,sortIndicator:!0,sortFunction:function(e,t){return function(a,r){var n,o=s.getPlugin("columnSorting");if(0===a[0])return-1;switch(t.type){case"date":n=o.dateSort;break;case"numeric":n=o.numericSort;break;default:n=o.defaultSort}return n(e,t)(a,r)}},search:"search"});window.HT=s,this.set({hot:s}),e.hooks.add("afterSetDataAtCell",function(e){var a=!1;e.forEach(function(e){var r=e[0],n=e[1],o=e[2],i=e[3];if(o!=i){var c=t.store.get("dw_chart"),h=t.get().transpose,u=c.get("metadata.data.changes");if(r=s.toPhysicalRow(r),h){var l=r;r=n,n=l}u.push({row:r,column:n,value:i,time:(new Date).getTime()}),c.set("metadata.data.changes",u),a=!0}}),a&&setTimeout(function(){t.update(),chart.save()},100)}),e.hooks.add("afterColumnMove",function(a,r){if(a.length){var n=t.get().columnOrder,o=n.slice(0),i=n[r],c=o.splice(a[0],a.length),h=i?o.indexOf(i):o.length;o.splice.apply(o,[h,0].concat(c)),t.store.get("dw_chart").set("metadata.data.column-order",o.slice(0)),t.set({columnOrder:o}),e.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,h,s.countRows()-1,h+c.length-1)},10)}),t.update()}}),e.hooks.add("afterRender",function(){var e=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;t.refs.hot.style.height=Math.min(400,e+10)+"px"}),this.observe("data",function(){return t.update()}),this.observe("transpose",function(){return t.update()}),this.observe("firstRowIsHeader",function(){return t.update()}),this.observe("search",function(e){var a=s.search.query(e);t.set({searchResults:a}),s.render()}),this.observe("currentResult",function(e){e&&s&&(s.render(),s.scrollViewportTo(e.row,e.col),setTimeout(function(){s.scrollViewportTo(e.row,e.col)},100))})}.bind(this);a.root?this.root._oncreate.push(h):this._oncreate=[h],this._fragment=(this._state,i=this,{c:function(){c=o("div"),this.h()},h:function(){c.id="data-preview"},m:function(e,t){r(c,e,t),i.refs.hot=c},p:t,u:function(){n(c)},d:function(){i.refs.hot===c&&(i.refs.hot=null)}}),a.target&&(this._fragment.c(),this._fragment.m(a.target,a.anchor||null),g(this._oncreate))}function y(e){_(this,e),this._state=s({},e.data),this._fragment=function(e,t){var s,l,d,f,p;function m(){t.set({value:d.checked})}return{c:function(){s=o("div"),l=o("label"),d=o("input"),f=i(" "),p=i(e.label),this.h()},h:function(){c(d,"change",m),d.type="checkbox",l.className="checkbox",u(l,"text-align","left"),u(l,"width","100%"),u(l,"position","relative"),u(l,"left","0"),s.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,n){r(s,t,n),a(l,s),a(d,l),d.checked=e.value,a(f,l),a(p,l)},p:function(e,t){d.checked=t.value,e.label&&(p.data=t.label)},u:function(){n(s)},d:function(){h(d,"change",m)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null))}s(I.prototype,w,R),I.prototype._recompute=function(e,t){(e.searchResults||e.searchIndex)&&f(t.currentResult,t.currentResult=function(e,t){if(!e||!e.length)return null;var s=e.length;if(t<0||t>=s){for(;t<0;)t+=s;t>s&&(t%=s)}return e[t]}(t.searchResults,t.searchIndex))&&(e.currentResult=!0)},s(y.prototype,R);function x(e){!function(e,t,s){e.setAttribute(t,s)}(e,"svelte-1903720201","")}function H(e,t){var s,u,l,d;function f(e){t.nextResult(-1)}function p(e){t.nextResult(1)}return{c:function(){s=o("div"),(u=o("button")).innerHTML='<i class="fa fa-chevron-up"></i>',l=i("\n                      "),(d=o("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){x(u),u.className="btn",c(u,"click",f),x(d),d.className="btn",c(d,"click",p),s.className="btn-group"},m:function(e,t){r(s,e,t),a(u,s),a(l,s),a(d,s)},u:function(){n(s)},d:function(){h(u,"click",f),h(d,"click",p)}}}function k(e,s){var a,o,c,h,u,l,d,f=e.searchIndexSafe+1,p=e.searchResults.length;return{c:function(){a=i(f),o=i("\n                        "),c=i("of"),h=i("\n                        "),u=i(p),l=i("\n                        "),d=i("results")},m:function(e,t){r(a,e,t),r(o,e,t),r(c,e,t),r(h,e,t),r(u,e,t),r(l,e,t),r(d,e,t)},p:function(e,t){e.searchIndexSafe&&f!==(f=t.searchIndexSafe+1)&&(a.data=f),e.searchResults&&p!==(p=t.searchResults.length)&&(u.data=p)},u:function(){n(a),n(o),n(c),n(h),n(u),n(l),n(d)},d:t}}function C(e,s){var a;return{c:function(){a=i("No matches")},m:function(e,t){r(a,e,t)},p:t,u:function(){n(a)},d:t}}function N(e,t){var s,a=S(e),i=a&&a(e,t);return{c:function(){s=o("div"),i&&i.c(),this.h()},h:function(){x(s),s.className="results"},m:function(e,t){r(s,e,t),i&&i.m(s,null)},p:function(e,r){a===(a=S(r))&&i?i.p(e,r):(i&&(i.u(),i.d()),(i=a&&a(r,t))&&i.c(),i&&i.m(s,null))},u:function(){n(s),i&&i.u()},d:function(){i&&i.d()}}}function S(e){return e.searchResults.length>0?k:e.search?C:null}function T(e){_(this,e),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,searchResults:[]},e.data),this._recompute({searchIndex:1,searchResults:1},this._state);var t=function(){var e=this;window.addEventListener("keypress",function(t){t.ctrlKey&&"f"==t.key&&(t.preventDefault(),e.refs.search!=window.document.activeElement?e.refs.search.focus():e.nextResult(1))});var t=function(t,s){e.observe(t,function(t){e.store.get("dw_chart").set("metadata."+s,t)})};t("transpose","data.transpose"),t("firstRowIsHeader","data.horizontal-header")}.bind(this);e.root?this.root._oncreate.push(t):(this._oncreate=[t],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){var u,l,d,f,p,m,_,v,g,R,w,b,k,C,S,T,L,P,O,D,E,M,F,A,j,q,z,V,B,K,$,W,Z,G,J,Q,U,X,Y,ee,te,se,ae={},re=!1,ne={},oe={label:"First row as label"};"firstRowIsHeader"in e&&(oe.value=e.firstRowIsHeader,ae.value=!0);var ie=new y({root:t.root,data:oe,_bind:function(e,a){t.get();var r={};!ae.value&&e.value&&(r.firstRowIsHeader=a.value),ae=s({},e),t._set(r),ae={}}});function ce(e){t.toggleTranspose()}function he(){re=!0,t.set({search:A.value}),re=!1}function ue(e){t.keyPress(e)}t.root._beforecreate.push(function(){t.get();var e=ie.get(),s={};e&&(ae.value||(s.firstRowIsHeader=e.value),ae={value:!0},t._set(s),ae={})});var le=e.searchResults.length>0&&H(0,t),de=e.search&&N(e,t),fe={};"chartData"in e&&(fe.data=e.chartData,ne.data=!0),"transpose"in e&&(fe.transpose=e.transpose,ne.transpose=!0),"firstRowIsHeader"in e&&(fe.firstRowIsHeader=e.firstRowIsHeader,ne.firstRowIsHeader=!0),"search"in e&&(fe.search=e.search,ne.search=!0),"searchResults"in e&&(fe.searchResults=e.searchResults,ne.searchResults=!0),"searchIndex"in e&&(fe.searchIndex=e.searchIndex,ne.searchIndex=!0);var pe=new I({root:t.root,data:fe,_bind:function(e,a){t.get();var r={};!ne.data&&e.data&&(r.chartData=a.data),!ne.transpose&&e.transpose&&(r.transpose=a.transpose),!ne.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=a.firstRowIsHeader),!ne.search&&e.search&&(r.search=a.search),!ne.searchResults&&e.searchResults&&(r.searchResults=a.searchResults),!ne.searchIndex&&e.searchIndex&&(r.searchIndex=a.searchIndex),ne=s({},e),t._set(r),ne={}}});function me(e){t.revertChanges()}return t.root._beforecreate.push(function(){t.get();var e=pe.get(),s={};e&&(ne.data||(s.chartData=e.data),ne.transpose||(s.transpose=e.transpose),ne.firstRowIsHeader||(s.firstRowIsHeader=e.firstRowIsHeader),ne.search||(s.search=e.search),ne.searchResults||(s.searchResults=e.searchResults),ne.searchIndex||(s.searchIndex=e.searchIndex),ne={data:!0,transpose:!0,firstRowIsHeader:!0,search:!0,searchResults:!0,searchIndex:!0},t._set(s),ne={})}),t.refs.hot=pe,{c:function(){u=o("div"),l=o("div"),d=o("div"),f=o("div"),p=o("h3"),m=i("Make sure the data looks right"),_=i("\n\n                "),v=o("p"),g=i("Please make sure that Datawrapper interprets your data correctly. In the table number columns should be shown in blue, dates in green and text in black."),R=i("\n\n                "),ie._fragment.c(),w=i("\n\n                "),(b=o("div")).innerHTML='<a class="btn submit" href="upload"><i class="icon-chevron-left"></i> Zurück</a>\n                    <a href="visualize" class="submit btn btn-primary" id="describe-proceed">Weiter <i class="icon-chevron-right icon-white"></i></a>',k=i("\n        "),C=o("div"),S=o("button"),T=o("img"),L=i(" "),P=i("Swap rows and columns (transpose)"),O=i("\n\n            "),D=o("div"),E=o("i"),M=i("\n                "),F=o("div"),A=o("input"),q=i("\n                    "),le&&le.c(),z=i("\n\n                "),de&&de.c(),V=i("\n\n            "),pe._fragment.c(),B=i("\n\n            "),K=o("div"),$=o("button"),W=o("i"),Z=i(" "),G=i("Add column"),J=i("..."),Q=i("\n\n                "),U=o("button"),X=o("i"),Y=i(" "),ee=i("Revert changes"),te=i("..."),this.h()},h:function(){p.className="first",b.className="btn-group",f.className="sidebar",d.className="span4",x(C),x(S),x(T),T.src="/static/css/chart-editor/transpose.png",S.className="btn transpose",c(S,"click",ce),x(D),x(E),E.className="fa fa-search",x(A),c(A,"input",he),A.type="text",A.placeholder="Search data table",A.className=j=e.searchResults.length>0?"with-results":"",c(A,"keypress",ue),F.className="input-append",D.className="search-box pull-right",x(K),W.className="fa fa-calculator",$.className="btn computed-columns",x(U),X.className="fa fa-undo",U.className=se="btn "+(e.has_changes?"":"disabled"),U.id="reset-data-changes",c(U,"click",me),K.className="buttons below-table pull-right",C.className="span8",l.className="row",u.className="chart-editor"},m:function(s,n){r(u,s,n),a(l,u),a(d,l),a(f,d),a(p,f),a(m,p),a(_,f),a(v,f),a(g,v),a(R,f),ie._mount(f,null),a(w,f),a(b,f),a(k,l),a(C,l),a(S,C),a(T,S),a(L,S),a(P,S),a(O,C),a(D,C),a(E,D),a(M,D),a(F,D),a(A,F),t.refs.search=A,A.value=e.search,a(q,F),le&&le.m(F,null),a(z,D),de&&de.m(D,null),a(V,C),pe._mount(C,null),a(B,C),a(K,C),a($,K),a(W,$),a(Z,$),a(G,$),a(J,$),a(Q,K),a(U,K),a(X,U),a(Y,U),a(ee,U),a(te,U)},p:function(e,s){var a={label:"First row as label"};!ae.value&&e.firstRowIsHeader&&(a.value=s.firstRowIsHeader,ae.value=!0),ie._set(a),ae={},re||(A.value=s.search),e.searchResults&&j!==(j=s.searchResults.length>0?"with-results":"")&&(A.className=j),s.searchResults.length>0?le||((le=H(0,t)).c(),le.m(F,null)):le&&(le.u(),le.d(),le=null),s.search?de?de.p(e,s):((de=N(s,t)).c(),de.m(D,null)):de&&(de.u(),de.d(),de=null);var r={};!ne.data&&e.chartData&&(r.data=s.chartData,ne.data=!0),!ne.transpose&&e.transpose&&(r.transpose=s.transpose,ne.transpose=!0),!ne.firstRowIsHeader&&e.firstRowIsHeader&&(r.firstRowIsHeader=s.firstRowIsHeader,ne.firstRowIsHeader=!0),!ne.search&&e.search&&(r.search=s.search,ne.search=!0),!ne.searchResults&&e.searchResults&&(r.searchResults=s.searchResults,ne.searchResults=!0),!ne.searchIndex&&e.searchIndex&&(r.searchIndex=s.searchIndex,ne.searchIndex=!0),pe._set(r),ne={},e.has_changes&&se!==(se="btn "+(s.has_changes?"":"disabled"))&&(U.className=se)},u:function(){n(u),le&&le.u(),de&&de.u()},d:function(){ie.destroy(!1),h(S,"click",ce),h(A,"input",he),h(A,"keypress",ue),t.refs.search===A&&(t.refs.search=null),le&&le.d(),de&&de.d(),pe.destroy(!1),t.refs.hot===pe&&(t.refs.hot=null),h(U,"click",me)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,g(this._beforecreate),g(this._oncreate),g(this._aftercreate),this._lock=!1)}function L(e){this._observers={pre:l(),post:l()},this._changeHandlers=[],this._dependents=[],this._computed=l(),this._sortedComputedProperties=[],this._state=s({},e)}s(T.prototype,{nextResult:function(e){var t=this.get(),s=t.searchIndex,a=t.searchResults;(s+=e)<0&&(s+=a.length),s%=a.length,this.set({searchIndex:s})},keyPress:function(e){"F3"!=e.key&&"Enter"!=e.key||this.nextResult(e.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})},revertChanges:function(){var e=this.store.get("dw_chart");e.set("metadata.data.changes",[]),e.save(),this.refs.hot.update()}},R),T.prototype._recompute=function(e,t){var s,a;(e.searchIndex||e.searchResults)&&f(t.searchIndexSafe,t.searchIndexSafe=(s=t.searchIndex,a=t.searchResults,s<0&&(s+=a.length),s%=a.length))&&(e.searchIndexSafe=!0)},s(L.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},s=0;s<e.length;s+=1){var a=e[s];t["$"+a]=this._state[a]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,s=this._sortedComputedProperties=[],a=l();function r(n){if(e[n])throw new Error("Cyclical dependency detected");if(!a[n]){a[n]=!0;var o=t[n];o&&(e[n]=!0,o.deps.forEach(r),s.push(o))}}for(var n in this._computed)e=l(),r(n)},compute:function(e,t,s){var a,r={deps:t,update:function(r,n,o){var i=t.map(function(e){return e in n&&(o=!0),r[e]});if(o){var c=s.apply(null,i);f(c,a)&&(a=c,n[e]=!0,r[e]=a)}}};r.update(this._state,{},!0),this._computed[e]=r,this._sortComputedProperties()},get:m,observe:v,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var t=this._state,a=this._changed={},r=!1;for(var n in e){if(this._computed[n])throw new Error("'"+n+"' is a read-only property");f(e[n],t[n])&&(a[n]=r=!0)}if(r){this._state=s({},t,e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,a);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,a);p(this,this._observers.pre,a,this._state,t);var i=this._dependents.slice();for(o=0;o<i.length;o+=1){var c=i[o],h={};r=!1;for(var u=0;u<c.props.length;u+=1){var l=c.props[u];l in a&&(h["$"+l]=this._state[l],r=!0)}r&&c.component.set(h)}p(this,this._observers.post,a,this._state,t)}}});return{App:T,store:new L({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
