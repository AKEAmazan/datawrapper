!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("Handsontable"),require("cm/lib/codemirror"),require("cm/mode/javascript/javascript"),require("cm/addon/mode/simple"),require("cm/addon/hint/show-hint"),require("cm/addon/edit/matchbrackets"),require("cm/addon/display/placeholder")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable","cm/lib/codemirror","cm/mode/javascript/javascript","cm/addon/mode/simple","cm/addon/hint/show-hint","cm/addon/edit/matchbrackets","cm/addon/display/placeholder"],e):t.describe=e(t.HOT,t.CodeMirror)}(this,function(t,e){"use strict";function n(){}function o(t){for(var e,n,o=arguments,a=1,r=arguments.length;a<r;a++)for(e in n=o[a])t[e]=n[e];return t}function a(t,e){e.appendChild(t)}function r(t,e,n){e.insertBefore(t,n)}function s(t){t.parentNode.removeChild(t)}function i(t){for(;t.previousSibling;)t.parentNode.removeChild(t.previousSibling)}function u(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}function l(t){return document.createElement(t)}function c(t){return document.createTextNode(t)}function m(){return document.createComment("")}function d(t,e,n){t.addEventListener(e,n,!1)}function h(t,e,n){t.removeEventListener(e,n,!1)}function f(t,e,n){t.setAttribute(e,n)}function p(t,e,n){t.style.setProperty(e,n)}function v(t,e){for(var n=0;n<t.options.length;n+=1){var o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function g(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function _(){return Object.create(null)}function b(t){this.destroy=n,this.fire("destroy"),this.set=this.get=n,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function y(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function w(t,e){return t!=t?e==e:t!==e}function x(t,e,n,o,a){for(var r in e)if(n[r]){var s=o[r],i=a[r],u=e[r];if(u)for(var l=0;l<u.length;l+=1){var c=u[l];c.__calling||(c.__calling=!0,c.call(t,s,i),c.__calling=!1)}}}function C(t){return t?this._state[t]:this._state}function k(t,e){t._observers={pre:_(),post:_()},t._handlers=_(),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=t.root.store||e.store}function N(t,e,n){var o=n&&n.defer?this._observers.post:this._observers.pre;return(o[t]||(o[t]=[])).push(e),n&&!1===n.init||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var n=o[t].indexOf(e);~n&&o[t].splice(n,1)}}}function R(t){for(;t&&t.length;)t.shift()()}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var F={destroy:b,get:C,fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var o=0;o<n.length;o+=1)n[o].call(this,e)},observe:N,on:function(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(o({},t)),this.root._lock||(this.root._lock=!0,R(this.root._beforecreate),R(this.root._oncreate),R(this.root._aftercreate),this.root._lock=!1)},teardown:b,_recompute:n,_set:function(t){var e=this._state,n={},a=!1;for(var r in t)this._differs(t[r],e[r])&&(n[r]=a=!0);a&&(this._state=o({},e,t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(x(this,this._observers.pre,n,this._state,e),this._fragment.p(n,this._state),x(this,this._observers.post,n,this._state,e)))},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:y},I=null;var T={render:function(){this.get("hot").render()},update:function(){var e=this,n=this.get(),o=n.data,a=n.transpose,r=n.firstRowIsHeader,s=n.skipRows,i=n.hot;if(o){var u=this.store.get("dw_chart"),l=u.dataset(dw.datasource.delimited({csv:o,transpose:a,firstRowIsHeader:r,skipRows:s}).parse()).dataset();this.set({columnOrder:l.columnOrder()});var c=[[]];l.eachColumn(function(t){return c[0].push(t.title())}),l.eachRow(function(t){var e=[];l.eachColumn(function(n){return e.push(n.raw(t))}),c.push(e)}),i.loadData(c);var m=H(this,l,t);i.updateSettings({cells:function(t,n){return{readOnly:e.get().readonly||l.hasColumn(n)&&l.column(n).isComputed&&0===t,renderer:m}},manualColumnMove:[]}),this.set({ds:l}),this.set({has_changes:u.get("metadata.data.changes",[]).length>0}),t.hooks.once("afterRender",function(){return e.initCustomEvents()}),i.render()}},dataChanged:function(t){var e=this,n=this.get().hot,o=!1;t.forEach(function(t){var a=t[0],r=t[1],s=t[2],i=t[3];if(s!=i){var u=e.store.get("dw_chart"),l=e.get().transpose,c=u.get("metadata.data.changes",[]);if(a=n.toPhysicalRow(a),l){var m=a;a=r,r=m}c.push({column:r,row:a,value:i,time:(new Date).getTime()}),u.set("metadata.data.changes",c),o=!0}}),o&&setTimeout(function(){e.update(),chart.save()},100)},columnMoved:function(e,n){var o=this,a=this.get().hot;if(e.length){var r=this.get().columnOrder,s=r.slice(0),i=r[n],u=s.splice(e[0],e.length),l=i?s.indexOf(i):s.length;s.splice.apply(s,[l,0].concat(u)),this.store.get("dw_chart").set("metadata.data.column-order",s.slice(0)),this.set({columnOrder:s}),t.hooks.once("afterRender",function(){setTimeout(function(){o.fire("resetSort"),a.selectCell(0,l,a.countRows()-1,l+u.length-1)},10)}),this.update()}},updateHeight:function(){var t=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;this.refs.hot.style.height=Math.min(500,t+10)+"px"},checkRange:function(t,e,n,o){var a=this.get().hot;e==o&&0===t&&n==a.countRows()-1||this.set({activeColumn:null})},initCustomEvents:function(){var t=this;setTimeout(function(){t.refs.hot.querySelectorAll(".htCore thead th+th").forEach(function(t){t.removeEventListener("click",S),t.addEventListener("click",S)})},500)},getColumnFormat:function(t){return this.store.get("dw_chart").get("metadata.data.column-format",{})[t]||{type:"auto",ignore:!1}}};function H(t,e,n){var o={date:"fa fa-clock-o"};return function(a,r,s,i,u,l,c){if(!(e.numColumns()<=i)&&e.hasColumn(i)){var m=e.column(i),d=t.get(),h=d.searchResults,f=d.currentResult,p=d.activeColumn,v=t.getColumnFormat(m.name());if((s=a.toPhysicalRow(s))>0)l=chart.columnFormatter(m)(m.val(s-1),!0);parseInt(l)<0&&r.classList.add("negative"),r.classList.add(m.type()+"Type"),r.dataset.column=i,"text"==m.type()&&l&&l.length>70&&(l=l.substr(0,60)+"â€¦"),0===s?(r.classList.add("firstRow"),o[m.type()]&&(l='<i class="'+o[m.type()]+'"></i> '+l)):r.classList.add(s%2?"oddRow":"evenRow"),v.ignore&&r.classList.add("ignored"),p&&p.name()==m.name()&&r.classList.add("active");var g=a.getPlugin("columnSorting").untranslateRow(s);h.forEach(function(t){t.row==g&&t.col==i&&r.classList.add("htSearchResult")}),f&&f.row==g&&f.col==i&&r.classList.add("htCurrentSearchResult"),s>0&&!m.type(!0).isValid(m.val(s-1))&&r.classList.add("parsingError"),c.readOnly&&r.classList.add("readOnly"),chart.dataCellChanged(i,s)&&r.classList.add("changed"),function(t,e,o,a,r,s,i){var u=dw.utils.purifyHtml(n.helper.stringify(s));e.innerHTML=u}(0,r,0,0,0,l)}}}function S(t){for(var e=this.parentNode.children.length,n=-1,o=0;o<e;o++)if(this.parentNode.children.item(o)==this){n=o;break}var a=+I.refs.hot.querySelector(".htCore tbody tr:first-child td:nth-child("+(n+1)+")").dataset.column,r=I.store.get("dw_chart"),s=I.get(),i=s.activeColumn,u=s.hot;if(r.dataset().hasColumn(a)){var l=r.dataset().column(+a);i&&i.name()==l.name()?(t.target.parentNode.classList.remove("selected"),I.set({activeColumn:!1}),u.deselectCell()):(t.target.parentNode.classList.add("selected"),I.set({activeColumn:l}))}}function O(e){k(this,e),this.refs={},this._state=o({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,sortBy:"-",transpose:!1,activeColumn:null,search:"",searchResults:[]},e.data),this._recompute({searchResults:1,searchIndex:1},this._state);var a,i,u=function(){var e=this;I=this,t.hooks.once("afterRender",function(){return e.initCustomEvents()});var n=this.store.get("dw_chart"),o=new t(this.refs.hot,{data:[],rowHeaders:function(t){return o.getPlugin("ColumnSorting").translateRow(t)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:500,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0,syncLimit:5},columnSorting:!0,sortIndicator:!0,sortFunction:function(t,e){if(e.col>-1){var a=n.dataset().column(e.col),r=a.type(),s=o.getPlugin("columnSorting");return function(n,o){var i;if(0===n[0])return-1;switch(n[1]=a.val(n[0]-1),o[1]=a.val(o[0]-1),"number"==r&&(isNaN(n[1])&&(n[1]=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),isNaN(o[1])&&(o[1]=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY)),"date"==r&&("string"==typeof n[1]&&(n[1]=new Date(110,0,1)),"string"==typeof o[1]&&(o[1]=new Date(110,0,1))),r){case"date":i=s.dateSort;break;case"number":i=s.numericSort;break;default:i=s.defaultSort}return i(t,e)(n,o)}}return function(t,e){return t[0]-e[0]}},afterGetColHeader:function(t,n){var o=e.get(),a=o.activeColumn,r=o.ds;r&&r.hasColumn(t)&&((0===t||t)&&a&&r.column(t).name()==a.name()&&n.classList.add("selected"),(0===t||t)&&(e.getColumnFormat(r.column(t).name()).ignore?n.classList.add("ignored"):n.classList.remove("ignored")))},search:"search"});window.HT=o,this.set({hot:o}),t.hooks.add("afterSetDataAtCell",function(t){return e.dataChanged(t)}),t.hooks.add("afterColumnMove",function(t,n){return e.columnMoved(t,n)}),t.hooks.add("afterRender",function(){return e.updateHeight()}),t.hooks.add("afterSelection",function(t,n,o,a){return e.checkRange(t,n,o,a)}),this.observe("data",function(){return e.update()}),this.observe("firstRowIsHeader",function(t,n){t!=n&&void 0!==n&&e.update()}),this.observe("search",function(t){var n=o.search.query(t);e.set({searchResults:n}),o.render()}),this.observe("currentResult",function(t){t&&o&&(o.render(),o.scrollViewportTo(t.row,t.col),setTimeout(function(){o.scrollViewportTo(t.row,t.col)},100))}),this.observe("activeColumn",function(){setTimeout(function(){return o.render()},10)}),this.observe("sorting",function(t){o.sort(n.dataset().indexOf(t.sortBy),t.sortDir)})}.bind(this);e.root||(this._oncreate=[]),this._fragment=(a=this,this._state,{c:function(){i=l("div"),this.h()},h:function(){i.id="data-preview"},m:function(t,e){r(i,t,e),a.refs.hot=i},p:n,u:function(){s(i)},d:function(){a.refs.hot===i&&(a.refs.hot=null)}}),this.root._oncreate.push(u),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),R(this._oncreate))}function D(t){var e=typeof t;return"function"===e||"object"===e&&!!t}o(O.prototype,T,F),O.prototype._recompute=function(t,e){(t.searchResults||t.searchIndex)&&this._differs(e.currentResult,e.currentResult=function(t,e){if(!t||!t.length)return null;var n=t.length;if(e<0||e>=n){for(;e<0;)e+=n;e>n&&(e%=n)}return t[e]}(e.searchResults,e.searchIndex))&&(t.currentResult=!0)};var L,E=Array.prototype,q=Object.prototype,M=E.slice,P=q.toString,j=q.hasOwnProperty,A=Array.isArray,B=Object.keys;function $(t,e){return null!=t&&j.call(t,e)}function z(t){if(!D(t))return[];if(B)return B(t);var e=[];for(var n in t)$(t,n)&&e.push(n);return ut&&function(t,e){var n=lt.length,o=t.constructor,a=Y(o)&&o.prototype||q,r="constructor";$(t,r)&&!G(e,r)&&e.push(r);for(;n--;)(r=lt[n])in t&&t[r]!==a[r]&&!G(e,r)&&e.push(r)}(t,e),e}var V=function(t,e,n){return function(o,a,r){var s=0,i=st(o);if("number"==typeof r)t>0?s=r>=0?r:Math.max(r+i,s):i=r>=0?Math.min(r+1,i):r+i+1;else if(n&&r&&i)return r=n(o,a),o[r]===a?r:-1;if(a!=a)return(r=e(M.call(o,s,i),K))>=0?r+s:-1;for(r=t>0?s:i-1;r>=0&&r<i;r+=t)if(o[r]===a)return r;return-1}}(1,(L=1,function(t,e,n){e=nt(e,n);for(var o=st(t),a=L>0?0:o-1;a>=0&&a<o;a+=L)if(e(t[a],a,t))return a;return-1}),function(t,e,n,o){for(var a=(n=nt(n,o,1))(e),r=0,s=st(t);r<s;){var i=Math.floor((r+s)/2);n(t[i])<a?r=i+1:s=i}return r});function G(t,e,n,o){return it(t)||(t=function(t){for(var e=z(t),n=e.length,o=Array(n),a=0;a<n;a++)o[a]=t[e[a]];return o}(t)),("number"!=typeof n||o)&&(n=0),V(t,e,n)>=0}var J=A||function(t){return"[object Array]"===P.call(t)};var Y=("function"!=typeof/./&&"object"!=typeof Int8Array&&"undefined"!=typeof document&&"function"!=typeof document.childNodes?function(t){return"function"==typeof t||!1}:null)||function(t){return"[object Function]"===P.call(t)};!function(){P.call(arguments)}();function K(t){return function(t){return"[object Number]"===P.call(t)}(t)&&isNaN(t)}var U=et;function W(t){return t}var Q,X,Z=(Q=z,function(t){var e=arguments,n=arguments.length;if(X&&(t=Object(t)),n<2||null==t)return t;for(var o=1;o<n;o++)for(var a=e[o],r=Q(a),s=r.length,i=0;i<s;i++){var u=r[i];!D(t)||X&&void 0!==t[u]||(t[u]=a[u])}return t});function tt(t){return t=Z({},t),function(e){return function(t,e){var n=z(e),o=n.length;if(null==t)return!o;for(var a=Object(t),r=0;r<o;r++){var s=n[r];if(e[s]!==a[s]||!(s in a))return!1}return!0}(e,t)}}function et(t,e){return nt(t,e,1/0)}function nt(t,e,n){return U!==et?U(t,e):null==t?W:Y(t)?function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,o,a){return t.call(e,n,o,a)};case 4:return function(n,o,a,r){return t.call(e,n,o,a,r)}}return function(){return t.apply(e,arguments)}}(t,e,n):D(t)?tt(t):at(t)}function ot(t,e){return e=null==e?t.length-1:+e,function(){for(var n=arguments,o=Math.max(arguments.length-e,0),a=Array(o),r=0;r<o;r++)a[r]=n[r+e];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,arguments[0],a);case 2:return t.call(this,arguments[0],arguments[1],a)}var s=Array(e+1);for(r=0;r<e;r++)s[r]=n[r];return s[e]=a,t.apply(this,s)}}function at(t){return function(e){return null==e?void 0:e[t]}}var rt=Math.pow(2,53)-1,st=at("length"),it=function(t){var e=st(t);return"number"==typeof e&&e>=0&&e<=rt};var ut=!{toString:null}.propertyIsEnumerable("toString"),lt=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];!function(t){for(var e={},n=z(t),o=0,a=n.length;o<a;o++)e[t[n[o]]]=n[o]}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"});var ct=ot(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)});function mt(t){if(!t||"object"!=typeof t)return t;try{return JSON.parse(JSON.stringify(t))}catch(e){return t}}var dt={insert:function(t){var e=this.get().cm;e.replaceSelection(t.key),e.focus()},removeColumn:function(){var t=this.get().column,e=this.store.get("dw_chart"),n=e.dataset(),o=mt(e.get("metadata.describe.computed-columns",{}));delete o[t.name()];var a=n.columnOrder()[n.indexOf(t.name())],r=[];e.get("metadata.data.changes",[]).forEach(function(t){t.column!=a&&(t.column>a&&t.column--,r.push(t))}),e.set("metadata.describe.computed-columns",o),e.set("metadata.data.changes",r),e.saveSoon(),this.fire("updateTable"),this.fire("unselect")}};function ht(){var t=this,n=this.get().column,o=this.store.get("dw_chart"),a=o.get("metadata.describe.computed-columns",{});this.set({formula:a[n.name()]||"",name:n.title()}),this.observe("column",function(e){e&&t.set({formula:a[e.name()]||"",name:e.title()})});var r=this;var s=e.fromTextArea(this.refs.code,{value:this.get("formula")||"",mode:"simple",indentUnit:2,tabSize:2,lineWrapping:!0,matchBrackets:!0,placeholder:"// enter formula here",continueComments:"Enter",extraKeys:{Tab:"autocomplete"},hintOptions:{hint:function(t){var n=t.getCursor(),o=t.getTokenAt(n),a=[],s=r.get("keywords");return"variable"==o.type&&(a=s.filter(function(t){return 0===t.toLowerCase().indexOf(o.string.toLowerCase())})),{list:a,from:e.Pos(n.line,o.start),to:e.Pos(n.line,o.end)}}}});window.CodeMirror=e,this.set({cm:s});var i,u,l,c,m,d,h,f=(i=function(){return t.fire("updateTable")},u=1500,d=function(t,e){c=null,e&&(m=i.apply(t,e))},(h=ot(function(t){if(c&&clearTimeout(c),l){var e=!c;c=setTimeout(d,u),e&&(m=i.apply(this,t))}else c=ct(d,u,this,t);return m})).cancel=function(){clearTimeout(c),c=null},h);this.observe("formula",function(e){e!=s.getValue()&&s.setValue(e);var n=t.get().column,a=o.get("metadata.describe.computed-columns",{});a[n.name()]!=e&&(a[n.name()]=e,o.set("metadata.describe.computed-columns",a),o.saveSoon&&o.saveSoon(),f())}),this.observe("name",function(e){var n=t.get().column,a=o.get("metadata.data.changes",[]),r=o.dataset(),s=r.columnOrder()[r.indexOf(n.name())],i=-1;a.forEach(function(t,e){t.column==s&&0===t.row&&(i=e)}),i>-1?(a[i].value=e,a[i].time=(new Date).getTime()):a.push({column:s,row:0,value:e,time:(new Date).getTime()}),o.set("metadata.data.changes",a),o.saveSoon&&o.saveSoon(),f()}),s.on("change",function(e){t.set({formula:e.getValue()})}),this.observe("metaColumns",function(n){var o=new RegExp("(?:"+t.get("keywords").join("|")+")");e.defineSimpleMode("simplemode",{start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/(function)(\s+)([a-z$][\w$]*)/,token:["keyword",null,"keyword"]},{regex:/(?:function|var|return|if|for|while|else|do|this)\b/,token:"keyword"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\/\/.*/,token:"comment"},{regex:/\/(?:[^\\]|\\.)*?\//,token:"variable-3"},{regex:/\/\*/,token:"comment",next:"comment"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:o,token:"variable-2"},{regex:/[a-z$][\w$]*/,token:"variable"},{regex:/<</,token:"meta",mode:{spec:"xml",end:/>>/}}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],lineComment:"//"}}),s.setOption("mode","simplemode")})}function ft(t,e){var n,o,i=e.col,u=(e.col_index,i.key);return{c:function(){n=l("li"),o=c(u),this.h()},h:function(){n.className="svelte-du6ec3",d(n,"click",pt),n._svelte={component:t,metaColumns:e.metaColumns,col_index:e.col_index}},m:function(t,e){r(n,t,e),a(o,n)},p:function(t,e){i=e.col,e.col_index,t.metaColumns&&u!==(u=i.key)&&(o.data=u),n._svelte.metaColumns=e.metaColumns,n._svelte.col_index=e.col_index},u:function(){s(n)},d:function(){h(n,"click",pt)}}}function pt(t){var e=this._svelte.component,n=this._svelte.metaColumns[this._svelte.col_index];e.insert(n)}function vt(t){k(this,t),this.refs={},this._state=o({name:"",formula:""},t.data),this._recompute({column:1,columns:1,metaColumns:1},this._state);var e=ht.bind(this);t.root||(this._oncreate=[]),this._fragment=function(t,e){var n,i,m,f,v,g,_,b,y,w,x,C,k,N,R,F,I,T,H,S,O,D,L,E,q,M,P,j,A,B=!1;function $(){B=!0,t.set({name:x.value}),B=!1}for(var z=e.metaColumns,V=[],G=0;G<z.length;G+=1)V[G]=ft(t,o({},e,{metaColumns:z,col:z[G],col_index:G}));function J(e){t.removeColumn()}return{c:function(){n=l("div"),i=l("h3"),m=c(e.title),f=c("\n    "),v=l("p"),g=c("The values for columns can be calculated using a formula, similar to Excel."),_=c("\n\n    "),b=l("label"),y=c("Column name"),w=c("\n    "),x=l("input"),C=c("\n\n    "),k=l("label"),N=c("Formula (JavaScript)"),R=c("\n    "),F=l("textarea"),I=c("\n\n    "),T=l("p"),H=c("Available columns (click to add them to the formula)"),S=c(":"),O=c("\n\n    "),D=l("ul");for(var t=0;t<V.length;t+=1)V[t].c();L=c("\n    "),E=l("hr"),q=c("\n    "),M=l("button"),P=l("i"),j=c(" "),A=c("Remove this column"),this.h()},h:function(){i.className="first",b.className="svelte-du6ec3",d(x,"input",$),x.type="text",k.className="svelte-du6ec3",F.className="code",p(T,"margin-top","1em"),D.className="col-select svelte-du6ec3",P.className="fa fa-trash",M.className="btn btn-danger",d(M,"click",J)},m:function(o,s){r(n,o,s),a(i,n),a(m,i),a(f,n),a(v,n),a(g,v),a(_,n),a(b,n),a(y,b),a(w,n),a(x,n),x.value=e.name,a(C,n),a(k,n),a(N,k),a(R,n),a(F,n),t.refs.code=F,a(I,n),a(T,n),a(H,T),a(S,T),a(O,n),a(D,n);for(var u=0;u<V.length;u+=1)V[u].m(D,null);a(L,n),a(E,n),a(q,n),a(M,n),a(P,M),a(j,M),a(A,M)},p:function(e,n){e.title&&(m.data=n.title),B||(x.value=n.name);var a=n.metaColumns;if(e.metaColumns){for(var r=0;r<a.length;r+=1){var s=o({},n,{metaColumns:a,col:a[r],col_index:r});V[r]?V[r].p(e,s):(V[r]=ft(t,s),V[r].c(),V[r].m(D,null))}for(;r<V.length;r+=1)V[r].u(),V[r].d();V.length=a.length}},u:function(){s(n);for(var t=0;t<V.length;t+=1)V[t].u()},d:function(){h(x,"input",$),t.refs.code===F&&(t.refs.code=null),u(V),h(M,"click",J)}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),R(this._oncreate))}function gt(t){k(this,t),this._state=o({disabled:!1},t.data),this._fragment=function(t,e){var n,o,i,u,m,f;function p(){t.set({value:i.checked})}return{c:function(){n=l("div"),o=l("label"),i=l("input"),u=c("Â "),m=c(e.label),this.h()},h:function(){d(i,"change",p),i.type="checkbox",i.disabled=e.disabled,i.className="svelte-llolt7",o.className=f="checkbox "+(e.disabled?"disabled":"")+" svelte-llolt7",n.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,s){r(n,t,s),a(o,n),a(i,o),i.checked=e.value,a(u,o),a(m,o)},p:function(t,e){i.checked=e.value,t.disabled&&(i.disabled=e.disabled),t.label&&(m.data=e.label),t.disabled&&f!==(f="checkbox "+(e.disabled?"disabled":"")+" svelte-llolt7")&&(o.className=f)},u:function(){s(n)},d:function(){h(i,"change",p)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function _t(t,e){var o,i,u,m=e.opt,d=(e.opt_index,m.label);return{c:function(){o=l("option"),i=c(d),this.h()},h:function(){o.__value=u=m.value,o.value=o.__value},m:function(t,e){r(o,t,e),a(i,o)},p:function(t,e){m=e.opt,e.opt_index,t.options&&d!==(d=m.label)&&(i.data=d),t.options&&u!==(u=m.value)&&(o.__value=u),o.value=o.__value},u:function(){s(o)},d:n}}function bt(t,e){for(var n,a=e.options,i=[],l=0;l<a.length;l+=1)i[l]=_t(0,o({},e,{options:a,opt:a[l],opt_index:l}));return{c:function(){for(var t=0;t<i.length;t+=1)i[t].c();n=m()},m:function(t,e){for(var o=0;o<i.length;o+=1)i[o].m(t,e);r(n,t,e)},p:function(t,e){var a=e.options;if(t.options){for(var r=0;r<a.length;r+=1){var s=o({},e,{options:a,opt:a[r],opt_index:r});i[r]?i[r].p(t,s):(i[r]=_t(0,s),i[r].c(),i[r].m(n.parentNode,n))}for(;r<i.length;r+=1)i[r].u(),i[r].d();i.length=a.length}},u:function(){for(var t=0;t<i.length;t+=1)i[t].u();s(n)},d:function(){u(i)}}}function yt(t,e){for(var n,a,i=e.optgroup,c=(e.optgroup_index,i.options),m=[],d=0;d<c.length;d+=1)m[d]=wt(t,o({},e,{options:c,opt:c[d],opt_index:d}));return{c:function(){n=l("optgroup");for(var t=0;t<m.length;t+=1)m[t].c();this.h()},h:function(){f(n,"label",a=i.label)},m:function(t,e){r(n,t,e);for(var o=0;o<m.length;o+=1)m[o].m(n,null)},p:function(e,r){i=r.optgroup,r.optgroup_index;var s=i.options;if(e.optgroups){for(var u=0;u<s.length;u+=1){var l=o({},r,{options:s,opt:s[u],opt_index:u});m[u]?m[u].p(e,l):(m[u]=wt(t,l),m[u].c(),m[u].m(n,null))}for(;u<m.length;u+=1)m[u].u(),m[u].d();m.length=s.length}e.optgroups&&a!==(a=i.label)&&f(n,"label",a)},u:function(){s(n);for(var t=0;t<m.length;t+=1)m[t].u()},d:function(){u(m)}}}function wt(t,e){e.optgroup;var o,i,u,m=e.opt,d=(e.optgroup_index,e.opt_index,m.label);return{c:function(){o=l("option"),i=c(d),this.h()},h:function(){o.__value=u=m.value,o.value=o.__value},m:function(t,e){r(o,t,e),a(i,o)},p:function(t,e){e.optgroup,m=e.opt,e.optgroup_index,e.opt_index,t.optgroups&&d!==(d=m.label)&&(i.data=d),t.optgroups&&u!==(u=m.value)&&(o.__value=u),o.value=o.__value},u:function(){s(o)},d:n}}function xt(t,e){for(var n,a=e.optgroups,i=[],l=0;l<a.length;l+=1)i[l]=yt(t,o({},e,{optgroups:a,optgroup:a[l],optgroup_index:l}));return{c:function(){for(var t=0;t<i.length;t+=1)i[t].c();n=m()},m:function(t,e){for(var o=0;o<i.length;o+=1)i[o].m(t,e);r(n,t,e)},p:function(e,a){var r=a.optgroups;if(e.optgroups){for(var s=0;s<r.length;s+=1){var u=o({},a,{optgroups:r,optgroup:r[s],optgroup_index:s});i[s]?i[s].p(e,u):(i[s]=yt(t,u),i[s].c(),i[s].m(n.parentNode,n))}for(;s<i.length;s+=1)i[s].u(),i[s].d();i.length=r.length}},u:function(){for(var t=0;t<i.length;t+=1)i[t].u();s(n)},d:function(){u(i)}}}function Ct(t){k(this,t),this._state=o({disabled:!1,width:"auto",options:[],optgroups:[]},t.data),t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){var n,o,i,u,f,_,b,y=!1,w=e.options.length&&bt(0,e),x=e.optgroups.length&&xt(t,e);function C(){y=!0,t.set({value:g(f)}),y=!1}return{c:function(){n=l("div"),o=l("label"),i=c("\n\n    "),u=l("div"),f=l("select"),w&&w.c(),_=m(),x&&x.c(),this.h()},h:function(){o.className="control-label",d(f,"change",C),"value"in e||t.root._beforecreate.push(C),f.disabled=e.disabled,p(f,"width",e.width),u.className=b="controls form-inline "+(e.disabled?"disabled":""),n.className="control-group vis-option-type-select"},m:function(t,s){r(n,t,s),a(o,n),o.innerHTML=e.label,a(i,n),a(u,n),a(f,u),w&&w.m(f,null),a(_,f),x&&x.m(f,null),v(f,e.value)},p:function(e,n){e.label&&(o.innerHTML=n.label),n.options.length?w?w.p(e,n):((w=bt(0,n)).c(),w.m(f,_)):w&&(w.u(),w.d(),w=null),n.optgroups.length?x?x.p(e,n):((x=xt(t,n)).c(),x.m(f,null)):x&&(x.u(),x.d(),x=null),y||v(f,n.value),e.disabled&&(f.disabled=n.disabled),e.width&&p(f,"width",n.width),e.disabled&&b!==(b="controls form-inline "+(n.disabled?"disabled":""))&&(u.className=b)},u:function(){o.innerHTML="",s(n),w&&w.u(),x&&x.u()},d:function(){w&&w.d(),x&&x.d(),h(f,"change",C)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),R(this._beforecreate))}o(vt.prototype,dt,F),vt.prototype._recompute=function(t,e){var n,o;t.column&&this._differs(e.title,e.title=(n=e.column,"Edit column %s".replace("%s",'"'+(n?n.title()||n.name():"--")+'"')))&&(t.title=!0),t.columns&&this._differs(e.metaColumns,e.metaColumns=(o=e.columns)?o.map(function(t){return{key:(e=t.name(),e.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/-/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/^(abstract|arguments|await|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|eval|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|let|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var|void|volatile|while|window|with|yield)$/,"$1_")),title:t.title(),type:t.type()};var e}):[])&&(t.metaColumns=!0),t.metaColumns&&this._differs(e.keywords,e.keywords=function(t){var e=["sum","round","min","max","median","mean"];return t.forEach(function(t){e.push(t.key),"number"==t.type&&(e.push(t.key+"__sum"),e.push(t.key+"__min"),e.push(t.key+"__max"),e.push(t.key+"__mean"),e.push(t.key+"__median"))}),e}(e.metaColumns))&&(t.keywords=!0)},o(gt.prototype,F),o(Ct.prototype,F);var kt=Date.now||function(){return(new Date).getTime()};function Nt(t,e,n){var o,a,r,s,i=0;n||(n={});var u=function(){i=!1===n.leading?0:kt(),o=null,s=t.apply(a,r),o||(a=r=null)},l=function(){var l=kt();i||!1!==n.leading||(i=l);var c=e-(l-i);return a=this,r=arguments,c<=0||c>e?(o&&(clearTimeout(o),o=null),i=l,s=t.apply(a,r),o||(a=r=null)):o||!1===n.trailing||(o=setTimeout(u,c)),s};return l.cancel=function(){clearTimeout(o),i=0,o=a=r=null},l}function Rt(t){if(J(t)){var e={};return Object.keys(t).forEach(function(n){return e[n]=t[n]}),e}return t}var Ft={autoFormat:function(){var t=this.store.get("dw_chart"),e=this.get().column,n=dw.utils.metricSuffix(t.locale()),o=e.values(),a=dw.utils.significantDimension(o),r=a<-2?3*Math.round(-1*a/3):a>4?-1*a:0,s=o.map(function(t){return t/Math.pow(10,r)}),i=dw.utils.significantDimension(s);i<=0&&(i=s.reduce(function(t,e){return Math.max(t,Math.min(3,dw.utils.tailLength(e)))},0)),i==r&&(r=0,i=0),r>15&&(r=0,i=0),this.set({columnFormat:{"number-divisor":r,"number-format":"n"+Math.max(0,i),"number-prepend":"","number-append":r?n[r]||" Ã— 10<sup>"+r+"</sup>":""}})},getColumnFormat:function(t){var e=mt(Rt(this.store.get("dw_chart").get("metadata.data.column-format",{}))[t.name()]);return e&&"auto"!=e&&void 0===e.length||(e={type:"auto",ignore:!1,"number-prepend":"","number-append":""}),e}};function It(t,e){var n,o,i,u,m,f,v,g,_,b,y,w,x,C,k,N,R,F={},I={},T=!1,H=!1,S={label:"Divide/multiply by",options:e.divisors_opts,optgroups:e.divisors,width:"180px"};"number-divisor"in e.columnFormat&&(S.value=e.columnFormat["number-divisor"],F.value=!0);var O=new Ct({root:t.root,data:S,_bind:function(e,n){var o=t.get(),a={};!F.value&&e.value&&(o.columnFormat["number-divisor"]=n.value,a.columnFormat=o.columnFormat),t._set(a),F={}}});t.root._beforecreate.push(function(){O._bind({value:1},O.get())});var D={label:"Round numbers to",options:[{value:"-",label:"-"}],optgroups:e.numberFormats,width:"180px"};"number-format"in e.columnFormat&&(D.value=e.columnFormat["number-format"],I.value=!0);var L=new Ct({root:t.root,data:D,_bind:function(e,n){var o=t.get(),a={};!I.value&&e.value&&(o.columnFormat["number-format"]=n.value,a.columnFormat=o.columnFormat),t._set(a),I={}}});function E(){var e=t.get();T=!0,e.columnFormat["number-prepend"]=g.value,t.set({columnFormat:e.columnFormat}),T=!1}function q(){var e=t.get();H=!0,e.columnFormat["number-append"]=b.value,t.set({columnFormat:e.columnFormat}),H=!1}function M(e){t.autoFormat()}return t.root._beforecreate.push(function(){L._bind({value:1},L.get())}),{c:function(){O._fragment.c(),n=c("\n        "),L._fragment.c(),o=c("\n        "),i=l("div"),u=l("label"),m=c("Prepend/append"),f=c("\n            "),v=l("div"),g=l("input"),_=c("\n                #\n                "),b=l("input"),y=c("\n\n        "),w=l("button"),x=l("i"),C=c(" "),k=c("Automatic format"),N=c("\n        "),R=l("hr"),this.h()},h:function(){u.className="control-label",d(g,"input",E),p(g,"width","6ex"),p(g,"text-align","right"),g.dataset.lpignore="true",g.name="prepend",g.type="text",d(b,"input",q),p(b,"width","6ex"),b.dataset.lpignore="true",b.name="append",b.type="text",v.className="controls form-inline",i.className="control-group vis-option-type-select",x.className="fa fa-magic",w.className="btn btn-small",d(w,"click",M)},m:function(t,s){O._mount(t,s),r(n,t,s),L._mount(t,s),r(o,t,s),r(i,t,s),a(u,i),a(m,u),a(f,i),a(v,i),a(g,v),g.value=e.columnFormat["number-prepend"],a(_,v),a(b,v),b.value=e.columnFormat["number-append"],r(y,t,s),r(w,t,s),a(x,w),a(C,w),a(k,w),r(N,t,s),r(R,t,s)},p:function(t,e){var n={label:"Divide/multiply by"};t.divisors_opts&&(n.options=e.divisors_opts),t.divisors&&(n.optgroups=e.divisors),!F.value&&t.columnFormat&&(n.value=e.columnFormat["number-divisor"],F.value=!0),O._set(n),F={};var o={label:"Round numbers to",options:[{value:"-",label:"-"}]};t.numberFormats&&(o.optgroups=e.numberFormats),!I.value&&t.columnFormat&&(o.value=e.columnFormat["number-format"],I.value=!0),L._set(o),I={},T||(g.value=e.columnFormat["number-prepend"]),H||(b.value=e.columnFormat["number-append"])},u:function(){O._unmount(),s(n),L._unmount(),s(o),s(i),s(y),s(w),s(N),s(R)},d:function(){O.destroy(!1),L.destroy(!1),h(g,"input",E),h(b,"input",q),h(w,"click",M)}}}function Tt(t){k(this,t),this._state=o({columnFormat:{type:"auto",ignore:!1,"number-divisor":"auto","number-prepend":"","number-append":""},colTypes:[],divisors_opts:[{value:0,label:"-"}],divisors:[{label:"divide by",options:[{value:3,label:"1000"},{value:6,label:"1 million"},{value:9,label:"1 billion"}]},{label:"multiply by",options:[{value:-2,label:"100"},{value:-3,label:"1000"},{value:-6,label:"1 million"},{value:-9,label:"1 billion"},{value:-12,label:"1 trillion"}]}],numberFormats:[{label:"Decimal places",options:[{value:"n3",label:"3 (1,234.568)"},{value:"n2",label:"2 (1,234.57)"},{value:"n1",label:"1 (1,234.6)"},{value:"n0",label:"0 (1,235)"}]},{label:"Significant digits",options:[{value:"s6",label:"6 (1,234.57)"},{value:"s5",label:"5 (123.45)"},{value:"s4",label:"4 (12.34)"},{value:"s3",label:"3 (1.23)"},{value:"s2",label:"2 (0.12)"},{value:"s1",label:"1 (0.01)"}]}]},t.data),this._recompute({column:1},this._state);var e=function(){var t=this,e=Nt(function(){t.fire("updateTable")},100,{leading:!1}),n=Nt(function(){t.fire("updateTable")},100,{leading:!1}),o=this.get().column;this.set({colTypes:[{value:"auto",label:"auto ("+o.type()+")"},{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"}]}),this.set({columnFormat:this.getColumnFormat(o)}),this.observe("column",function(e){t.set({columnFormat:t.getColumnFormat(e)}),t.get().colTypes[0].label="auto ("+o.type()+")"}),this.observe("columnFormat",function(o){var a=t.store.get("dw_chart"),r=t.get().column,s=Rt(a.get("metadata.data.column-format",{})),i=s[r.name()];i&&JSON.stringify(i)==JSON.stringify(o)||(s[r.name()]=mt(o),a.set("metadata.data.column-format",s),a.saveSoon&&a.saveSoon(),i&&i.type==o.type?n():e())})}.bind(this);t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){var n,o,i,u,m,d,h,f,p,v={},g={},_={label:"Column type",options:e.colTypes,width:"180px"};"type"in e.columnFormat&&(_.value=e.columnFormat.type,v.value=!0);var b=new Ct({root:t.root,data:_,_bind:function(e,n){var o=t.get(),a={};!v.value&&e.value&&(o.columnFormat.type=n.value,a.columnFormat=o.columnFormat),t._set(a),v={}}});t.root._beforecreate.push(function(){b._bind({value:1},b.get())});var y=e.column&&"number"==e.column.type()&&It(t,e),w={label:"Hide column from visualization"};"ignore"in e.columnFormat&&(w.value=e.columnFormat.ignore,g.value=!0);var x=new gt({root:t.root,data:w,_bind:function(e,n){var o=t.get(),a={};!g.value&&e.value&&(o.columnFormat.ignore=n.value,a.columnFormat=o.columnFormat),t._set(a),g={}}});return t.root._beforecreate.push(function(){x._bind({value:1},x.get())}),{c:function(){n=l("div"),o=l("h3"),i=c(e.title),u=c("\n\n    "),m=l("div"),b._fragment.c(),d=c("\n\n        "),h=l("hr"),f=c("\n\n        "),y&&y.c(),p=c("\n\n\n        "),x._fragment.c(),this.h()},h:function(){o.className="first",m.className="form-horizontal"},m:function(t,e){r(n,t,e),a(o,n),a(i,o),a(u,n),a(m,n),b._mount(m,null),a(d,m),a(h,m),a(f,m),y&&y.m(m,null),a(p,m),x._mount(m,null)},p:function(e,n){e.title&&(i.data=n.title);var o={label:"Column type"};e.colTypes&&(o.options=n.colTypes),!v.value&&e.columnFormat&&(o.value=n.columnFormat.type,v.value=!0),b._set(o),v={},n.column&&"number"==n.column.type()?y?y.p(e,n):((y=It(t,n)).c(),y.m(m,p)):y&&(y.u(),y.d(),y=null);var a={label:"Hide column from visualization"};!g.value&&e.columnFormat&&(a.value=n.columnFormat.ignore,g.value=!0),x._set(a),g={}},u:function(){s(n),y&&y.u()},d:function(){b.destroy(!1),y&&y.d(),x.destroy(!1)}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,R(this._beforecreate),R(this._oncreate),R(this._aftercreate),this._lock=!1)}o(Tt.prototype,Ft,F),Tt.prototype._recompute=function(t,e){var n;t.column&&this._differs(e.title,e.title=(n=e.column,"Edit column %s".replace("%s",'"'+(n?n.title()||n.name():"--")+'"')))&&(t.title=!0)};var Ht={nextResult:function(t){var e=this.get(),n=e.searchIndex,o=e.searchResults;(n+=t)<0&&(n+=o.length),n%=o.length,this.set({searchIndex:n})},keyPress:function(t){"F3"!=t.key&&"Enter"!=t.key||this.nextResult(t.shiftKey?-1:1)},toggleTranspose:function(){var t=this;this.set({activeColumn:!1}),this.set({transpose:!this.get("transpose")}),setTimeout(function(){return t.refs.hot.update()},500)},revertChanges:function(){var t=this.store.get("dw_chart");t.set("metadata.data.changes",[]),t.saveSoon(),this.refs.hot.update()},cmFocus:function(){var t=this;setTimeout(function(){t.refs.hot.get("hot").render()},100)},addComputedColumn:function(){for(var t=this.store.get("dw_chart"),e=t.dataset(),n=Rt(t.get("metadata.describe.computed-columns",{})),o=1;e.hasColumn("Column "+o);)o++;var a="Column "+o;n[a]="",t.set("metadata.describe.computed-columns",n),t.saveSoon();var r=t.dataset(!0);this.refs.hot.update(),this.set({activeColumn:r.column(a)})},sort:function(t,e,n){t.preventDefault(),t.stopPropagation(),this.set({sortBy:e,sortDir:n}),this.refs.sortDropdownGroup.classList.remove("open")},force:function(t,e){void 0===e&&(e=!0),t.preventDefault(),this.set({forceColumnFormat:e})}};function St(t,e){var n,o,i;function u(e){t.force(e,!1)}return{c:function(){n=l("div"),o=l("a"),i=c("Edit formula"),this.h()},h:function(){o.href="#edit-format",d(o,"click",u),p(n,"margin-top","1em")},m:function(t,e){r(n,t,e),a(o,n),a(i,o)},u:function(){s(n)},d:function(){h(o,"click",u)}}}function Ot(t,e){var o,i,u,m,d,h,f=e.locale,p=(e.locale_index,f.label),v=f.value;return{c:function(){o=l("option"),i=c(p),u=c(" ("),m=c(v),d=c(")"),this.h()},h:function(){o.__value=h=f.value,o.value=o.__value},m:function(t,e){r(o,t,e),a(i,o),a(u,o),a(m,o),a(d,o)},p:function(t,e){f=e.locale,e.locale_index,t.locales&&p!==(p=f.label)&&(i.data=p),t.locales&&v!==(v=f.value)&&(m.data=v),t.locales&&h!==(h=f.value)&&(o.__value=h),o.value=o.__value},u:function(){s(o)},d:n}}function Dt(t,e){var n,o,i,u,m={},f={};"customColumn"in e&&(f.column=e.customColumn,m.column=!0),"columns"in e&&(f.columns=e.columns,m.columns=!0);var v=new vt({root:t.root,data:f,_bind:function(e,n){t.get();var o={};!m.column&&e.column&&(o.customColumn=n.column),!m.columns&&e.columns&&(o.columns=n.columns),t._set(o),m={}}});function g(e){t.force(e,!0)}return t.root._beforecreate.push(function(){v._bind({column:1,columns:1},v.get())}),v.on("updateTable",function(e){t.refs.hot.update()}),v.on("renderTable",function(e){t.refs.hot.render()}),v.on("unselect",function(e){t.set({activeColumn:!1})}),{c:function(){v._fragment.c(),n=c("\n\n                "),o=l("div"),i=l("a"),u=c("Edit column format"),this.h()},h:function(){i.href="#edit-format",d(i,"click",g),p(o,"margin-top","1em")},m:function(t,e){v._mount(t,e),r(n,t,e),r(o,t,e),a(i,o),a(u,i)},p:function(t,e){var n={};!m.column&&t.customColumn&&(n.column=e.customColumn,m.column=!0),!m.columns&&t.columns&&(n.columns=e.columns,m.columns=!0),v._set(n),m={}},u:function(){v._unmount(),s(n),s(o)},d:function(){v.destroy(!1),h(i,"click",g)}}}function Lt(t,e){var n,o,a={},i={};"columnFormat"in e&&(i.column=e.columnFormat,a.column=!0),"columns"in e&&(i.columns=e.columns,a.columns=!0);var u=new Tt({root:t.root,data:i,_bind:function(e,n){t.get();var o={};!a.column&&e.column&&(o.columnFormat=n.column),!a.columns&&e.columns&&(o.columns=n.columns),t._set(o),a={}}});t.root._beforecreate.push(function(){u._bind({column:1,columns:1},u.get())}),u.on("updateTable",function(e){t.refs.hot.update()}),u.on("renderTable",function(e){t.refs.hot.render()});var l=e.columnFormat.isComputed&&St(t);return{c:function(){u._fragment.c(),n=c("\n\n                "),l&&l.c(),o=m()},m:function(t,e){u._mount(t,e),r(n,t,e),l&&l.m(t,e),r(o,t,e)},p:function(e,n){var r={};!a.column&&e.columnFormat&&(r.column=n.columnFormat,a.column=!0),!a.columns&&e.columns&&(r.columns=n.columns,a.columns=!0),u._set(r),a={},n.columnFormat.isComputed?l||((l=St(t)).c(),l.m(o.parentNode,o)):l&&(l.u(),l.d(),l=null)},u:function(){u._unmount(),s(n),l&&l.u(),s(o)},d:function(){u.destroy(!1),l&&l.d()}}}function Et(t,e){var n,i,m,f,p,_,b,y,w,x,C,k,N,R,F,I,T,H,S,O,D,L,E,q,M,P,j,A={},B=!1,$={label:"First row as label"};"firstRowIsHeader"in e&&($.value=e.firstRowIsHeader,A.value=!0);var z=new gt({root:t.root,data:$,_bind:function(e,n){t.get();var o={};!A.value&&e.value&&(o.firstRowIsHeader=n.value),t._set(o),A={}}});t.root._beforecreate.push(function(){z._bind({value:1},z.get())});for(var V=e.locales,G=[],J=0;J<V.length;J+=1)G[J]=Ot(0,o({},e,{locales:V,locale:V[J],locale_index:J}));function Y(){B=!0,t.set({locale:g(R)}),B=!1}return{c:function(){n=l("h3"),i=c("Make sure the data looks right"),m=c("\n\n                "),f=l("p"),p=c("Please make sure that Datawrapper interprets your data correctly. In the table columns should be shown in blue, dates in green and text in black."),_=c("\n\n                "),z._fragment.c(),b=c("\n\n                "),y=l("h4"),w=c("Output locale"),x=c("\n\n                "),C=l("p"),k=c("Defines decimal and thousand separators as well as translation of month and weekday names."),N=c("\n\n                "),R=l("select");for(var t=0;t<G.length;t+=1)G[t].c();F=c("\n\n                "),I=l("hr"),T=c("\n\n                "),H=l("div"),S=l("a"),O=l("i"),D=c(" "),L=c("Back"),E=c("\n                    "),q=l("a"),M=c("Proceed"),P=c(" "),j=l("i"),this.h()},h:function(){n.className="first",d(R,"change",Y),"locale"in e||t.root._beforecreate.push(Y),O.className="icon-chevron-left",S.className="btn submit",S.href="upload",j.className="icon-chevron-right icon-white",q.href="visualize",q.className="submit btn btn-primary",q.id="describe-proceed",H.className="btn-group"},m:function(t,o){r(n,t,o),a(i,n),r(m,t,o),r(f,t,o),a(p,f),r(_,t,o),z._mount(t,o),r(b,t,o),r(y,t,o),a(w,y),r(x,t,o),r(C,t,o),a(k,C),r(N,t,o),r(R,t,o);for(var s=0;s<G.length;s+=1)G[s].m(R,null);v(R,e.locale),r(F,t,o),r(I,t,o),r(T,t,o),r(H,t,o),a(S,H),a(O,S),a(D,S),a(L,S),a(E,H),a(q,H),a(M,q),a(P,q),a(j,q)},p:function(t,e){var n={label:"First row as label"};!A.value&&t.firstRowIsHeader&&(n.value=e.firstRowIsHeader,A.value=!0),z._set(n),A={};var a=e.locales;if(t.locales){for(var r=0;r<a.length;r+=1){var s=o({},e,{locales:a,locale:a[r],locale_index:r});G[r]?G[r].p(t,s):(G[r]=Ot(0,s),G[r].c(),G[r].m(R,null))}for(;r<G.length;r+=1)G[r].u(),G[r].d();G.length=a.length}B||v(R,e.locale)},u:function(){s(n),s(m),s(f),s(_),z._unmount(),s(b),s(y),s(x),s(C),s(N),s(R);for(var t=0;t<G.length;t+=1)G[t].u();s(F),s(I),s(T),s(H)},d:function(){z.destroy(!1),u(G),h(R,"change",Y)}}}function qt(t,e){var n,o,i,u,m,f,p,v,g,_,b,y=e.col,w=(e.col_index,y.title());return{c:function(){n=l("li"),o=l("a"),i=l("i"),m=c("\n                                "),f=l("i"),v=c("Â Â Â "),g=c(w),this.h()},h:function(){i.className=u="fa fa-sort-"+("text"==y.type()?"alpha":"amount")+"-asc fa-fw svelte-1kvuoqm",d(i,"click",Bt),i._svelte={component:t,columns:e.columns,col_index:e.col_index},f.className=p="fa fa-sort-"+("text"==y.type()?"alpha":"amount")+"-desc fa-fw svelte-1kvuoqm",d(f,"click",$t),f._svelte={component:t,columns:e.columns,col_index:e.col_index},o.href=_="#/"+y.name(),o.className="svelte-1kvuoqm",d(o,"click",zt),o._svelte={component:t,columns:e.columns,col_index:e.col_index},n.className=b=y.name()==e.sortBy?"active":""},m:function(t,e){r(n,t,e),a(o,n),a(i,o),a(m,o),a(f,o),a(v,o),a(g,o)},p:function(t,e){y=e.col,e.col_index,t.columns&&u!==(u="fa fa-sort-"+("text"==y.type()?"alpha":"amount")+"-asc fa-fw svelte-1kvuoqm")&&(i.className=u),i._svelte.columns=e.columns,i._svelte.col_index=e.col_index,t.columns&&p!==(p="fa fa-sort-"+("text"==y.type()?"alpha":"amount")+"-desc fa-fw svelte-1kvuoqm")&&(f.className=p),f._svelte.columns=e.columns,f._svelte.col_index=e.col_index,t.columns&&w!==(w=y.title())&&(g.data=w),t.columns&&_!==(_="#/"+y.name())&&(o.href=_),o._svelte.columns=e.columns,o._svelte.col_index=e.col_index,(t.columns||t.sortBy)&&b!==(b=y.name()==e.sortBy?"active":"")&&(n.className=b)},u:function(){s(n)},d:function(){h(i,"click",Bt),h(f,"click",$t),h(o,"click",zt)}}}function Mt(t,e){var n,o,i,u;function m(e){t.nextResult(-1)}function f(e){t.nextResult(1)}return{c:function(){n=l("div"),(o=l("button")).innerHTML='<i class="fa fa-chevron-up"></i>',i=c("\n                          "),(u=l("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){o.className="btn svelte-1kvuoqm",d(o,"click",m),u.className="btn svelte-1kvuoqm",d(u,"click",f),n.className="btn-group"},m:function(t,e){r(n,t,e),a(o,n),a(i,n),a(u,n)},u:function(){s(n)},d:function(){h(o,"click",m),h(u,"click",f)}}}function Pt(t,e){var o,a,i,u,l,m,d,h=e.searchIndexSafe+1,f=e.searchResults.length;return{c:function(){o=c(h),a=c("\n                            "),i=c("of"),u=c("\n                            "),l=c(f),m=c("\n                            "),d=c("results")},m:function(t,e){r(o,t,e),r(a,t,e),r(i,t,e),r(u,t,e),r(l,t,e),r(m,t,e),r(d,t,e)},p:function(t,e){t.searchIndexSafe&&h!==(h=e.searchIndexSafe+1)&&(o.data=h),t.searchResults&&f!==(f=e.searchResults.length)&&(l.data=f)},u:function(){s(o),s(a),s(i),s(u),s(l),s(m),s(d)},d:n}}function jt(t,e){var o;return{c:function(){o=c("No matches")},m:function(t,e){r(o,t,e)},p:n,u:function(){s(o)},d:n}}function At(t,e){var n;function o(t){return t.searchResults.length>0?Pt:t.search?jt:null}var a=o(e),i=a&&a(t,e);return{c:function(){n=l("div"),i&&i.c(),this.h()},h:function(){n.className="results svelte-1kvuoqm"},m:function(t,e){r(n,t,e),i&&i.m(n,null)},p:function(e,r){a===(a=o(r))&&i?i.p(e,r):(i&&(i.u(),i.d()),(i=a&&a(t,r))&&i.c(),i&&i.m(n,null))},u:function(){s(n),i&&i.u()},d:function(){i&&i.d()}}}function Bt(t){var e=this._svelte.component,n=this._svelte.columns[this._svelte.col_index];e.sort(t,n.name(),!0)}function $t(t){var e=this._svelte.component,n=this._svelte.columns[this._svelte.col_index];e.sort(t,n.name(),!1)}function zt(t){var e=this._svelte.component,n=this._svelte.columns[this._svelte.col_index];e.sort(t,n.name(),!0)}function Vt(t){k(this,t),this.refs={},this._state=o({locale:"en-US",search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,activeColumn:!1,customColumn:!1,columnFormat:!1,forceColumnFormat:!1,searchResults:[],sortBy:"-",sortDir:!0},t.data),this._recompute({searchIndex:1,searchResults:1,activeColumn:1,forceColumnFormat:1,sortBy:1,sortDir:1},this._state);var e=function(){var t=this;window.addEventListener("keypress",function(e){e.ctrlKey&&"f"==e.key&&(e.preventDefault(),t.refs.search!=window.document.activeElement?t.refs.search.focus():t.nextResult(1))});var e=function(e,n){t.observe(e,function(o){if(t.store.get("dw_chart").set(""+n,o),"locale"==e){if(!o)return;t.store.get("dw_chart").locale(o,function(){t.refs.hot.render()})}})};e("transpose","metadata.data.transpose"),e("firstRowIsHeader","metadata.data.horizontal-header"),e("locale","language"),this.observe("activeColumn",function(e){e||t.set({forceColumnFormat:!1})})}.bind(this);t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){var n,m,f,v,g,_,b,y,w,x,C,k,N,R,F,I,T,H,S,D,L,E,q,M,P,j,A,B,$,z,V,G,J,Y,K,U,W,Q,X,Z,tt,et,nt,ot,at,rt,st,it,ut,lt,ct,mt,dt,ht,ft,pt=e.activeColumn?e.activeColumn.name():"",vt=!1,gt={};function _t(t){return t.customColumn?Dt:t.columnFormat?Lt:Et}var bt=_t(e),yt=bt(t,e);function wt(e){t.sort(e,"-")}for(var xt=e.columns,Ct=[],kt=0;kt<xt.length;kt+=1)Ct[kt]=qt(t,o({},e,{columns:xt,col:xt[kt],col_index:kt}));function Nt(){vt=!0,t.set({search:V.value}),vt=!1}function Rt(e){t.keyPress(e)}var Ft=e.searchResults.length>0&&Mt(t),It=e.search&&At(t,e),Tt={};"chartData"in e&&(Tt.data=e.chartData,gt.data=!0),"transpose"in e&&(Tt.transpose=e.transpose,gt.transpose=!0),"firstRowIsHeader"in e&&(Tt.firstRowIsHeader=e.firstRowIsHeader,gt.firstRowIsHeader=!0),"activeColumn"in e&&(Tt.activeColumn=e.activeColumn,gt.activeColumn=!0),"sorting"in e&&(Tt.sorting=e.sorting,gt.sorting=!0),"search"in e&&(Tt.search=e.search,gt.search=!0),"searchResults"in e&&(Tt.searchResults=e.searchResults,gt.searchResults=!0),"searchIndex"in e&&(Tt.searchIndex=e.searchIndex,gt.searchIndex=!0);var Ht=new O({root:t.root,data:Tt,_bind:function(e,n){t.get();var o={};!gt.data&&e.data&&(o.chartData=n.data),!gt.transpose&&e.transpose&&(o.transpose=n.transpose),!gt.firstRowIsHeader&&e.firstRowIsHeader&&(o.firstRowIsHeader=n.firstRowIsHeader),!gt.activeColumn&&e.activeColumn&&(o.activeColumn=n.activeColumn),!gt.sorting&&e.sorting&&(o.sorting=n.sorting),!gt.search&&e.search&&(o.search=n.search),!gt.searchResults&&e.searchResults&&(o.searchResults=n.searchResults),!gt.searchIndex&&e.searchIndex&&(o.searchIndex=n.searchIndex),t._set(o),gt={}}});function St(e){t.toggleTranspose()}function Ot(e){t.addComputedColumn()}function Pt(e){t.revertChanges()}return t.root._beforecreate.push(function(){Ht._bind({data:1,transpose:1,firstRowIsHeader:1,activeColumn:1,sorting:1,search:1,searchResults:1,searchIndex:1},Ht.get())}),Ht.on("resetSort",function(e){t.set({sortBy:"-"})}),t.refs.hot=Ht,{c:function(){n=l("div"),m=l("div"),f=l("div"),v=l("div"),g=c(pt),_=c("\n                "),yt.c(),b=c("\n        "),y=l("div"),w=l("div"),x=l("noscript"),C=c(" "),k=l("img"),N=c("\n            "),R=l("div"),F=l("div"),I=l("div"),T=l("button"),H=l("noscript"),S=c("â€¦ "),D=l("span"),L=c("\n                        "),E=l("ul"),q=l("li"),M=l("a");for(var t=0;t<Ct.length;t+=1)Ct[t].c();j=c("\n\n                "),A=l("div"),B=l("i"),$=c("\n                    "),z=l("div"),V=l("input"),J=c("\n                        "),Ft&&Ft.c(),K=c("\n\n                    "),It&&It.c(),U=c("\n\n            "),Ht._fragment.c(),W=c("\n\n            "),Q=l("div"),X=l("button"),Z=l("img"),tt=c(" "),et=c("Swap rows and columns (transpose)"),nt=c("\n\n                "),ot=l("button"),at=l("i"),rt=c(" "),st=c("Add column"),it=c("â€¦"),ut=c("\n\n                "),lt=l("button"),ct=l("i"),mt=c(" "),dt=c("Revert changes"),ht=c("..."),this.h()},h:function(){v.className="sidebar",f.className="span4",k.src="/static/img/arrow.svg",w.className="help svelte-1kvuoqm",D.className="caret",T.className="btn dropdown-toggle",T.dataset.toggle="dropdown",M.href="#s",M.className="svelte-1kvuoqm",d(M,"click",wt),q.className=P="-"==e.sortBy?"active":"",E.className="dropdown-menu sort-menu",I.className="btn-group",F.className="sort-box svelte-1kvuoqm",B.className="im im-magnifier svelte-1kvuoqm",d(V,"input",Nt),V.type="text",V.placeholder="Search data table",V.className=G=(e.searchResults.length>0?"with-results":"")+" search-query svelte-1kvuoqm",d(V,"keypress",Rt),z.className=Y=e.searchResults.length>0?"input-append":"",A.className="search-box form-search svelte-1kvuoqm",R.className="pull-right",p(R,"margin-bottom","10px"),Z.src="/static/css/chart-editor/transpose.png",Z.className="svelte-1kvuoqm",X.className="btn transpose svelte-1kvuoqm",d(X,"click",St),at.className="fa fa-calculator",ot.className="btn computed-columns",d(ot,"click",Ot),ct.className="fa fa-undo",lt.className=ft="btn "+(e.has_changes?"":"disabled")+" svelte-1kvuoqm",lt.id="reset-data-changes",d(lt,"click",Pt),Q.className="buttons below-table pull-right svelte-1kvuoqm",y.className="span8 svelte-1kvuoqm",m.className="row",n.className="chart-editor"},m:function(o,s){r(n,o,s),a(m,n),a(f,m),a(v,f),a(g,v),a(_,v),yt.m(v,null),a(b,m),a(y,m),a(w,y),a(x,w),x.insertAdjacentHTML("beforebegin","Click on table header<br>to edit column properties"),a(C,w),a(k,w),a(N,y),a(R,y),a(F,R),a(I,F),a(T,I),a(H,T),H.insertAdjacentHTML("beforebegin","Sort view by"),a(S,T),a(D,T),a(L,I),a(E,I),a(q,E),a(M,q),M.innerHTML="No sorting";for(var i=0;i<Ct.length;i+=1)Ct[i].m(E,null);t.refs.sortDropdownGroup=I,a(j,R),a(A,R),a(B,A),a($,A),a(z,A),a(V,z),t.refs.search=V,V.value=e.search,a(J,z),Ft&&Ft.m(z,null),a(K,A),It&&It.m(A,null),a(U,y),Ht._mount(y,null),a(W,y),a(Q,y),a(X,Q),a(Z,X),a(tt,X),a(et,X),a(nt,Q),a(ot,Q),a(at,ot),a(rt,ot),a(st,ot),a(it,ot),a(ut,Q),a(lt,Q),a(ct,lt),a(mt,lt),a(dt,lt),a(ht,lt)},p:function(e,n){e.activeColumn&&pt!==(pt=n.activeColumn?n.activeColumn.name():"")&&(g.data=pt),bt===(bt=_t(n))&&yt?yt.p(e,n):(yt.u(),yt.d(),(yt=bt(t,n)).c(),yt.m(v,null)),e.sortBy&&P!==(P="-"==n.sortBy?"active":"")&&(q.className=P);var a=n.columns;if(e.columns||e.sortBy){for(var r=0;r<a.length;r+=1){var s=o({},n,{columns:a,col:a[r],col_index:r});Ct[r]?Ct[r].p(e,s):(Ct[r]=qt(t,s),Ct[r].c(),Ct[r].m(E,null))}for(;r<Ct.length;r+=1)Ct[r].u(),Ct[r].d();Ct.length=a.length}vt||(V.value=n.search),e.searchResults&&G!==(G=(n.searchResults.length>0?"with-results":"")+" search-query svelte-1kvuoqm")&&(V.className=G),n.searchResults.length>0?Ft||((Ft=Mt(t)).c(),Ft.m(z,null)):Ft&&(Ft.u(),Ft.d(),Ft=null),e.searchResults&&Y!==(Y=n.searchResults.length>0?"input-append":"")&&(z.className=Y),n.search?It?It.p(e,n):((It=At(t,n)).c(),It.m(A,null)):It&&(It.u(),It.d(),It=null);var i={};!gt.data&&e.chartData&&(i.data=n.chartData,gt.data=!0),!gt.transpose&&e.transpose&&(i.transpose=n.transpose,gt.transpose=!0),!gt.firstRowIsHeader&&e.firstRowIsHeader&&(i.firstRowIsHeader=n.firstRowIsHeader,gt.firstRowIsHeader=!0),!gt.activeColumn&&e.activeColumn&&(i.activeColumn=n.activeColumn,gt.activeColumn=!0),!gt.sorting&&e.sorting&&(i.sorting=n.sorting,gt.sorting=!0),!gt.search&&e.search&&(i.search=n.search,gt.search=!0),!gt.searchResults&&e.searchResults&&(i.searchResults=n.searchResults,gt.searchResults=!0),!gt.searchIndex&&e.searchIndex&&(i.searchIndex=n.searchIndex,gt.searchIndex=!0),Ht._set(i),gt={},e.has_changes&&ft!==(ft="btn "+(n.has_changes?"":"disabled")+" svelte-1kvuoqm")&&(lt.className=ft)},u:function(){i(x),i(H),M.innerHTML="",s(n),yt.u();for(var t=0;t<Ct.length;t+=1)Ct[t].u();Ft&&Ft.u(),It&&It.u()},d:function(){yt.d(),h(M,"click",wt),u(Ct),t.refs.sortDropdownGroup===I&&(t.refs.sortDropdownGroup=null),h(V,"input",Nt),h(V,"keypress",Rt),t.refs.search===V&&(t.refs.search=null),Ft&&Ft.d(),It&&It.d(),Ht.destroy(!1),t.refs.hot===Ht&&(t.refs.hot=null),h(X,"click",St),h(ot,"click",Ot),h(lt,"click",Pt)}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,R(this._beforecreate),R(this._oncreate),R(this._aftercreate),this._lock=!1)}function Gt(t,e){this._observers={pre:_(),post:_()},this._changeHandlers=[],this._dependents=[],this._computed=_(),this._sortedComputedProperties=[],this._state=o({},t),this._differs=e&&e.immutable?w:y}o(Vt.prototype,Ht,F),Vt.prototype._recompute=function(t,e){var n,o,a,r,s,i;(t.searchIndex||t.searchResults)&&this._differs(e.searchIndexSafe,e.searchIndexSafe=(n=e.searchIndex,o=e.searchResults,n<0&&(n+=o.length),n%=o.length))&&(t.searchIndexSafe=!0),(t.activeColumn||t.forceColumnFormat)&&(this._differs(e.customColumn,e.customColumn=(a=e.activeColumn,r=e.forceColumnFormat,!(!a||r||!a.isComputed)&&a))&&(t.customColumn=!0),this._differs(e.columnFormat,e.columnFormat=function(t,e){return!(!t||t.isComputed&&!e)&&t}(e.activeColumn,e.forceColumnFormat))&&(t.columnFormat=!0)),t.activeColumn&&this._differs(e.columns,e.columns=function(t){var e=chart.dataset();if(!t)return e?e.columns():[];try{return e.columns().filter(function(t){return!t.isComputed})}catch(t){return[]}}(e.activeColumn))&&(t.columns=!0),(t.sortBy||t.sortDir)&&this._differs(e.sorting,e.sorting=(s=e.sortBy,i=e.sortDir,{sortBy:s,sortDir:i}))&&(t.sorting=!0)},o(Gt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var o=t[n];e["$"+o]=this._state[o]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],o=_();function a(r){if(t[r])throw new Error("Cyclical dependency detected");if(!o[r]){o[r]=!0;var s=e[r];s&&(t[r]=!0,s.deps.forEach(a),n.push(s))}}for(var r in this._computed)t=_(),a(r)},compute:function(t,e,n){var o,a=this,r={deps:e,update:function(r,s,i){var u=e.map(function(t){return t in s&&(i=!0),r[t]});if(i){var l=n.apply(null,u);a._differs(l,o)&&(o=l,s[t]=!0,r[t]=o)}}};r.update(this._state,{},!0),this._computed[t]=r,this._sortComputedProperties()},get:C,observe:N,onchange:function(t){this._changeHandlers.push(t);var e=this;return{cancel:function(){var n=e._changeHandlers.indexOf(t);~n&&e._changeHandlers.splice(n,1)}}},set:function(t){var e=this._state,n=this._changed={},a=!1;for(var r in t){if(this._computed[r])throw new Error("'"+r+"' is a read-only property");this._differs(t[r],e[r])&&(n[r]=a=!0)}if(a){this._state=o({},e,t);for(var s=0;s<this._sortedComputedProperties.length;s+=1)this._sortedComputedProperties[s].update(this._state,n);for(s=0;s<this._changeHandlers.length;s+=1)this._changeHandlers[s](this._state,n);x(this,this._observers.pre,n,this._state,e);var i=this._dependents.slice();for(s=0;s<i.length;s+=1){var u=i[s],l={};a=!1;for(var c=0;c<u.props.length;c+=1){var m=u.props[c];m in n&&(l["$"+m]=this._state[m],a=!0)}a&&u.component.set(l)}x(this,this._observers.post,n,this._state,e)}}});return{App:Vt,store:new Gt({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
