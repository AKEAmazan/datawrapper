!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("Handsontable")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable"],t):e.describe=t(e.HOT)}(this,function(e){"use strict";function t(){}function s(e){for(var t,s,r=arguments,n=1,a=arguments.length;n<a;n++)for(t in s=r[n])e[t]=s[t];return e}function r(e,t){t.appendChild(e)}function n(e,t,s){t.insertBefore(e,s)}function a(e){e.parentNode.removeChild(e)}function o(e){return document.createElement(e)}function i(e){return document.createTextNode(e)}function c(e,t,s){e.addEventListener(t,s,!1)}function u(e,t,s){e.removeEventListener(t,s,!1)}function h(e,t,s){e.style.setProperty(t,s)}function l(){return Object.create(null)}function d(e){this.destroy=t,this.fire("destroy"),this.set=this.get=t,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function f(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,s,r,n){for(var a in t)if(s[a]){var o=r[a],i=n[a],c=t[a];if(c)for(var u=0;u<c.length;u+=1){var h=c[u];h.__calling||(h.__calling=!0,h.call(e,o,i),h.__calling=!1)}}}function m(e){return e?this._state[e]:this._state}function v(e,t){e._observers={pre:l(),post:l()},e._handlers=l(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function _(e,t,s){var r=s&&s.defer?this._observers.post:this._observers.pre;return(r[e]||(r[e]=[])).push(t),s&&!1===s.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var s=r[e].indexOf(t);~s&&r[e].splice(s,1)}}}function g(e){for(;e&&e.length;)e.pop()()}e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:d,get:m,fire:function(e,t){var s=e in this._handlers&&this._handlers[e].slice();if(s)for(var r=0;r<s.length;r+=1)s[r].call(this,t)},observe:_,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var s=this._handlers[e]||(this._handlers[e]=[]);return s.push(t),{cancel:function(){var e=s.indexOf(t);~e&&s.splice(e,1)}}},set:function(e){this._set(s({},e)),this.root._lock||(this.root._lock=!0,g(this.root._beforecreate),g(this.root._oncreate),g(this.root._aftercreate),this.root._lock=!1)},teardown:d,_recompute:t,_set:function(e){var t=this._state,r={},n=!1;for(var a in e)f(e[a],t[a])&&(r[a]=n=!0);n&&(this._state=s({},t,e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(p(this,this._observers.pre,r,this._state,t),this._fragment.p(r,this._state),p(this,this._observers.post,r,this._state,t)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var w={update:function(){var t=this,s=this.get(),r=s.data,n=s.transpose,a=s.firstRowIsHeader,o=s.skipRows,i=s.hot;if(r){var c=this.store.get("dw_chart").dataset(dw.datasource.delimited({csv:r,transpose:n,firstRowIsHeader:a,skipRows:o}).parse()).dataset();this.set({columnOrder:c.columnOrder()});var u=[[]];c.eachColumn(function(e){return u[0].push(e.title())}),c.eachRow(function(e){var t=[];c.eachColumn(function(s){return t.push(s.raw(e))}),u.push(t)}),i.loadData(u),i.updateSettings({cells:function(s,r){return{readOnly:t.get().readonly||c.numColumns()>r&&c.column(r).isComputed&&0===s,renderer:b(t,c,e,{})}},manualColumnMove:[]}),document.querySelector(".htCore thead tr:first-child th:first-child div.relative").addEventListener("click",function(){console.log("CLICKEEDDDD!")}),i.render()}}};function b(e,t,s,r){var n={date:"fa fa-clock-o"};return function(r,a,o,i,c,u,h){if(!(t.numColumns()<=i)){var l=t.column(i),d=e.get(),f=d.searchResults,p=d.currentResult;if((o=r.toPhysicalRow(o))>0)u=chart.columnFormatter(l)(l.val(o-1),!0);parseInt(u)<0&&a.classList.add("negative"),a.classList.add(l.type()+"Type"),"text"==l.type()&&u.length>70&&(u=u.substr(0,60)+"…"),0===o?(a.classList.add("firstRow"),n[l.type()]&&(u='<i class="'+n[l.type()]+'"></i> '+u)):a.classList.add(o%2?"oddRow":"evenRow"),f.forEach(function(e){e.row==o&&e.col==i&&a.classList.add("htSearchResult")}),p&&p.row==o&&p.col==i&&a.classList.add("htCurrentSearchResult"),o>0&&!l.type(!0).isValid(l.val(o-1))&&a.classList.add("parsingError"),h.readOnly&&a.classList.add("readOnly"),chart.dataCellChanged(i,o)&&a.classList.add("changed"),function(e,t,r,n,a,o,i){var c=dw.utils.purifyHtml(s.helper.stringify(o));t.innerHTML=c}(0,a,0,0,0,u)}}}function I(r){v(this,r),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,search:"",searchResults:[]},r.data),this._recompute({searchResults:1,searchIndex:1},this._state);var i,c,u=function(){var t=this,s=new e(this.refs.hot,{data:[],rowHeaders:function(e){return s.getPlugin("ColumnSorting").translateRow(e)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0},columnSorting:!0,sortIndicator:!0,sortFunction:function(e,t){return function(r,n){var a,o=s.getPlugin("columnSorting");if(0===r[0])return-1;switch(t.type){case"date":a=o.dateSort;break;case"numeric":a=o.numericSort;break;default:a=o.defaultSort}return a(e,t)(r,n)}},search:"search"});window.HT=s,this.set({hot:s}),e.hooks.add("afterSetDataAtCell",function(e){var r=!1;e.forEach(function(e){var n=e[0],a=e[1],o=e[2],i=e[3];if(o!=i){var c=t.store.get("dw_chart"),u=t.get().transpose,h=c.get("metadata.data.changes");if(n=s.toPhysicalRow(n),u){var l=n;n=a,a=l}h.push({row:n,column:a,value:i,time:(new Date).getTime()}),c.set("metadata.data.changes",h),r=!0}}),r&&setTimeout(function(){t.update(),chart.save()},100)}),e.hooks.add("afterColumnMove",function(r,n){if(r.length){var a=t.get().columnOrder,o=a.slice(0),i=a[n],c=o.splice(r[0],r.length),u=i?o.indexOf(i):o.length;o.splice.apply(o,[u,0].concat(c)),t.store.get("dw_chart").set("metadata.data.column-order",o.slice(0)),t.set({columnOrder:o}),e.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,u,s.countRows()-1,u+c.length-1)},10)}),t.update()}}),e.hooks.add("afterRender",function(){var e=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;t.refs.hot.style.height=Math.min(400,e+10)+"px"}),this.observe("data",function(){return t.update()}),this.observe("transpose",function(){return t.update()}),this.observe("firstRowIsHeader",function(){return t.update()}),this.observe("search",function(e){var r=s.search.query(e);t.set({searchResults:r}),s.render()}),this.observe("currentResult",function(e){e&&s&&(s.render(),s.scrollViewportTo(e.row,e.col),setTimeout(function(){s.scrollViewportTo(e.row,e.col)},100))})}.bind(this);r.root?this.root._oncreate.push(u):this._oncreate=[u],this._fragment=(this._state,i=this,{c:function(){c=o("div"),this.h()},h:function(){c.id="data-preview"},m:function(e,t){n(c,e,t),i.refs.hot=c},p:t,u:function(){a(c)},d:function(){i.refs.hot===c&&(i.refs.hot=null)}}),r.target&&(this._fragment.c(),this._fragment.m(r.target,r.anchor||null),g(this._oncreate))}function y(e){v(this,e),this._state=s({},e.data),this._fragment=function(e,t){var s,l,d,f,p;function m(){t.set({value:d.checked})}return{c:function(){s=o("div"),l=o("label"),d=o("input"),f=i(" "),p=i(e.label),this.h()},h:function(){c(d,"change",m),d.type="checkbox",l.className="checkbox",h(l,"text-align","left"),h(l,"width","100%"),h(l,"position","relative"),h(l,"left","0"),s.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,a){n(s,t,a),r(l,s),r(d,l),d.checked=e.value,r(f,l),r(p,l)},p:function(e,t){d.checked=t.value,e.label&&(p.data=t.label)},u:function(){a(s)},d:function(){u(d,"change",m)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null))}s(I.prototype,w,R),I.prototype._recompute=function(e,t){(e.searchResults||e.searchIndex)&&f(t.currentResult,t.currentResult=function(e,t){if(!e||!e.length)return null;var s=e.length;if(t<0||t>=s){for(;t<0;)t+=s;t>s&&(t%=s)}return e[t]}(t.searchResults,t.searchIndex))&&(e.currentResult=!0)},s(y.prototype,R);function x(e){!function(e,t,s){e.setAttribute(t,s)}(e,"svelte-1903720201","")}function H(e,t){var s,h,l,d;function f(e){t.nextResult(-1)}function p(e){t.nextResult(1)}return{c:function(){s=o("div"),(h=o("button")).innerHTML='<i class="fa fa-chevron-up"></i>',l=i("\n                      "),(d=o("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){x(h),h.className="btn",c(h,"click",f),x(d),d.className="btn",c(d,"click",p),s.className="btn-group"},m:function(e,t){n(s,e,t),r(h,s),r(l,s),r(d,s)},u:function(){a(s)},d:function(){u(h,"click",f),u(d,"click",p)}}}function k(e,s){var r,o,c,u,h,l,d,f=e.searchIndexSafe+1,p=e.searchResults.length;return{c:function(){r=i(f),o=i("\n                        "),c=i("of"),u=i("\n                        "),h=i(p),l=i("\n                        "),d=i("results")},m:function(e,t){n(r,e,t),n(o,e,t),n(c,e,t),n(u,e,t),n(h,e,t),n(l,e,t),n(d,e,t)},p:function(e,t){e.searchIndexSafe&&f!==(f=t.searchIndexSafe+1)&&(r.data=f),e.searchResults&&p!==(p=t.searchResults.length)&&(h.data=p)},u:function(){a(r),a(o),a(c),a(u),a(h),a(l),a(d)},d:t}}function C(e,s){var r;return{c:function(){r=i("No matches")},m:function(e,t){n(r,e,t)},p:t,u:function(){a(r)},d:t}}function N(e,t){var s,r=S(e),i=r&&r(e,t);return{c:function(){s=o("div"),i&&i.c(),this.h()},h:function(){x(s),s.className="results"},m:function(e,t){n(s,e,t),i&&i.m(s,null)},p:function(e,n){r===(r=S(n))&&i?i.p(e,n):(i&&(i.u(),i.d()),(i=r&&r(n,t))&&i.c(),i&&i.m(s,null))},u:function(){a(s),i&&i.u()},d:function(){i&&i.d()}}}function S(e){return e.searchResults.length>0?k:e.search?C:null}function L(e){v(this,e),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,searchResults:[]},e.data),this._recompute({searchIndex:1,searchResults:1},this._state);var t=function(){var e=this;window.addEventListener("keypress",function(t){t.ctrlKey&&"f"==t.key&&(t.preventDefault(),e.refs.search!=window.document.activeElement?e.refs.search.focus():e.nextResult(1))});var t=function(t,s){e.observe(t,function(t){e.store.get("dw_chart").set("metadata."+s,t)})};t("transpose","data.transpose"),t("firstRowIsHeader","data.horizontal-header")}.bind(this);e.root?this.root._oncreate.push(t):(this._oncreate=[t],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){var h,l,d,f,p,m,v,_,g,R,w,b,k,C,S,L,D,T,E,P,O,M,F,q,A,j,z,K,V,B,$,W,Z,G,J,Q,U,X,Y,ee,te,se={},re=!1,ne={},ae={label:"First row as label"};"firstRowIsHeader"in e&&(ae.value=e.firstRowIsHeader,se.value=!0);var oe=new y({root:t.root,data:ae,_bind:function(e,r){t.get();var n={};!se.value&&e.value&&(n.firstRowIsHeader=r.value),se=s({},e),t._set(n),se={}}});function ie(e){t.toggleTranspose()}function ce(){re=!0,t.set({search:q.value}),re=!1}function ue(e){t.keyPress(e)}t.root._beforecreate.push(function(){t.get();var e=oe.get(),s={};e&&(se.value||(s.firstRowIsHeader=e.value),se={value:!0},t._set(s),se={})});var he=e.searchResults.length>0&&H(0,t),le=e.search&&N(e,t),de={};"chartData"in e&&(de.data=e.chartData,ne.data=!0),"transpose"in e&&(de.transpose=e.transpose,ne.transpose=!0),"firstRowIsHeader"in e&&(de.firstRowIsHeader=e.firstRowIsHeader,ne.firstRowIsHeader=!0),"search"in e&&(de.search=e.search,ne.search=!0),"searchResults"in e&&(de.searchResults=e.searchResults,ne.searchResults=!0),"searchIndex"in e&&(de.searchIndex=e.searchIndex,ne.searchIndex=!0);var fe=new I({root:t.root,data:de,_bind:function(e,r){t.get();var n={};!ne.data&&e.data&&(n.chartData=r.data),!ne.transpose&&e.transpose&&(n.transpose=r.transpose),!ne.firstRowIsHeader&&e.firstRowIsHeader&&(n.firstRowIsHeader=r.firstRowIsHeader),!ne.search&&e.search&&(n.search=r.search),!ne.searchResults&&e.searchResults&&(n.searchResults=r.searchResults),!ne.searchIndex&&e.searchIndex&&(n.searchIndex=r.searchIndex),ne=s({},e),t._set(n),ne={}}});return t.root._beforecreate.push(function(){t.get();var e=fe.get(),s={};e&&(ne.data||(s.chartData=e.data),ne.transpose||(s.transpose=e.transpose),ne.firstRowIsHeader||(s.firstRowIsHeader=e.firstRowIsHeader),ne.search||(s.search=e.search),ne.searchResults||(s.searchResults=e.searchResults),ne.searchIndex||(s.searchIndex=e.searchIndex),ne={data:!0,transpose:!0,firstRowIsHeader:!0,search:!0,searchResults:!0,searchIndex:!0},t._set(s),ne={})}),{c:function(){h=o("div"),l=o("div"),d=o("div"),f=o("div"),p=o("h3"),m=i("Make sure the data looks right"),v=i("\n\n                "),_=o("p"),g=i("Please make sure that Datawrapper interprets your data correctly. In the table number columns should be shown in blue, dates in green and text in black."),R=i("\n\n                "),oe._fragment.c(),w=i("\n\n                "),(b=o("div")).innerHTML='<a class="btn submit" href="upload"><i class="icon-chevron-left"></i> Zurück</a>\n                    <a href="visualize" class="submit btn btn-primary" id="describe-proceed">Weiter <i class="icon-chevron-right icon-white"></i></a>',k=i("\n        "),C=o("div"),S=o("button"),L=o("img"),D=i(" "),T=i("Swap rows and columns (transpose)"),E=i("\n\n            "),P=o("div"),O=o("i"),M=i("\n                "),F=o("div"),q=o("input"),j=i("\n                    "),he&&he.c(),z=i("\n\n                "),le&&le.c(),K=i("\n\n            "),fe._fragment.c(),V=i("\n\n            "),B=o("div"),$=o("button"),W=o("i"),Z=i(" "),G=i("Add column"),J=i("..."),Q=i("\n\n                "),U=o("button"),X=o("i"),Y=i(" "),ee=i("Revert changes"),te=i("..."),this.h()},h:function(){p.className="first",b.className="btn-group",f.className="sidebar",d.className="span4",x(C),x(S),x(L),L.src="/static/css/chart-editor/transpose.png",S.className="btn transpose",c(S,"click",ie),x(P),x(O),O.className="fa fa-search",x(q),c(q,"input",ce),q.type="text",q.placeholder="Search data table",q.className=A=e.searchResults.length>0?"with-results":"",c(q,"keypress",ue),F.className="input-append",P.className="search-box pull-right",x(B),W.className="fa fa-calculator",$.className="btn computed-columns",X.className="fa fa-undo",U.className="btn disabled",U.id="reset-data-changes",B.className="buttons below-table pull-right",C.className="span8",l.className="row",h.className="chart-editor"},m:function(s,a){n(h,s,a),r(l,h),r(d,l),r(f,d),r(p,f),r(m,p),r(v,f),r(_,f),r(g,_),r(R,f),oe._mount(f,null),r(w,f),r(b,f),r(k,l),r(C,l),r(S,C),r(L,S),r(D,S),r(T,S),r(E,C),r(P,C),r(O,P),r(M,P),r(F,P),r(q,F),t.refs.search=q,q.value=e.search,r(j,F),he&&he.m(F,null),r(z,P),le&&le.m(P,null),r(K,C),fe._mount(C,null),r(V,C),r(B,C),r($,B),r(W,$),r(Z,$),r(G,$),r(J,$),r(Q,B),r(U,B),r(X,U),r(Y,U),r(ee,U),r(te,U)},p:function(e,s){var r={label:"First row as label"};!se.value&&e.firstRowIsHeader&&(r.value=s.firstRowIsHeader,se.value=!0),oe._set(r),se={},re||(q.value=s.search),e.searchResults&&A!==(A=s.searchResults.length>0?"with-results":"")&&(q.className=A),s.searchResults.length>0?he||((he=H(0,t)).c(),he.m(F,null)):he&&(he.u(),he.d(),he=null),s.search?le?le.p(e,s):((le=N(s,t)).c(),le.m(P,null)):le&&(le.u(),le.d(),le=null);var n={};!ne.data&&e.chartData&&(n.data=s.chartData,ne.data=!0),!ne.transpose&&e.transpose&&(n.transpose=s.transpose,ne.transpose=!0),!ne.firstRowIsHeader&&e.firstRowIsHeader&&(n.firstRowIsHeader=s.firstRowIsHeader,ne.firstRowIsHeader=!0),!ne.search&&e.search&&(n.search=s.search,ne.search=!0),!ne.searchResults&&e.searchResults&&(n.searchResults=s.searchResults,ne.searchResults=!0),!ne.searchIndex&&e.searchIndex&&(n.searchIndex=s.searchIndex,ne.searchIndex=!0),fe._set(n),ne={}},u:function(){a(h),he&&he.u(),le&&le.u()},d:function(){oe.destroy(!1),u(S,"click",ie),u(q,"input",ce),u(q,"keypress",ue),t.refs.search===q&&(t.refs.search=null),he&&he.d(),le&&le.d(),fe.destroy(!1)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,g(this._beforecreate),g(this._oncreate),g(this._aftercreate),this._lock=!1)}function D(e){this._observers={pre:l(),post:l()},this._changeHandlers=[],this._dependents=[],this._computed=l(),this._sortedComputedProperties=[],this._state=s({},e)}s(L.prototype,{nextResult:function(e){var t=this.get(),s=t.searchIndex,r=t.searchResults;(s+=e)<0&&(s+=r.length),s%=r.length,this.set({searchIndex:s})},keyPress:function(e){"F3"!=e.key&&"Enter"!=e.key||this.nextResult(e.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})}},R),L.prototype._recompute=function(e,t){var s,r;(e.searchIndex||e.searchResults)&&f(t.searchIndexSafe,t.searchIndexSafe=(s=t.searchIndex,r=t.searchResults,s<0&&(s+=r.length),s%=r.length))&&(e.searchIndexSafe=!0)},s(D.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},s=0;s<e.length;s+=1){var r=e[s];t["$"+r]=this._state[r]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,s=this._sortedComputedProperties=[],r=l();function n(a){if(e[a])throw new Error("Cyclical dependency detected");if(!r[a]){r[a]=!0;var o=t[a];o&&(e[a]=!0,o.deps.forEach(n),s.push(o))}}for(var a in this._computed)e=l(),n(a)},compute:function(e,t,s){var r,n={deps:t,update:function(n,a,o){var i=t.map(function(e){return e in a&&(o=!0),n[e]});if(o){var c=s.apply(null,i);f(c,r)&&(r=c,a[e]=!0,n[e]=r)}}};n.update(this._state,{},!0),this._computed[e]=n,this._sortComputedProperties()},get:m,observe:_,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var t=this._state,r=this._changed={},n=!1;for(var a in e){if(this._computed[a])throw new Error("'"+a+"' is a read-only property");f(e[a],t[a])&&(r[a]=n=!0)}if(n){this._state=s({},t,e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,r);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,r);p(this,this._observers.pre,r,this._state,t);var i=this._dependents.slice();for(o=0;o<i.length;o+=1){var c=i[o],u={};n=!1;for(var h=0;h<c.props.length;h+=1){var l=c.props[h];l in r&&(u["$"+l]=this._state[l],n=!0)}n&&c.component.set(u)}p(this,this._observers.post,r,this._state,t)}}});return{App:L,store:new D({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
