!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/highlight",t):e.highlight=t()}(this,function(){"use strict";function e(){}function t(e){for(var t,n,i=arguments,s=1,r=arguments.length;s<r;s++)for(t in n=i[s])e[t]=n[t];return e}function n(e,t){t.appendChild(e)}function i(e,t,n){t.insertBefore(e,n)}function s(e){e.parentNode.removeChild(e)}function r(e){for(var t=0;t<e.length;t+=1)e[t]&&e[t].d()}function o(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function a(e,t,n){e.addEventListener(t,n,!1)}function l(e,t,n){e.removeEventListener(t,n,!1)}function c(e,t,n){e.style.setProperty(t,n)}function d(e,t){for(var n=0;n<e.options.length;n+=1){var i=e.options[n];if(i.__value===t)return void(i.selected=!0)}}function u(){return Object.create(null)}function f(t){this.destroy=e,this.fire("destroy"),this.set=this.get=e,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function g(e,t){return e!==t||e&&"object"==typeof e||"function"==typeof e}function p(e,t,n,i,s){for(var r in t)if(n[r]){var o=i[r],h=s[r],a=t[r];if(a)for(var l=0;l<a.length;l+=1){var c=a[l];c.__calling||(c.__calling=!0,c.call(e,o,h),c.__calling=!1)}}}function v(e){return e?this._state[e]:this._state}function m(e,t,n){var i=n&&n.defer?this._observers.post:this._observers.pre;return(i[e]||(i[e]=[])).push(t),n&&!1===n.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var n=i[e].indexOf(t);~n&&i[e].splice(n,1)}}}function b(e){for(;e&&e.length;)e.pop()()}function y(){this.store._remove(this)}var k={destroy:f,get:v,fire:function(e,t){var n=e in this._handlers&&this._handlers[e].slice();if(n)for(var i=0;i<n.length;i+=1)n[i].call(this,t)},observe:m,on:function(e,t){if("teardown"===e)return this.on("destroy",t);var n=this._handlers[e]||(this._handlers[e]=[]);return n.push(t),{cancel:function(){var e=n.indexOf(t);~e&&n.splice(e,1)}}},set:function(e){this._set(t({},e)),this.root._lock||(this.root._lock=!0,b(this.root._beforecreate),b(this.root._oncreate),b(this.root._aftercreate),this.root._lock=!1)},teardown:f,_recompute:e,_set:function(e){var n=this._state,i={},s=!1;for(var r in e)g(e[r],n[r])&&(i[r]=s=!0);s&&(this._state=t({},n,e),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(p(this,this._observers.pre,i,this._state,n),this._fragment.p(i,this._state),p(this,this._observers.post,i,this._state,n)))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()}};var E={add:function(e){var t=this,n=this.get().highlighted;n.indexOf(e)<0&&n.push(e),this.set({highlighted:n}),setTimeout(function(){return t.set({selected:"---"})},30)},remove:function(e){var t=this.get().highlighted;t.splice(t.indexOf(e),1),this.set({highlighted:t})}};function x(e){return JSON.parse(JSON.stringify(e))}function w(t,r,a,l,c){var d,u,f,g=a.label;return{c:function(){d=o("option"),u=h(g),this.h()},h:function(){d.__value=f=a.key,d.value=d.__value},m:function(e,t){i(d,e,t),n(u,d)},p:function(e,t,n,i,s){e.elements&&g!==(g=i.label)&&(u.data=g),e.elements&&f!==(f=i.key)&&(d.__value=f),d.value=d.__value},u:function(){s(d)},d:e}}function N(e,t,r,c,d){var u,f,g,_,p,v,m,b=r.key;return{c:function(){u=o("span"),f=o("i"),g=h(" "),_=h(b),m=h("  "),this.h()},h:function(){f.className="fa fa-remove",a(f,"click",C),f._svelte={component:d,highlightedElements_1:t,el_index:c},u.dataset.series=p=r.key,u.className=v="badge "+(r.valid?"badge-info":"")},m:function(e,t){i(u,e,t),n(f,u),n(g,u),n(_,u),i(m,e,t)},p:function(e,t,n,i,s){f._svelte.highlightedElements_1=n,f._svelte.el_index=s,e.highlightedElements&&b!==(b=i.key)&&(_.data=b),e.highlightedElements&&p!==(p=i.key)&&(u.dataset.series=p),e.highlightedElements&&v!==(v="badge "+(i.valid?"badge-info":""))&&(u.className=v)},u:function(){s(u),s(m)},d:function(){l(f,"click",C)}}}function C(e){var t=this._svelte.component,n=this._svelte.highlightedElements_1[this._svelte.el_index];t.remove(n.key)}function H(e){!function(e,t){e._observers={pre:u(),post:u()},e._handlers=u(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}(this,e),this._state=t(this.store._init(["vis"]),{selected:"---",highlighted:[]},e.data),this.store._add(this,["vis"]),this._recompute({$vis:1,highlighted:1,elements:1},this._state),this._handlers.destroy=[y];var f=function(){var e=this;this.store.observe("vis",function(t){t&&(e.set({highlighted:x(t.get("highlighted-series"))}),t.chart().onChange(function(n,i){"metadata.visualize.highlighted-series"==i&&e.set({highlighted:x(t.get("highlighted-series"))})}))}),this.observe("highlighted",function(t){var n=e.store.get().vis;n&&JSON.stringify(n.get("highlighted-series"))!=JSON.stringify(t)&&n&&n.chart().set("metadata.visualize.highlighted-series",x(t))}),this.observe("selected",function(t){t&&"---"!=t&&e.add(t)})}.bind(this);e.root?this.root._oncreate.push(f):(this._oncreate=[f],this._beforecreate=[]),this._fragment=function(e,t){for(var u,f,g,_,p,v,m,b,y,k,E,x,C=!1,H=e.elements,O=[],S=0;S<H.length;S+=1)O[S]=w(0,0,H[S]);function P(){C=!0,t.set({selected:function(e){var t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(p)}),C=!1}var L=e.highlightedElements,T=[];for(S=0;S<L.length;S+=1)T[S]=N(0,L,L[S],S,t);return{c:function(){u=o("div"),f=o("label"),g=h("\n    "),_=o("div"),p=o("select"),v=o("option"),m=h("- "),b=o("noscript"),y=o("noscript"),k=h(" -");for(var e=0;e<O.length;e+=1)O[e].c();for(E=h("\n    "),x=o("p"),e=0;e<T.length;e+=1)T[e].c();this.h()},h:function(){f.className="separator",v.__value="---",v.value=v.__value,a(p,"change",P),"selected"in e||t.root._beforecreate.push(P),p.id="highlight-series",p.className="span2",x.className="highlighted-series",c(x,"margin-top","5px"),u.className="story-highlight control-group",c(u,"clear","both")},m:function(t,s){i(u,t,s),n(f,u),f.innerHTML="Hebe die wichtigsten Elemente hervor (optional)",n(g,u),n(_,u),n(p,_),n(v,p),n(m,v),n(b,v),b.insertAdjacentHTML("afterend","Element auswählen"),n(y,v),n(k,v);for(var r=0;r<O.length;r+=1)O[r].m(p,null);for(d(p,e.selected),n(E,u),n(x,u),r=0;r<T.length;r+=1)T[r].m(x,null)},p:function(e,n){var i=n.elements;if(e.elements){for(var s=0;s<i.length;s+=1)O[s]?O[s].p(e,n,i,i[s],s):(O[s]=w(0,0,i[s]),O[s].c(),O[s].m(p,null));for(;s<O.length;s+=1)O[s].u(),O[s].d();O.length=i.length}C||d(p,n.selected);var r=n.highlightedElements;if(e.highlightedElements){for(s=0;s<r.length;s+=1)T[s]?T[s].p(e,n,r,r[s],s):(T[s]=N(0,r,r[s],s,t),T[s].c(),T[s].m(x,null));for(;s<T.length;s+=1)T[s].u(),T[s].d();T.length=r.length}},u:function(){f.innerHTML="",function(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}(b,y),s(u);for(var e=0;e<O.length;e+=1)O[e].u();for(e=0;e<T.length;e+=1)T[e].u()},d:function(){r(O),l(p,"change",P),r(T)}}}(this._state,this),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),b(this._beforecreate),b(this._oncreate))}function O(e){this._observers={pre:u(),post:u()},this._changeHandlers=[],this._dependents=[],this._computed=u(),this._sortedComputedProperties=[],this._state=t({},e)}t(H.prototype,E,k),H.prototype._recompute=function(e,t){var n;e.$vis&&g(t.elements,t.elements=(n=t.$vis)?n.keys().sort().map(function(e){var t=n.keyLabel(e);return{key:e,label:e+(e!=t?" ("+t+")":"")}}):[])&&(e.elements=!0),(e.highlighted||e.elements)&&g(t.highlightedElements,t.highlightedElements=function(e,t){var n=_.indexBy(t,"key");return e.map(function(e){return{key:e,valid:n[e]}})}(t.highlighted,t.elements))&&(e.highlightedElements=!0)},t(O.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},n=0;n<e.length;n+=1){var i=e[n];t["$"+i]=this._state[i]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,n=this._sortedComputedProperties=[],i=u();function s(r){if(e[r])throw new Error("Cyclical dependency detected");if(!i[r]){i[r]=!0;var o=t[r];o&&(e[r]=!0,o.deps.forEach(s),n.push(o))}}for(var r in this._computed)e=u(),s(r)},compute:function(e,t,n){var i,s={deps:t,update:function(s,r,o){var h=t.map(function(e){return e in r&&(o=!0),s[e]});if(o){var a=n.apply(null,h);g(a,i)&&(i=a,r[e]=!0,s[e]=i)}}};s.update(this._state,{},!0),this._computed[e]=s,this._sortComputedProperties()},get:v,observe:m,onchange:function(e){return this._changeHandlers.push(e),{cancel:function(){var t=this._changeHandlers.indexOf(e);~t&&this._changeHandlers.splice(t,1)}}},set:function(e){var n=this._state,i=this._changed={},s=!1;for(var r in e){if(this._computed[r])throw new Error("'"+r+"' is a read-only property");g(e[r],n[r])&&(i[r]=s=!0)}if(s){this._state=t({},n,e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,i);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,i);p(this,this._observers.pre,i,this._state,n);var h=this._dependents.slice();for(o=0;o<h.length;o+=1){var a=h[o],l={};s=!1;for(var c=0;c<a.props.length;c+=1){var d=a.props[c];d in i&&(l["$"+d]=this._state[d],s=!0)}s&&a.component.set(l)}p(this,this._observers.post,i,this._state,n)}}});return{App:H,store:new O({}),data:{chart:{id:""}},init:function(e){window.dw.backend.on("dataset-loaded",function(){e.store.set({dataset:chart.dataset()})}).on("theme-changed-and-loaded",function(){e.store.set({theme:window.dw.theme(chart.get("theme"))})}).on("backend-vis-loaded",function(t){e.store.set({vis:t})})}}});
