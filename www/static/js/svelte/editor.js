!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/editor",t):e.editor=t()}(this,function(){"use strict";function noop(){}function assign(e,t){for(var r in t)e[r]=t[r];return e}function insertNode(e,t,r){t.insertBefore(e,r)}function detachNode(e){e.parentNode.removeChild(e)}function createElement(e){return document.createElement(e)}function createText(e){return document.createTextNode(e)}function blankObject(){return Object.create(null)}function destroy(e){this.destroy=noop,this.fire("destroy"),this.set=this.get=noop,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function _differs(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function _differsImmutable(e,t){return e!=e?t==t:e!==t}function fire(e,t){var r=e in this._handlers&&this._handlers[e].slice();if(r)for(var n=0;n<r.length;n+=1){var a=r[n];a.__calling||(a.__calling=!0,a.call(this,t),a.__calling=!1)}}function get(e){return e?this._state[e]:this._state}function init(e,t){e._handlers=blankObject(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function observe(e,t,r){var n=t.bind(this);return r&&!1===r.init||n(this.get()[e],void 0),this.on(r&&r.defer?"update":"state",function(t){t.changed[e]&&n(t.current[e],t.previous&&t.previous[e])})}function on(e,t){if("teardown"===e)return this.on("destroy",t);var r=this._handlers[e]||(this._handlers[e]=[]);return r.push(t),{cancel:function(){var e=r.indexOf(t);~e&&r.splice(e,1)}}}function set(e){this._set(assign({},e)),this.root._lock||(this.root._lock=!0,callAll(this.root._beforecreate),callAll(this.root._oncreate),callAll(this.root._aftercreate),this.root._lock=!1)}function _set(e){var t=this._state,r={},n=!1;for(var a in e)this._differs(e[a],t[a])&&(r[a]=n=!0);n&&(this._state=assign(assign({},t),e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:t}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:t})))}function callAll(e){for(;e&&e.length;)e.shift()()}function _mount(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)}function _unmount(){this._fragment&&this._fragment.u()}function removeFromStore(){this.store._remove(this)}var proto={destroy:destroy,get:get,fire:fire,observe:observe,on:on,set:set,teardown:destroy,_recompute:noop,_set:_set,_mount:_mount,_unmount:_unmount,_differs:_differs};function __(e,t){var r=arguments;if(void 0===t&&(t="core"),e=e.trim(),!dw.backend.__messages[t])return"MISSING:"+e;var n=dw.backend.__messages[t][e]||dw.backend.__messages.core[e]||e;if(arguments.length>2)for(var a=2;a<arguments.length;a++){var o=a-1;n=n.replace("$"+o,r[a])}return n}var EditorNav="./EditorNav.html",PublishSidebar="../publish/PublishSidebar.html";function data(){return{datasets:[],steps:[{id:"upload",title:__("Upload Data")},{id:"describe",title:__("Check & Describe")},{id:"visualize",title:__("Visualize")},{id:"publish",title:__("Publish & Embed")}]}}function oncreate(){}function create_main_fragment(e,t){var r,n,a={},o={};"step"in t&&(o.active=t.step,a.active=!0),"maxStep"in t&&(o.maxStep=t.maxStep,a.maxStep=!0),"steps"in t&&(o.steps=t.steps,a.steps=!0),"$chart"in t&&(o.chart=t.$chart,a.chart=!0);var i=new EditorNav({root:e.root,data:o,_bind:function(t,r){e.get();var n={},o={};!a.active&&t.active&&(n.step=r.active),!a.maxStep&&t.maxStep&&(n.maxStep=r.maxStep),!a.steps&&t.steps&&(n.steps=r.steps),!a.chart&&t.chart&&(o.chart=r.chart),e.store.set(o),e._set(n),a={}}});function u(e){return"upload"==e.step?create_if_block:"describe"==e.step?create_if_block_1:"visualize"==e.step?create_if_block_2:"publish"==e.step?create_if_block_3:create_if_block_4}e.root._beforecreate.push(function(){i._bind({active:1,maxStep:1,steps:1,chart:1},i.get())});var s=u(t),c=s(e,t);return{c:function(){i._fragment.c(),r=createText("\n\n"),n=createElement("div"),c.c()},m:function(e,t){i._mount(e,t),insertNode(r,e,t),insertNode(n,e,t),c.m(n,null)},p:function(t,r){var o={};!a.active&&t.step&&(o.active=r.step,a.active=!0),!a.maxStep&&t.maxStep&&(o.maxStep=r.maxStep,a.maxStep=!0),!a.steps&&t.steps&&(o.steps=r.steps,a.steps=!0),!a.chart&&t.$chart&&(o.chart=r.$chart,a.chart=!0),i._set(o),a={},s!==(s=u(r))&&(c.u(),c.d(),(c=s(e,r)).c(),c.m(n,null))},u:function(){i._unmount(),detachNode(r),detachNode(n),c.u()},d:function(){i.destroy(!1),c.d()}}}function create_if_block(e,t){var r;return{c:function(){r=createText("UPLOAD")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_1(e,t){var r;return{c:function(){r=createText("DESCRIBE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_2(e,t){var r;return{c:function(){r=createText("VISUALIZE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_3(e,t){var r=new PublishSidebar({root:e.root});return{c:function(){r._fragment.c()},m:function(e,t){r._mount(e,t)},u:function(){r._unmount()},d:function(){r.destroy(!1)}}}function create_if_block_4(e,t){var r;return{c:function(){r=createText(":(")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function ChartEditor(e){init(this,e),this._state=assign(assign(this.store._init(["chart"]),data()),e.data),this.store._add(this,["chart"]),this._handlers.destroy=[removeFromStore];var t=this;e.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(function(){oncreate.call(t),t.fire("update",{changed:{step:1,maxStep:1,steps:1,$chart:1},current:t._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),this._lock=!0,callAll(this._beforecreate),callAll(this._oncreate),callAll(this._aftercreate),this._lock=!1)}function Store(e,t){this._observers={pre:blankObject(),post:blankObject()},this._handlers={},this._dependents=[],this._computed=blankObject(),this._sortedComputedProperties=[],this._state=assign({},e),this._differs=t&&t.immutable?_differsImmutable:_differs}assign(ChartEditor.prototype,proto),assign(Store.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r];t["$"+n]=this._state[n]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,r=this._sortedComputedProperties=[],n=blankObject();function a(o){if(e[o])throw new Error("Cyclical dependency detected");if(!n[o]){n[o]=!0;var i=t[o];i&&(e[o]=!0,i.deps.forEach(a),r.push(i))}}for(var o in this._computed)e=blankObject(),a(o)},compute:function(e,t,r){var n,a=this,o={deps:t,update:function(o,i,u){var s=t.map(function(e){return e in i&&(u=!0),o[e]});if(u){var c=r.apply(null,s);a._differs(c,n)&&(n=c,i[e]=!0,o[e]=n)}}};o.update(this._state,{},!0),this._computed[e]=o,this._sortComputedProperties()},fire:fire,get:get,observe:observe,on:on,onchange:function(e){return console.warn("store.onchange is deprecated in favour of store.on('state', event => {...})"),this.on("state",function(t){e(t.current,t.changed)})},set:function(e){var t=this._state,r=this._changed={},n=!1;for(var a in e){if(this._computed[a])throw new Error("'"+a+"' is a read-only property");this._differs(e[a],t[a])&&(r[a]=n=!0)}if(n){this._state=assign(assign({},t),e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,r);this.fire("state",{changed:r,current:this._state,previous:t});var i=this._dependents.slice();for(o=0;o<i.length;o+=1){var u=i[o],s={};n=!1;for(var c=0;c<u.props.length;c+=1){var l=u.props[c];l in r&&(s["$"+l]=this._state[l],n=!0)}n&&u.component.set(s)}this.fire("update",{changed:r,current:this._state,previous:t})}}});var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var underscore=createCommonjsModule(function(e,t){(function(){var r=this,n=r._,a=Array.prototype,o=Object.prototype,i=Function.prototype,u=a.push,s=a.slice,c=o.toString,l=o.hasOwnProperty,f=Array.isArray,p=Object.keys,d=i.bind,h=Object.create,m=function(){},v=function(e){return e instanceof v?e:this instanceof v?void(this._wrapped=e):new v(e)};e.exports&&(t=e.exports=v),t._=v,v.VERSION="1.8.3";var g=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,a){return e.call(t,r,n,a)};case 4:return function(r,n,a,o){return e.call(t,r,n,a,o)}}return function(){return e.apply(t,arguments)}},Y=function(e,t,r){return null==e?v.identity:v.isFunction(e)?g(e,t,r):v.isObject(e)?v.matcher(e):v.property(e)};v.iteratee=function(e,t){return Y(e,t,1/0)};var y=function(e,t){return function(r){var n=arguments,a=arguments.length;if(a<2||null==r)return r;for(var o=1;o<a;o++)for(var i=n[o],u=e(i),s=u.length,c=0;c<s;c++){var l=u[c];t&&void 0!==r[l]||(r[l]=i[l])}return r}},M=function(e){if(!v.isObject(e))return{};if(h)return h(e);m.prototype=e;var t=new m;return m.prototype=null,t},_=function(e){return function(t){return null==t?void 0:t[e]}},b=Math.pow(2,53)-1,x=_("length"),w=function(e){var t=x(e);return"number"==typeof t&&t>=0&&t<=b};function D(e){return function(t,r,n,a){r=g(r,a,4);var o=!w(t)&&v.keys(t),i=(o||t).length,u=e>0?0:i-1;return arguments.length<3&&(n=t[o?o[u]:u],u+=e),function(t,r,n,a,o,i){for(;o>=0&&o<i;o+=e){var u=a?a[o]:o;n=r(n,t[u],u,t)}return n}(t,r,n,o,u,i)}}v.each=v.forEach=function(e,t,r){var n,a;if(t=g(t,r),w(e))for(n=0,a=e.length;n<a;n++)t(e[n],n,e);else{var o=v.keys(e);for(n=0,a=o.length;n<a;n++)t(e[o[n]],o[n],e)}return e},v.map=v.collect=function(e,t,r){t=Y(t,r);for(var n=!w(e)&&v.keys(e),a=(n||e).length,o=Array(a),i=0;i<a;i++){var u=n?n[i]:i;o[i]=t(e[u],u,e)}return o},v.reduce=v.foldl=v.inject=D(1),v.reduceRight=v.foldr=D(-1),v.find=v.detect=function(e,t,r){var n;if(void 0!==(n=w(e)?v.findIndex(e,t,r):v.findKey(e,t,r))&&-1!==n)return e[n]},v.filter=v.select=function(e,t,r){var n=[];return t=Y(t,r),v.each(e,function(e,r,a){t(e,r,a)&&n.push(e)}),n},v.reject=function(e,t,r){return v.filter(e,v.negate(Y(t)),r)},v.every=v.all=function(e,t,r){t=Y(t,r);for(var n=!w(e)&&v.keys(e),a=(n||e).length,o=0;o<a;o++){var i=n?n[o]:o;if(!t(e[i],i,e))return!1}return!0},v.some=v.any=function(e,t,r){t=Y(t,r);for(var n=!w(e)&&v.keys(e),a=(n||e).length,o=0;o<a;o++){var i=n?n[o]:o;if(t(e[i],i,e))return!0}return!1},v.contains=v.includes=v.include=function(e,t,r,n){return w(e)||(e=v.values(e)),("number"!=typeof r||n)&&(r=0),v.indexOf(e,t,r)>=0},v.invoke=function(e,t){var r=s.call(arguments,2),n=v.isFunction(t);return v.map(e,function(e){var a=n?t:e[t];return null==a?a:a.apply(e,r)})},v.pluck=function(e,t){return v.map(e,v.property(t))},v.where=function(e,t){return v.filter(e,v.matcher(t))},v.findWhere=function(e,t){return v.find(e,v.matcher(t))},v.max=function(e,t,r){var n,a,o=-1/0,i=-1/0;if(null==t&&null!=e)for(var u=0,s=(e=w(e)?e:v.values(e)).length;u<s;u++)(n=e[u])>o&&(o=n);else t=Y(t,r),v.each(e,function(e,r,n){((a=t(e,r,n))>i||a===-1/0&&o===-1/0)&&(o=e,i=a)});return o},v.min=function(e,t,r){var n,a,o=1/0,i=1/0;if(null==t&&null!=e)for(var u=0,s=(e=w(e)?e:v.values(e)).length;u<s;u++)(n=e[u])<o&&(o=n);else t=Y(t,r),v.each(e,function(e,r,n){((a=t(e,r,n))<i||a===1/0&&o===1/0)&&(o=e,i=a)});return o},v.shuffle=function(e){for(var t,r=w(e)?e:v.values(e),n=r.length,a=Array(n),o=0;o<n;o++)(t=v.random(0,o))!==o&&(a[o]=a[t]),a[t]=r[o];return a},v.sample=function(e,t,r){return null==t||r?(w(e)||(e=v.values(e)),e[v.random(e.length-1)]):v.shuffle(e).slice(0,Math.max(0,t))},v.sortBy=function(e,t,r){return t=Y(t,r),v.pluck(v.map(e,function(e,r,n){return{value:e,index:r,criteria:t(e,r,n)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")};var N=function(e){return function(t,r,n){var a={};return r=Y(r,n),v.each(t,function(n,o){var i=r(n,o,t);e(a,n,i)}),a}};v.groupBy=N(function(e,t,r){v.has(e,r)?e[r].push(t):e[r]=[t]}),v.indexBy=N(function(e,t,r){e[r]=t}),v.countBy=N(function(e,t,r){v.has(e,r)?e[r]++:e[r]=1}),v.toArray=function(e){return e?v.isArray(e)?s.call(e):w(e)?v.map(e,v.identity):v.values(e):[]},v.size=function(e){return null==e?0:w(e)?e.length:v.keys(e).length},v.partition=function(e,t,r){t=Y(t,r);var n=[],a=[];return v.each(e,function(e,r,o){(t(e,r,o)?n:a).push(e)}),[n,a]},v.first=v.head=v.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:v.initial(e,e.length-t)},v.initial=function(e,t,r){return s.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))},v.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:v.rest(e,Math.max(0,e.length-t))},v.rest=v.tail=v.drop=function(e,t,r){return s.call(e,null==t||r?1:t)},v.compact=function(e){return v.filter(e,v.identity)};var S=function(e,t,r,n){for(var a=[],o=0,i=n||0,u=x(e);i<u;i++){var s=e[i];if(w(s)&&(v.isArray(s)||v.isArguments(s))){t||(s=S(s,t,r));var c=0,l=s.length;for(a.length+=l;c<l;)a[o++]=s[c++]}else r||(a[o++]=s)}return a};function j(e){return function(t,r,n){r=Y(r,n);for(var a=x(t),o=e>0?0:a-1;o>=0&&o<a;o+=e)if(r(t[o],o,t))return o;return-1}}function k(e,t,r){return function(n,a,o){var i=0,u=x(n);if("number"==typeof o)e>0?i=o>=0?o:Math.max(o+u,i):u=o>=0?Math.min(o+1,u):o+u+1;else if(r&&o&&u)return n[o=r(n,a)]===a?o:-1;if(a!=a)return(o=t(s.call(n,i,u),v.isNaN))>=0?o+i:-1;for(o=e>0?i:u-1;o>=0&&o<u;o+=e)if(n[o]===a)return o;return-1}}v.flatten=function(e,t){return S(e,t,!1)},v.without=function(e){return v.difference(e,s.call(arguments,1))},v.uniq=v.unique=function(e,t,r,n){v.isBoolean(t)||(n=r,r=t,t=!1),null!=r&&(r=Y(r,n));for(var a=[],o=[],i=0,u=x(e);i<u;i++){var s=e[i],c=r?r(s,i,e):s;t?(i&&o===c||a.push(s),o=c):r?v.contains(o,c)||(o.push(c),a.push(s)):v.contains(a,s)||a.push(s)}return a},v.union=function(){return v.uniq(S(arguments,!0,!0))},v.intersection=function(e){for(var t=arguments,r=[],n=arguments.length,a=0,o=x(e);a<o;a++){var i=e[a];if(!v.contains(r,i)){for(var u=1;u<n&&v.contains(t[u],i);u++);u===n&&r.push(i)}}return r},v.difference=function(e){var t=S(arguments,!0,!0,1);return v.filter(e,function(e){return!v.contains(t,e)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(e){for(var t=e&&v.max(e,x).length||0,r=Array(t),n=0;n<t;n++)r[n]=v.pluck(e,n);return r},v.object=function(e,t){for(var r={},n=0,a=x(e);n<a;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},v.findIndex=j(1),v.findLastIndex=j(-1),v.sortedIndex=function(e,t,r,n){for(var a=(r=Y(r,n,1))(t),o=0,i=x(e);o<i;){var u=Math.floor((o+i)/2);r(e[u])<a?o=u+1:i=u}return o},v.indexOf=k(1,v.findIndex,v.sortedIndex),v.lastIndexOf=k(-1,v.findLastIndex),v.range=function(e,t,r){null==t&&(t=e||0,e=0),r=r||1;for(var n=Math.max(Math.ceil((t-e)/r),0),a=Array(n),o=0;o<n;o++,e+=r)a[o]=e;return a};var O=function(e,t,r,n,a){if(!(n instanceof t))return e.apply(r,a);var o=M(e.prototype),i=e.apply(o,a);return v.isObject(i)?i:o};v.bind=function(e,t){if(d&&e.bind===d)return d.apply(e,s.call(arguments,1));if(!v.isFunction(e))throw new TypeError("Bind must be called on a function");var r=s.call(arguments,2),n=function(){return O(e,n,t,this,r.concat(s.call(arguments)))};return n},v.partial=function(e){var t=s.call(arguments,1),r=function(){for(var n=arguments,a=0,o=t.length,i=Array(o),u=0;u<o;u++)i[u]=t[u]===v?n[a++]:t[u];for(;a<arguments.length;)i.push(n[a++]);return O(e,r,this,this,i)};return r},v.bindAll=function(e){var t,r,n=arguments,a=arguments.length;if(a<=1)throw new Error("bindAll must be passed function names");for(t=1;t<a;t++)e[r=n[t]]=v.bind(e[r],e);return e},v.memoize=function(e,t){var r=function(n){var a=r.cache,o=""+(t?t.apply(this,arguments):n);return v.has(a,o)||(a[o]=e.apply(this,arguments)),a[o]};return r.cache={},r},v.delay=function(e,t){var r=s.call(arguments,2);return setTimeout(function(){return e.apply(null,r)},t)},v.defer=v.partial(v.delay,v,1),v.throttle=function(e,t,r){var n,a,o,i=null,u=0;r||(r={});var s=function(){u=!1===r.leading?0:v.now(),i=null,o=e.apply(n,a),i||(n=a=null)};return function(){var c=v.now();u||!1!==r.leading||(u=c);var l=t-(c-u);return n=this,a=arguments,l<=0||l>t?(i&&(clearTimeout(i),i=null),u=c,o=e.apply(n,a),i||(n=a=null)):i||!1===r.trailing||(i=setTimeout(s,l)),o}},v.debounce=function(e,t,r){var n,a,o,i,u,s=function(){var c=v.now()-i;c<t&&c>=0?n=setTimeout(s,t-c):(n=null,r||(u=e.apply(o,a),n||(o=a=null)))};return function(){o=this,a=arguments,i=v.now();var c=r&&!n;return n||(n=setTimeout(s,t)),c&&(u=e.apply(o,a),o=a=null),u}},v.wrap=function(e,t){return v.partial(t,e)},v.negate=function(e){return function(){return!e.apply(this,arguments)}},v.compose=function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},v.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},v.before=function(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}},v.once=v.partial(v.before,2);var C=!{toString:null}.propertyIsEnumerable("toString"),E=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function A(e,t){var r=E.length,n=e.constructor,a=v.isFunction(n)&&n.prototype||o,i="constructor";for(v.has(e,i)&&!v.contains(t,i)&&t.push(i);r--;)(i=E[r])in e&&e[i]!==a[i]&&!v.contains(t,i)&&t.push(i)}v.keys=function(e){if(!v.isObject(e))return[];if(p)return p(e);var t=[];for(var r in e)v.has(e,r)&&t.push(r);return C&&A(e,t),t},v.allKeys=function(e){if(!v.isObject(e))return[];var t=[];for(var r in e)t.push(r);return C&&A(e,t),t},v.values=function(e){for(var t=v.keys(e),r=t.length,n=Array(r),a=0;a<r;a++)n[a]=e[t[a]];return n},v.mapObject=function(e,t,r){t=Y(t,r);for(var n,a=v.keys(e),o=a.length,i={},u=0;u<o;u++)i[n=a[u]]=t(e[n],n,e);return i},v.pairs=function(e){for(var t=v.keys(e),r=t.length,n=Array(r),a=0;a<r;a++)n[a]=[t[a],e[t[a]]];return n},v.invert=function(e){for(var t={},r=v.keys(e),n=0,a=r.length;n<a;n++)t[e[r[n]]]=r[n];return t},v.functions=v.methods=function(e){var t=[];for(var r in e)v.isFunction(e[r])&&t.push(r);return t.sort()},v.extend=y(v.allKeys),v.extendOwn=v.assign=y(v.keys),v.findKey=function(e,t,r){t=Y(t,r);for(var n,a=v.keys(e),o=0,i=a.length;o<i;o++)if(t(e[n=a[o]],n,e))return n},v.pick=function(e,t,r){var n,a,o={},i=e;if(null==i)return o;v.isFunction(t)?(a=v.allKeys(i),n=g(t,r)):(a=S(arguments,!1,!1,1),n=function(e,t,r){return t in r},i=Object(i));for(var u=0,s=a.length;u<s;u++){var c=a[u],l=i[c];n(l,c,i)&&(o[c]=l)}return o},v.omit=function(e,t,r){if(v.isFunction(t))t=v.negate(t);else{var n=v.map(S(arguments,!1,!1,1),String);t=function(e,t){return!v.contains(n,t)}}return v.pick(e,t,r)},v.defaults=y(v.allKeys,!0),v.create=function(e,t){var r=M(e);return t&&v.extendOwn(r,t),r},v.clone=function(e){return v.isObject(e)?v.isArray(e)?e.slice():v.extend({},e):e},v.tap=function(e,t){return t(e),e},v.isMatch=function(e,t){var r=v.keys(t),n=r.length;if(null==e)return!n;for(var a=Object(e),o=0;o<n;o++){var i=r[o];if(t[i]!==a[i]||!(i in a))return!1}return!0};var T=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof v&&(e=e._wrapped),t instanceof v&&(t=t._wrapped);var a=c.call(e);if(a!==c.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t}var o="[object Array]"===a;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var i=e.constructor,u=t.constructor;if(i!==u&&!(v.isFunction(i)&&i instanceof i&&v.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],n=n||[];for(var s=r.length;s--;)if(r[s]===e)return n[s]===t;if(r.push(e),n.push(t),o){if((s=e.length)!==t.length)return!1;for(;s--;)if(!T(e[s],t[s],r,n))return!1}else{var l,f=v.keys(e);if(s=f.length,v.keys(t).length!==s)return!1;for(;s--;)if(l=f[s],!v.has(t,l)||!T(e[l],t[l],r,n))return!1}return r.pop(),n.pop(),!0};v.isEqual=function(e,t){return T(e,t)},v.isEmpty=function(e){return null==e||(w(e)&&(v.isArray(e)||v.isString(e)||v.isArguments(e))?0===e.length:0===v.keys(e).length)},v.isElement=function(e){return!(!e||1!==e.nodeType)},v.isArray=f||function(e){return"[object Array]"===c.call(e)},v.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){v["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),v.isArguments(arguments)||(v.isArguments=function(e){return v.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(v.isFunction=function(e){return"function"==typeof e||!1}),v.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},v.isNaN=function(e){return v.isNumber(e)&&e!==+e},v.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===c.call(e)},v.isNull=function(e){return null===e},v.isUndefined=function(e){return void 0===e},v.has=function(e,t){return null!=e&&l.call(e,t)},v.noConflict=function(){return r._=n,this},v.identity=function(e){return e},v.constant=function(e){return function(){return e}},v.noop=function(){},v.property=_,v.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},v.matcher=v.matches=function(e){return e=v.extendOwn({},e),function(t){return v.isMatch(t,e)}},v.times=function(e,t,r){var n=Array(Math.max(0,e));t=g(t,r,1);for(var a=0;a<e;a++)n[a]=t(a);return n},v.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},v.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},F=v.invert(H),z=function(e){var t=function(t){return e[t]},r="(?:"+v.keys(e).join("|")+")",n=RegExp(r),a=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(a,t):e}};v.escape=z(H),v.unescape=z(F),v.result=function(e,t,r){var n=null==e?void 0:e[t];return void 0===n&&(n=r),v.isFunction(n)?n.call(e):n};var P=0;v.uniqueId=function(e){var t=++P+"";return e?e+t:t},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,$={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\u2028|\u2029/g,W=function(e){return"\\"+$[e]};v.template=function(e,t,r){!t&&r&&(t=r),t=v.defaults({},t,v.templateSettings);var n=RegExp([(t.escape||I).source,(t.interpolate||I).source,(t.evaluate||I).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(n,function(t,r,n,i,u){return o+=e.slice(a,u).replace(R,W),a=u+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var i=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var u=function(e){return i.call(this,e,v)},s=t.variable||"obj";return u.source="function("+s+"){\n"+o+"}",u},v.chain=function(e){var t=v(e);return t._chain=!0,t};var V=function(e,t){return e._chain?v(t).chain():t};v.mixin=function(e){v.each(v.functions(e),function(t){var r=v[t]=e[t];v.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),V(this,r.apply(v,e))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];v.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],V(this,r)}}),v.each(["concat","join","slice"],function(e){var t=a[e];v.prototype[e]=function(){return V(this,t.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped}}).call(commonjsGlobal)}),underscore_1=underscore._;function dataset(e){var t={},r=e.slice(0);function n(e){for(var r=e.name(),n=r,a=1;t.hasOwnProperty(n);)n=r+"."+a++;n!==r&&e.name(n)}e.forEach(function(e){n(e),t[e.name()]=e});var a={columns:function(){return e},column:function(r){if(underscore.isString(r)){if(void 0!==t[r])return t[r];throw new Error('No column found with that name: "'+r+'"')}if(!(r<0)){if(void 0!==e[r])return e[r];throw new Error("No column found with that name or index: "+r)}},numColumns:function(){return e.length},numRows:function(){return e[0].length},eachColumn:function(t){e.forEach(t)},hasColumn:function(r){return void 0!==(underscore.isString(r)?t[r]:e[r])},indexOf:function(r){return a.hasColumn(r)?e.indexOf(t[r]):-1},list:function(){return underscore.range(e[0].length).map(function(t){var r={};return e.forEach(function(e){r[e.name()]=e.val(t)}),r})},csv:function(){var t="";return e.forEach(function(e,r){var n=e.title();n.indexOf('"')>-1&&n.replace('"','\\"'),n.indexOf(",")>-1&&(n='"'+n+'"'),t+=(r>0?",":"")+n}),underscore.range(a.numRows()).forEach(function(r){t+="\n",e.forEach(function(e,n){var a=""+("date"===e.type()?e.raw(r):e.val(r));a.indexOf('"')>-1&&a.replace('"','\\"'),a.indexOf(",")>-1&&(a='"'+a+'"'),t+=(n>0?",":"")+a})}),t},toCSV:function(){return this.csv()},filterColumns:function(r){return e=e.filter(function(e){return!r[e.name()]}),underscore.each(r,function(e,r){e&&t[r]&&delete t[r]}),a},eachRow:function(e){var t;for(t=0;t<a.numRows();t++)e(t);return a},add:function(o){return n(o),e.push(o),t[o.name()]=o,r.push(o),a},reset:function(){return e=r.slice(0),t={},e.forEach(function(e){t[e.name()]=e}),a},limitRows:function(t){return e.forEach(function(e){e.limitRows(t)}),a},limitColumns:function(t){return e.length>t&&(e.length=t,r.length=t),a},columnOrder:function(t){return arguments.length?(e.length=0,t.forEach(function(t){e.push(r[t])}),a):e.map(function(e){return r.indexOf(e)})}};return a}function text(){return{parse:underscore.identity,errors:function(){return 0},name:function(){return"text"},formatter:function(){return underscore.identity},isValid:function(){return!0},format:function(){}}}function equalish(e,t){return Math.abs(e-t)<1e-6}function number(e){var t,r=0,n={"-.":/^ *[-–—−]?[0-9]*(\.[0-9]+)?(e[+-][0-9]+)?%? *$/,"-,":/^ *[-–—−]?[0-9]*(,[0-9]+)?%? *$/,",.":/^ *[-–—−]?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)?%? *$/,".,":/^ *[-–—−]?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/,"'.":/^ *[-–—−]?[0-9]{1,3}('[0-9]{3})*(\.[0-9]+)?%? *$/},a={"-.":"1234.56","-,":"1234,56",",.":"1,234.56",".,":"1.234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"},o={na:1,"n/a":1,"-":1,":":1},i={},u=["-.",0];e=e||[],underscore.each(e,function(e){underscore.each(n,function(t,r){void 0===i[r]&&(i[r]=0),t.test(e)&&(i[r]+=1,i[r]>u[1]&&(u[0]=r,u[1]=i[r]))})}),t=u[0];var s={parse:function(e){if(underscore.isNumber(e)||underscore.isUndefined(e)||underscore.isNull(e))return e;var n=e.replace("%","").replace("−","-").replace("–","-").replace("—","-");return"-"!==t[0]&&(n=n.replace(new RegExp("."===t[0]?"\\.":t[0],"g"),"")),"."!==t[1]&&(n=n.replace(t[1],".")),isNaN(n)||""===n?(o[n.toLowerCase()]||""===n||r++,e):Number(n)},toNum:function(e){return e},fromNum:function(e){return e},errors:function(){return r},name:function(){return"number"},formatter:function(e){var t=e["number-format"]||"-",r=Number(e["number-divisor"]||0),n=(e["number-append"]||"").replace(/ /g," "),a=(e["number-prepend"]||"").replace(/ /g," ");return function(e,o,i){if(isNaN(e))return e;var u=t;if(0!==r&&"-"===u&&(u="n1"),0!==r&&(e=Number(e)/Math.pow(10,r)),"s"===u.substr(0,1)){var s=+u.substr(1);u="n"+Math.max(0,function(e,t){return 0===e?0:Math.round(t-Math.ceil(Math.log(Math.abs(e))/Math.LN10))}(e,s))}return i&&(u="n0"),"-"===u&&(u=equalish(e,Math.round(e))?"n0":equalish(e,.1*Math.round(10*e))?"n1":equalish(e,.01*Math.round(100*e))?"n2":equalish(e,.001*Math.round(1e3*e))?"n3":equalish(e,1e-4*Math.round(1e4*e))?"n4":equalish(e,1e-5*Math.round(1e5*e))?"n5":"n6"),e=Globalize.format(e,"-"!==u?u:null),o?a+e+n:e}},isValid:function(e){return""===e||o[String(e).toLowerCase()]||underscore.isNumber(s.parse(e))},ambiguousFormats:function(){var e=[];return underscore.each(i,function(t,r){t===u[1]&&e.push([r,a[r]])}),e},format:function(e){return arguments.length?(t=e,s):t}};return s}var begin=/^ */.source,end=/[*']* *$/.source,s0=/[ \-/.]?/.source,s1=/[ \-/.]/.source,s2=/[ \-/.;]/.source,s3=/[ \-|T]/.source,rx={YY:{parse:/['’‘]?(\d{2})/},YYYY:{test:/([12]\d{3})/,parse:/(\d{4})/},YYYY2:{test:/(?:1[7-9]|20)\d{2}/,parse:/(\d{4})/},H:{parse:/h([12])/},Q:{parse:/q([1234])/},W:{parse:/w([0-5]?[0-9])/},Mm:{test:/m?(0?[1-9]|1[0-2])/,parse:/m?(0?[1-9]|1[0-2])/},MM:{test:/(0?[1-9]|1[0-2])/,parse:/(0?[1-9]|1[0-2])/},DD:{parse:/(0?[1-9]|[1-2][0-9]|3[01])/},DOW:{parse:/([0-7])/},HHMM:{parse:/(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *(am|pm)?/}},MONTHS={0:["jan","january","januar","jänner","jän","janv","janvier","ene","enero","gen","gennaio","janeiro"],1:["feb","february","febr","februar","fév","févr","février","febrero","febbraio","fev","fevereiro"],2:["mar","mär","march","mrz","märz","mars","mars","marzo","marzo","março"],3:["apr","april","apr","april","avr","avril","abr","abril","aprile"],4:["may","mai","mayo","mag","maggio","maio","maj"],5:["jun","june","juni","juin","junio","giu","giugno","junho"],6:["jul","july","juli","juil","juillet","julio","lug","luglio","julho"],7:["aug","august","août","ago","agosto"],8:["sep","september","sept","septembre","septiembre","set","settembre","setembro"],9:["oct","october","okt","oktober","octobre","octubre","ott","ottobre","out","outubro"],10:["nov","november","november","novembre","noviembre","novembre","novembro"],11:["dec","december","dez","des","dezember","déc","décembre","dic","diciembre","dicembre","desember","dezembro"]},shortMonthKey={};underscore.each(MONTHS,function(e,t){underscore.each(e,function(e){shortMonthKey[e]=t})}),rx.MMM={parse:new RegExp("("+underscore.flatten(underscore.values(MONTHS)).join("|")+")")},underscore.each(rx,function(e){e.parse=e.parse.source,underscore.isRegExp(e.test)?e.test=e.test.source:e.test=e.parse});var knownFormats={YYYY:{test:reg(rx.YYYY2.test),parse:reg(rx.YYYY2.parse),precision:"year"},"YYYY-H":{test:reg(rx.YYYY.test,s0,rx.H.test),parse:reg(rx.YYYY.parse,s0,rx.H.parse),precision:"half"},"H-YYYY":{test:reg(rx.H.test,s1,rx.YYYY.test),parse:reg(rx.H.parse,s1,rx.YYYY.parse),precision:"half"},"YYYY-Q":{test:reg(rx.YYYY.test,s0,rx.Q.test),parse:reg(rx.YYYY.parse,s0,rx.Q.parse),precision:"quarter"},"Q-YYYY":{test:reg(rx.Q.test,s1,rx.YYYY.test),parse:reg(rx.Q.parse,s1,rx.YYYY.parse),precision:"quarter"},"YYYY-M":{test:reg(rx.YYYY.test,s0,rx.Mm.test),parse:reg(rx.YYYY.parse,s0,rx.Mm.parse),precision:"month"},"M-YYYY":{test:reg(rx.MM.test,s1,rx.YYYY.test),parse:reg(rx.MM.parse,s1,rx.YYYY.parse),precision:"month"},"YYYY-MMM":{test:reg(rx.YYYY.test,s1,rx.MMM.parse),parse:reg(rx.YYYY.parse,s1,rx.MMM.parse),precision:"month"},"MMM-YYYY":{test:reg(rx.MMM.parse,s1,rx.YYYY.test),parse:reg(rx.MMM.parse,s1,rx.YYYY.parse),precision:"month"},"MMM-YY":{test:reg(rx.MMM.parse,s1,rx.YY.test),parse:reg(rx.MMM.parse,s1,rx.YY.parse),precision:"month"},MMM:{test:reg(rx.MMM.parse),parse:reg(rx.MMM.parse),precision:"month"},"YYYY-WW":{test:reg(rx.YYYY.test,s0,rx.W.test),parse:reg(rx.YYYY.parse,s0,rx.W.parse),precision:"week"},"WW-YYYY":{test:reg(rx.W.test,s1,rx.YYYY.test),parse:reg(rx.W.parse,s1,rx.YYYY.parse),precision:"week"},"MM/DD/YYYY":{test:reg(rx.MM.test,"([\\-\\/])",rx.DD.test,"\\2",rx.YYYY.test),parse:reg(rx.MM.parse,"([\\-\\/])",rx.DD.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MM/YYYY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.YYYY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MMM/YYYY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MMM.test,"\\2",rx.YYYY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MMM.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MMM/YY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MMM.test,"\\2",rx.YY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MMM.parse,"\\2",rx.YY.parse),precision:"day"},"YYYY-MM-DD":{test:reg(rx.YYYY.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.DD.test),parse:reg(rx.YYYY.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.DD.parse),precision:"day"},"MMM-DD-YYYY":{test:reg(rx.MMM.test,s1,rx.DD.test,s2,rx.YYYY.test),parse:reg(rx.MMM.parse,s1,rx.DD.parse,s2,rx.YYYY.parse),precision:"day"},"YYYY-WW-d":{test:reg(rx.YYYY.test,s0,rx.W.test,s1,rx.DOW.test),parse:reg(rx.YYYY.parse,s0,rx.W.parse,s1,rx.DOW.parse),precision:"day"},"MM/DD/YYYY HH:MM":{test:reg(rx.MM.test,"([\\-\\/])",rx.DD.test,"\\2",rx.YYYY.test,s3,rx.HHMM.test),parse:reg(rx.MM.parse,"([\\-\\/])",rx.DD.parse,"\\2",rx.YYYY.parse,s3,rx.HHMM.parse),precision:"day-minutes"},"DD.MM.YYYY HH:MM":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.YYYY.test,s3,rx.HHMM.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.YYYY.parse,s3,rx.HHMM.parse),precision:"day-minutes"},"YYYY-MM-DD HH:MM":{test:reg(rx.YYYY.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.DD.test,s3,rx.HHMM.test),parse:reg(rx.YYYY.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.DD.parse,s3,rx.HHMM.parse),precision:"day-minutes"},ISO8601:{test:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,parse:function(e){return e},precision:"day-seconds"}};function reg(){return new RegExp(begin+Array.prototype.slice.call(arguments).join(" *")+end,"i")}function test(e,t){var r=knownFormats[t];return underscore.isRegExp(r.test)?r.test.test(e):r.test(e,t)}function parse(e,t){var r=knownFormats[t];return underscore.isRegExp(r.parse)?e.match(r.parse):r.parse(e,t)}function dateFromIsoWeek(e,t,r){var n=new Date(Date.UTC(e,0,3));return n.setUTCDate(3-n.getUTCDay()+7*(t-1)+parseInt(r,10)),n}function dateToIsoWeek(e){var t=e.getUTCDay(),r=new Date(e.valueOf());r.setDate(r.getDate()-(t+6)%7+3);var n=r.getUTCFullYear(),a=Math.floor((r.getTime()-new Date(n,0,1,-6))/864e5);return[n,1+Math.floor(a/7),t>0?t:7]}function hour(e,t){return 12!==e?e+("pm"===t?12:0):"am"===t?0:12}function date(e){var t,r=0,n={},a=["",0];e=e||[],underscore.each(knownFormats,function(t,r){underscore.each(e,function(e){void 0===n[r]&&(n[r]=0),test(e,r)&&(n[r]+=1,n[r]>a[1]&&(a[0]=r,a[1]=n[r]))})}),t=a[0];var o={parse:function(e){if(underscore.isDate(e)||underscore.isUndefined(e))return e;if(!t||!underscore.isString(e))return r++,e;var n=parse(e.toLowerCase(),t);if(!n)return r++,e;function a(e){return(e=+e)<20?2e3+e:1900+e}test(e,t)||r++;var o=(new Date).getFullYear();switch(t){case"YYYY":return new Date(n[1],0,1);case"YYYY-H":return new Date(n[1],6*(n[2]-1),1);case"H-YYYY":return new Date(n[2],6*(n[1]-1),1);case"YYYY-Q":return new Date(n[1],3*(n[2]-1),1);case"Q-YYYY":return new Date(n[2],3*(n[1]-1),1);case"YYYY-M":return new Date(n[1],n[2]-1,1);case"M-YYYY":return new Date(n[2],n[1]-1,1);case"YYYY-MMM":return new Date(+n[1],shortMonthKey[n[2]],1);case"MMM-YYYY":return new Date(+n[2],shortMonthKey[n[1]],1);case"MMM-YY":return new Date(a(+n[2]),shortMonthKey[n[1]],1);case"MMM":return new Date(o,shortMonthKey[n[1]],1);case"YYYY-WW":return dateFromIsoWeek(n[1],n[2],1);case"WW-YYYY":return dateFromIsoWeek(n[2],n[1],1);case"YYYY-WW-d":return dateFromIsoWeek(n[1],n[2],n[3]);case"YYYY-MM-DD":return new Date(n[1],n[3]-1,n[4]);case"DD/MM/YYYY":return new Date(n[4],n[3]-1,n[1]);case"DD/MMM/YYYY":return new Date(n[4],shortMonthKey[n[3]],n[1]);case"DD/MMM/YY":return new Date(a(n[4]),shortMonthKey[n[3]],n[1]);case"MM/DD/YYYY":return new Date(n[4],n[1]-1,n[3]);case"MMM-DD-YYYY":return new Date(n[3],shortMonthKey[n[1]],n[2]);case"YYYY-MM-DD HH:MM":return new Date(+n[1],n[3]-1,+n[4],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"DD.MM.YYYY HH:MM":return new Date(+n[4],n[3]-1,+n[1],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"MM/DD/YYYY HH:MM":return new Date(+n[4],n[1]-1,+n[3],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"ISO8601":return new Date(n.toUpperCase());default:console.warn("unknown format",t)}return r++,e},toNum:function(e){return e.getTime()},fromNum:function(e){return new Date(e)},errors:function(){return r},name:function(){return"date"},format:function(e){return arguments.length?(t=e,o):t},precision:function(){return knownFormats[t].precision},formatter:function(){if(!t)return underscore.identity;var e=Globalize.culture().calendar.patterns.M.replace("MMMM","MMM");switch(knownFormats[t].precision){case"year":return function(e){return underscore.isDate(e)?e.getFullYear():e};case"half":return function(e){return underscore.isDate(e)?e.getFullYear()+" H"+(e.getMonth()/6+1):e};case"quarter":return function(e){return underscore.isDate(e)?e.getFullYear()+" Q"+(e.getMonth()/3+1):e};case"month":return function(e){return underscore.isDate(e)?Globalize.format(e,"MMM yy"):e};case"week":return function(e){return underscore.isDate(e)?dateToIsoWeek(e).slice(0,2).join(" W"):e};case"day":return function(e,t){return underscore.isDate(e)?Globalize.format(e,t?"D":"d"):e};case"day-minutes":return function(t){return underscore.isDate(t)?Globalize.format(t,e).replace(" ","&nbsp;")+" - "+Globalize.format(t,"t").replace(" ","&nbsp;"):t};case"day-seconds":return function(e){return underscore.isDate(e)?Globalize.format(e,"T").replace(" ","&nbsp;"):e}}},isValid:function(e){return underscore.isDate(o.parse(e))},ambiguousFormats:function(){var e=[];return underscore.each(n,function(t,r){t===a[1]&&e.push([r,r])}),e}};return o}var columnTypes={text:text,number:number,date:date},TAGS=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,COMMENTS_AND_PHP_TAGS=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,defaultAllowed="<a><b><br><br/><i><strong><sup><sub><strike><u><em><tt>";function purifyHtml(e,t){if(null===e)return null;if(void 0!==e){if((e=String(e)).indexOf("<")<0||e.indexOf(">")<0)return e;if(e=stripTags(e,t),"undefined"==typeof document)return e;var r=document.createElement("div");r.innerHTML=e;for(var n=r.querySelectorAll("*"),a=0;a<n.length;a++)for(var o=0;o<n[a].attributes.length;o++){var i=n[a].attributes[o];i.specified&&"on"===i.name.substr(0,2)&&n[a].removeAttribute(i.name)}return r.innerHTML}}function stripTags(e,t){t=(((void 0!==t?t||"":defaultAllowed)+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");for(var r=e,n=e;;)if((r=n)===(n=r.replace(COMMENTS_AND_PHP_TAGS,"").replace(TAGS,function(e,r){return t.indexOf("<"+r.toLowerCase()+">")>-1?e:""})))return n}function column(e,t,r){function n(e){return null!==e&&void 0!==e&&""!==e}var a,o,i=underscore.shuffle(underscore.range(t.length)).filter(function(e){return n(t[e])}).slice(0,200).map(function(e){return t[e]});r=r?columnTypes[r](i):function(e){if(underscore.every(t,underscore.isNumber))return columnTypes.number();if(underscore.every(t,underscore.isDate))return columnTypes.date();var r,a=[columnTypes.date(e),columnTypes.number(e),columnTypes.text()],o=.1*t.filter(n).length;return underscore.each(t,function(e){underscore.each(a,function(t){t.parse(e)})}),underscore.every(a,function(e){return e.errors()<o&&(r=e),!r}),underscore.isUndefined(r)&&(r=a[2]),r}(i);var u,s=t.slice(0),c={name:function(){return arguments.length?(e=arguments[0],c):purifyHtml(e)},title:function(){return arguments.length?(u=arguments[0],c):purifyHtml(u||e)},length:t.length,val:function(e,n){if(arguments.length){var a=n?s:t;return e<0&&(e+=a.length),r.parse(purifyHtml(a[e]))}},values:function(e){var n=e?s:t;return n=underscore.map(n,function(e){return purifyHtml(e)}),underscore.map(n,r.parse)},each:function(e){for(var r=0;r<t.length;r++)e(c.val(r),r)},raw:function(e,r){return arguments.length?2===arguments.length?(t[e]=r,c):purifyHtml(t[e]):t},type:function(e){if(!0===e)return r;if(underscore.isString(e)){if(columnTypes[e])return r=columnTypes[e](i),c;throw new Error("unknown column type: "+e)}return r.name()},range:function(){return!!r.toNum&&(a||(a=[Number.MAX_.VALUE,-Number.MAX_.VALUE],c.each(function(e){e=r.toNum(e),underscore.isNumber(e)&&!underscore.isNaN(e)&&(e<a[0]&&(a[0]=e),e>a[1]&&(a[1]=e))}),a[0]=r.fromNum(a[0]),a[1]=r.fromNum(a[1])),a)},total:function(){return!!r.toNum&&(o||(o=0,c.each(function(e){o+=r.toNum(e)}),o=r.fromNum(o)),o)},filterRows:function(e){return t=[],arguments.length?underscore.each(e,function(e){t.push(s[e])}):t=s.slice(0),c.length=t.length,a=o=!1,c},toString:function(){return e+" ("+r.name()+")"},indexOf:function(e){return underscore.find(underscore.range(t.length),function(t){return c.val(t)===e})},limitRows:function(e){s.length>e&&(s.length=e,t.length=e,c.length=e)}};return c}function delimited(e){return{dataset:function(){if(e.url);else if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(t){return new DelimitedParser(e).parse(t)});throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return new DelimitedParser(e).parse(e.csv)}}}var DelimitedParser=function(e){e=Object.assign({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:!1,firstRowIsHeader:!0},e),this.__delimiterPatterns=getDelimiterPatterns(e.delimiter,e.quoteChar),this.opts=e};function getDelimiterPatterns(e,t){return new RegExp("(\\"+e+"|\\r?\\n|\\r|^)(?:"+t+"([^"+t+"]*(?:"+t+'"[^'+t+"]*)*)"+t+"|([^"+t+"\\"+e+"\\r\\n]*))","gi")}function json(e){return{dataset:function(){if(e.url)return fetch(e.url).then(function(e){return e.text()}).then(function(e){return JSON.parse(e)});if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(e){return JSON.parse(e)});throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return JSON.parse(e.csv)}}}function reorderColumns(e,t){var r=e.getMetadata("data.column-order",[]);return r.length&&r.length===t.numColumns()&&t.columnOrder(r),t}function applyChanges(e,t){var r=e.getMetadata("data.changes",[]),n=e.getMetadata("data.transpose",!1);r.forEach(function(e){var r="row",a="column";n&&(r="column",a="row"),t.hasColumn(e[a])&&(0===e[r]?t.column(e[a]).title(e.value):t.column(e[a]).raw(e[r]-1,e.value))});var a=e.getMetadata("data.column-format",{});return underscore.each(a,function(e,r){e.type&&t.hasColumn(r)&&"auto"!==e.type&&t.column(r).type(e.type),e["input-format"]&&t.hasColumn(r)&&t.column(r).type(!0).format(e["input-format"])}),t}function arrayMin(e,t){var r,n,a=e.length,o=-1;if(null==t){for(;++o<a;)if(null!=(r=e[o])&&r>=r)for(n=r;++o<a;)null!=(r=e[o])&&n>r&&(n=r)}else for(;++o<a;)if(null!=(r=t(e[o],o,e))&&r>=r)for(n=r;++o<a;)null!=(r=t(e[o],o,e))&&n>r&&(n=r);return n}function arrayMax(e,t){var r,n,a=e.length,o=-1;if(null==t){for(;++o<a;)if(null!=(r=e[o])&&r>=r)for(n=r;++o<a;)null!=(r=e[o])&&r>n&&(n=r)}else for(;++o<a;)if(null!=(r=t(e[o],o,e))&&r>=r)for(n=r;++o<a;)null!=(r=t(e[o],o,e))&&r>n&&(n=r);return n}function arraySum(e,t){var r,n=e.length,a=-1,o=0;if(null==t)for(;++a<n;)(r=+e[a])&&(o+=r);else for(;++a<n;)(r=+t(e[a],a,e))&&(o+=r);return o}function number$1(e){return null===e?NaN:+e}function arrayMean(e,t){var r,n=e.length,a=n,o=-1,i=0;if(null==t)for(;++o<n;)isNaN(r=number$1(e[o]))?--a:i+=r;else for(;++o<n;)isNaN(r=number$1(t(e[o],o,e)))?--a:i+=r;if(a)return i/a}function ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function quantile(e,t,r){if(null==r&&(r=number$1),n=e.length){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,o=Math.floor(a),i=+r(e[o],o,e);return i+(+r(e[o+1],o+1,e)-i)*(a-o)}}function arrayMedian(e,t){var r,n=e.length,a=-1,o=[];if(null==t)for(;++a<n;)isNaN(r=number$1(e[a]))||o.push(r);else for(;++a<n;)isNaN(r=number$1(t(e[a],a,e)))||o.push(r);return quantile(o.sort(ascending),.5)}function columnNameToVariable(e){return e.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/-/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/^(abstract|arguments|await|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|eval|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|let|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var|void|volatile|while|window|with|yield)$/,"$1_")}function addComputedColumns(chart,dataset){var virtualColumns=chart.getMetadata("describe.computed-columns",{}),data=dataset.list(),columnNameToVar={},columnAggregates={};return dataset.eachColumn(function(e){e.isComputed||(columnNameToVar[e.name()]=columnNameToVariable(e.name()),"number"===e.type()&&(columnAggregates[e.name()]={min:arrayMin(e.values()),max:arrayMax(e.values()),sum:arraySum(e.values()),mean:arrayMean(e.values()),median:arrayMedian(e.values())}))}),underscore.each(virtualColumns,addComputedColumn),dataset;function addComputedColumn(formula,name){var datefmt=function(e){return e.getFullYear()+"-"+leftPad(1+e.getMonth(),2,0)+"-"+leftPad(1+e.getDate(),2,0)},values=data.map(function(row,rowIndex){var context=[];return context.push("var __row = "+rowIndex+";"),row.forEach(function(e,t){columnNameToVar[t]&&(context.push("var "+columnNameToVar[t]+" = "+JSON.stringify(e)+";"),"number"===dataset.column(t).type()&&(context.push("var "+columnNameToVar[t]+"__sum = "+columnAggregates[t].sum+";"),context.push("var "+columnNameToVar[t]+"__min = "+columnAggregates[t].min+";"),context.push("var "+columnNameToVar[t]+"__max = "+columnAggregates[t].max+";"),context.push("var "+columnNameToVar[t]+"__mean = "+columnAggregates[t].mean+";"),context.push("var "+columnNameToVar[t]+"__median = "+columnAggregates[t].median+";")))}),context.push("var max = Math.max, min = Math.min;"),function(){try{return eval(this.context.join("\n")+"\n"+formula)}catch(e){return console.warn(e),"n/a"}}.call({context:context})}).map(function(e){return underscore.isBoolean(e)?e?"yes":"no":underscore.isDate(e)?datefmt(e):underscore.isNumber(e)?""+e:String(e)}),virtualColumn=column(name,values);virtualColumn.isComputed=!0,dataset.add(virtualColumn)}function leftPad(e,t,r){for(e=String(e);e.length<t;)e=String(r)+e;return e}}function loadGlobalizeLocale(e,t){window.Globalize.cultures.hasOwnProperty(e)?(window.Globalize.culture(e),"function"==typeof t&&t()):getScript("/static/vendor/globalize/cultures/globalize.culture."+e+".js",function(){window.Globalize.culture(e),"function"==typeof t&&t()})}function getScript(e,t){var r=document.createElement("script"),n=document.getElementsByTagName("script")[0];r.async=1,r.onload=r.onreadystatechange=function(e,n){(n||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,r=void 0,n||t&&t())},r.src=URL,n.parentNode.insertBefore(r,n)}function fetchJSON(e,t,r,n,a){var o={method:t,body:n,mode:"cors",credentials:r};window.fetch(e,o).then(function(e){return 200!==e.status?new Error(e.statusText):e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return console.warn("malformed json input",e),e}}).then(a).catch(function(e){console.error(e)})}function putJSON(e,t,r){return fetchJSON(e,"PUT","include",t,r)}function getNestedValue(e,t){for(var r=0;r<t.length;r+=1){if(!e)return;e=e[t[r]]}return e}function observeDeep(e,t,r){var n=e.replace(/\[(\d+)\]/g,".$1").split("."),a=n[0],o=t.bind(this),i=getNestedValue(this.get(),n);return r&&!1===r.init||o(i),this.on(r&&r.defer?"update":"state",function(e){var t=e.changed,r=e.current;e.previous;if(t[a]){var u=getNestedValue(r,n);u===i&&"object"!=typeof u&&"function"!=typeof u||(o(u,i),i=u)}})}DelimitedParser.prototype.parse=function(e){this.__rawData=e;var t=this.opts;"auto"===t.delimiter&&(t.delimiter=this.guessDelimiter(e,t.skipRows),this.__delimiterPatterns=getDelimiterPatterns(t.delimiter,t.quoteChar));var r,n="|"!==t.delimiter?"|":"#";return e=n+"\n"+e.replace(/\s+$/g,"")+n,r=function(e,t,r){r=r||",";for(var a,o=[[]],i=null;i=e.exec(t);){var u=i[1];u.length&&u!==r&&o.push([]),a=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],o[o.length-1].push(a)}o[0][0].substr(0,1)===n&&(o[0][0]=o[0][0].substr(1));var s=o.length-1,c=o[s].length-1,l=o[s][c].length-1;return o[s][c].substr(l)===n&&(o[s][c]=o[s][c].substr(0,l)),o.slice(1)}(this.__delimiterPatterns,e,t.delimiter),t.transpose&&(r=function(e){var t,r,n=e,a=n.length?n.length:0,o=n[0]instanceof Array?n[0].length:0;if(0===o||0===a)return[];var i=[];for(t=0;t<o;t++)for(i[t]=[],r=0;r<a;r++)i[t][r]=n[r][t];return i}(r)),function(e){var r=[],n={},a=e.length,o=e[0].length,i=t.skipRows,u=[];t.firstRowIsHeader&&(u=e[i],i++);for(var s=0;s<o;s++){var c=underscore.isString(u[s])?u[s].replace(/^\s+|\s+$/g,""):"",l=""!==c?"":1;for(c=""!==c?c:"X.";void 0!==n[c+l];)l=""===l?1:l+1;r.push({name:c+l,data:[]}),n[c+l]=!0}return underscore.range(i,a).forEach(function(n){r.forEach(function(r,a){r.data.push(""!==e[n][a]?e[n][a]:t.emptyValue)})}),dataset(r=r.map(function(e){return column(e.name,e.data)}))}(r)},DelimitedParser.prototype.guessDelimiter=function(e){var t=0,r=-1,n=this,a=["\t",";","|",","];return a.forEach(function(a,o){var i=getDelimiterPatterns(a,n.quoteChar),u=e.match(i).length;"\t"===a&&(u*=1.15),u>t&&(t=u,r=o)}),a[r]};var storeChanges=underscore.debounce(function(e,t){var r=e.serialize();putJSON("/api/2/charts/"+r.id,JSON.stringify(r),function(){t&&t()})},1e3),storeData=underscore.debounce(function(e,t){var r=e.getMetadata("data.json")?JSON.stringify(e.dataset()):e.rawData();putJSON("/api/2/charts/"+e.get("id")+"/data",r,function(){t&&t()})},1e3),Chart=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(e,t){var r=this,n={firstRowIsHeader:this.getMetadata("data.horizontal-header",!0),transpose:this.getMetadata("data.transpose",!1)};return e&&!t?n.csv=e:n.url=t||"data.csv",n.csv&&(this._rawData=n.csv),(this.getMetadata("data.json",!1)?json(n):delimited(n)).dataset().then(function(e){return r.dataset(e),e}).catch(function(e){console.error("could not fetch datasource",e)})},t.prototype.dataset=function(e){if(arguments.length){!0!==e&&(this._dataset_cache=e);var t="function"!=typeof e.list;return this._dataset=t?e:reorderColumns(this,applyChanges(this,addComputedColumns(this,!0===e?this._dataset_cache:e))),t&&this.set({dataset:e}),this._dataset}return this._dataset},t.prototype.theme=function(e){return arguments.length?(this.set({theme:e}),this):this.get().theme},t.prototype.vis=function(e){return arguments.length?(this.set({vis:e}),this):this.get().vis},t.prototype.locale=function(e,t){return arguments.length&&(this._locale=e=e.replace("_","-"),window.Globalize&&loadGlobalizeLocale(e,t)),this._locale},t.prototype.getMetadata=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=this.get().metadata;if(!e)return r;var n=e.split("."),a=r;return underscore.some(n,function(e){return!(!underscore.isUndefined(a)&&!underscore.isNull(a))||(a=a[e],!1)}),underscore.isUndefined(a)||underscore.isNull(a)?t:a},t.prototype.setMetadata=function(e,t){var r=e.split("."),n=r.pop(),a=this.get().metadata,o=a;return r.forEach(function(e){(underscore.isUndefined(o[e])||underscore.isNull(o[e]))&&(o[e]={}),o=o[e]}),deepEqual(o[n],t)||(o[n]=t,this.set({metadata:a})),this},t.prototype.store=function(e){storeChanges(this,e)},t.prototype.storeData=function(e){storeData(this,e)},t.prototype.serialize=function(){var e=this.get(),t={};return["id","title","theme","createdAt","lastModifiedAt","type","metadata","authorId","showInGallery","language","guestSession","lastEditStep","publishedAt","publicUrl","publicVersion","organizationId","forkedFrom","externalData","forkable","isFork","inFolder","author"].forEach(function(r){t[r]=e[r]}),t},t.prototype.passiveMode=function(){var e=this;this.set({passiveMode:!0}),setTimeout(function(){return e.set({passiveMode:!1})},100)},t.prototype.isPassive=function(){return this.get().passiveMode},t.prototype.rawData=function(){return this._rawData},t}(Store);function deepEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}Chart.prototype.observeDeep=observeDeep;var data$1={},main={App:ChartEditor,Chart:Chart,data:data$1};return main});
