!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("../../../../../../static/vendor/jschardet/jschardet.min.js"),require("../../../../../../static/vendor/xlsx/xlsx.full.min.js")):"function"==typeof define&&define.amd?define("svelte/editor",["../../../../../../static/vendor/jschardet/jschardet.min.js","../../../../../../static/vendor/xlsx/xlsx.full.min.js"],e):t.editor=e(t.jschardet)}(this,function(t){"use strict";function e(){}function n(t,e){for(var n in e)t[n]=e[n];return t}function a(t,e){e.appendChild(t)}function r(t,e,n){e.insertBefore(t,n)}function s(t){t.parentNode.removeChild(t)}function i(t){for(;t.nextSibling;)t.parentNode.removeChild(t.nextSibling)}function o(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(t,e,n){t.addEventListener(e,n,!1)}function l(t,e,n){t.removeEventListener(e,n,!1)}function h(t,e,n){t.setAttribute(e,n)}function f(t,e,n){t.style.setProperty(e,n)}function p(t,e){for(var n=0;n<t.options.length;n+=1){var a=t.options[n];if(a.__value===e)return void(a.selected=!0)}}function v(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function _(){return Object.create(null)}function m(t){this.destroy=e,this.fire("destroy"),this.set=this.get=e,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function g(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function y(t,e){return t!=t?e==e:t!==e}function b(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var a=0;a<n.length;a+=1){var r=n[a];r.__calling||(r.__calling=!0,r.call(this,e),r.__calling=!1)}}function x(t){return t?this._state[t]:this._state}function w(t,e){t._handlers=_(),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=t.root.store||e.store}function S(t,e,n){var a=e.bind(this);return n&&!1===n.init||a(this.get()[t],void 0),this.on(n&&n.defer?"update":"state",function(e){e.changed[t]&&a(e.current[t],e.previous&&e.previous[t])})}function D(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function N(t){for(;t&&t.length;)t.shift()()}function T(){this.store._remove(this)}t=t&&t.hasOwnProperty("default")?t.default:t;var k={destroy:m,get:x,fire:b,observe:S,on:D,set:function(t){this._set(n({},t)),this.root._lock||(this.root._lock=!0,N(this.root._beforecreate),N(this.root._oncreate),N(this.root._aftercreate),this.root._lock=!1)},teardown:m,_recompute:e,_set:function(t){var e=this._state,a={},r=!1;for(var s in t)this._differs(t[s],e[s])&&(a[s]=r=!0);r&&(this._state=n(n({},e),t),this._recompute(a,this._state),this._bind&&this._bind(a,this._state),this._fragment&&(this.fire("state",{changed:a,current:this._state,previous:e}),this._fragment.p(a,this._state),this.fire("update",{changed:a,current:this._state,previous:e})))},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:g};function A(t,e){return void 0===e&&(e="core"),dw.backend.__messages[e][t]||dw.backend.__messages.core[t]||t}function j(t){var e=typeof t;return"function"===e||"object"===e&&!!t}var M=Array.prototype,P=Object.prototype,C=M.slice,L=P.toString,O=P.hasOwnProperty,R=Object.keys;function $(t,e){return null!=t&&O.call(t,e)}function E(t){if(!j(t))return[];if(R)return R(t);var e=[];for(var n in t)$(t,n)&&e.push(n);return at&&function(t,e){var n=rt.length,a=t.constructor,r=q(a)&&a.prototype||P,s="constructor";$(t,s)&&!B(e,s)&&e.push(s);for(;n--;)(s=rt[n])in t&&t[s]!==r[s]&&!B(e,s)&&e.push(s)}(t,e),e}var F,H,U,I=(F=1,H=st,U=function(t,e,n,a){for(var r=(n=W(n,a,1))(e),s=0,i=et(t);s<i;){var o=Math.floor((s+i)/2);n(t[o])<r?s=o+1:i=o}return s},function(t,e,n){var a=0,r=et(t);if("number"==typeof n)F>0?a=n>=0?n:Math.max(n+r,a):r=n>=0?Math.min(n+1,r):n+r+1;else if(U&&n&&r)return n=U(t,e),t[n]===e?n:-1;if(e!=e)return(n=H(C.call(t,a,r),z))>=0?n+a:-1;for(n=F>0?a:r-1;n>=0&&n<r;n+=F)if(t[n]===e)return n;return-1});function B(t,e,n,a){return nt(t)||(t=function(t){for(var e=E(t),n=e.length,a=Array(n),r=0;r<n;r++)a[r]=t[e[r]];return a}(t)),("number"!=typeof n||a)&&(n=0),I(t,e,n)>=0}var q=("object"!=typeof Int8Array&&"undefined"!=typeof document&&"function"!=typeof document.childNodes?function(t){return"function"==typeof t||!1}:null)||function(t){return"[object Function]"===L.call(t)};!function(){L.call(arguments)}();function z(t){return function(t){return"[object Number]"===L.call(t)}(t)&&isNaN(t)}var X=Q;function V(t){return t}var Z,G,J=(Z=E,function(t){var e=arguments,n=arguments.length;if(G&&(t=Object(t)),n<2||null==t)return t;for(var a=1;a<n;a++)for(var r=e[a],s=Z(r),i=s.length,o=0;o<i;o++){var c=s[o];!j(t)||G&&void 0!==t[c]||(t[c]=r[c])}return t});function K(t){return t=J({},t),function(e){return function(t,e){var n=E(e),a=n.length;if(null==t)return!a;for(var r=Object(t),s=0;s<a;s++){var i=n[s];if(e[i]!==r[i]||!(i in r))return!1}return!0}(e,t)}}function Q(t,e){return W(t,e,1/0)}function W(t,e,n){return X!==Q?X(t,e):null==t?V:q(t)?function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,a,r){return t.call(e,n,a,r)};case 4:return function(n,a,r,s){return t.call(e,n,a,r,s)}}return function(){return t.apply(e,arguments)}}(t,e,n):j(t)?K(t):Y(t)}function Y(t){return function(e){return null==e?void 0:e[t]}}var tt=Math.pow(2,53)-1,et=Y("length"),nt=function(t){var e=et(t);return"number"==typeof e&&e>=0&&e<=tt};var at=!{toString:null}.propertyIsEnumerable("toString"),rt=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];!function(t){for(var e={},n=E(t),a=0,r=n.length;a<r;a++)e[t[n[a]]]=n[a]}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"});var st=function(t){return function(e,n,a){n=W(n,a);for(var r=et(e),s=t>0?0:r-1;s>=0&&s<r;s+=t)if(n(e[s],s,e))return s;return-1}}(1);function it(t,e,n){e=W(e,n);for(var a,r=E(t),s=0,i=r.length;s<i;s++)if(e(t[a=r[s]],a,t))return a}function ot(t,e){return function(t,e,n){var a=(nt(t)?st:it)(t,e,n);if(void 0!==a&&-1!==a)return t[a]}(t,K(e))}var ct={select:function(t,e){if(!e.redirect&&(t.preventDefault(),!e.readonly&&(this.fire("select",e),"/edit/"==location.pathname.substr(0,6)))){var n=this.store.get().chart;window.history.pushState({step:e,chart:n},"","/edit/"+n.id+"/"+e.id)}}};function ut(t,n){var a;return{c:function(){a=c("i"),this.h()},h:function(){a.className="fa fa-check"},m:function(t,e){r(a,t,e)},u:function(){s(a)},d:e}}function dt(t){w(this,t),this._state=n({step:{title:"",index:1},maxStep:1,active:1},t.data),this._recompute({active:1,steps:1,index:1,active_i:1,maxStep:1,step:1,passed:1},this._state),this._fragment=function(t,e){var n,i,o,h,p,v,_,m,g,y=e.step.title,b=e.passed&&ut();function x(e){var n=t.get();t.select(e,n.step)}return{c:function(){n=c("a"),i=c("span"),o=u(e.index),h=u("\n    "),p=c("span"),v=u("\n    "),b&&b.c(),_=u("\n    "),m=c("div"),this.h()},h:function(){i.className="step",p.className="title",m.className="corner",d(n,"click",x),f(n,"width",95/e.steps.length+"%"),n.href=g=e.step.redirect?e.step.redirect:"#"+e.step.id,n.className=e.class_},m:function(t,e){r(n,t,e),a(i,n),a(o,i),a(h,n),a(p,n),p.innerHTML=y,a(v,n),b&&b.m(n,null),a(_,n),a(m,n)},p:function(t,e){t.index&&(o.data=e.index),t.step&&y!==(y=e.step.title)&&(p.innerHTML=y),e.passed?b||((b=ut()).c(),b.m(n,_)):b&&(b.u(),b.d(),b=null),t.steps&&f(n,"width",95/e.steps.length+"%"),t.step&&g!==(g=e.step.redirect?e.step.redirect:"#"+e.step.id)&&(n.href=g),t.class_&&(n.className=e.class_)},u:function(){p.innerHTML="",s(n),b&&b.u()},d:function(){b&&b.d(),l(n,"click",x)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}n(dt.prototype,k),n(dt.prototype,ct),dt.prototype._recompute=function(t,e){var n,a,r;(t.active||t.steps)&&this._differs(e.active_id,e.active_id=(a=(n=e).active,(r=n.steps).indexOf(ot(r,{id:a}))))&&(t.active_id=!0),(t.index||t.active_i||t.maxStep)&&this._differs(e.passed,e.passed=function(t){var e=t.index,n=t.active_i;return e<t.maxStep&&e!=n}(e))&&(t.passed=!0),(t.step||t.index||t.active||t.maxStep||t.passed)&&this._differs(e.class_,e.class_=function(t){var e=t.step,n=t.index,a=t.active,r=t.maxStep,s=t.passed,i=[];return e.readonly&&i.push("readonly"),a==e.id?i.push("active"):(n>r&&i.push("unseen"),s&&i.push("passed")),i.join(" ")}(e))&&(t.class_=!0)};var lt={select:function(t,e){this.set({active:t.id});var n=this.get().maxStep;this.set({maxStep:Math.max(n,e)})}};function ht(t,e){var n=e.step,a=e.each_value,r=e.i,s={},i={index:r+1};r in e.each_value&&(i.step=n,s.step=!0),"steps"in e&&(i.steps=e.steps,s.steps=!0),"active"in e&&(i.active=e.active,s.active=!0),"maxStep"in e&&(i.maxStep=e.maxStep,s.maxStep=!0);var o=new dt({root:t.root,data:i,_bind:function(e,n){var i=t.get(),o={};!s.step&&e.step&&(a[r]=n.step,o.steps=i.steps),!s.steps&&e.steps&&(o.steps=n.steps),!s.active&&e.active&&(o.active=n.active),!s.maxStep&&e.maxStep&&(o.maxStep=n.maxStep),t._set(o),s={}}});return t.root._beforecreate.push(function(){o._bind({step:1,steps:1,active:1,maxStep:1},o.get())}),o.on("select",function(e){t.select(n,r)}),{c:function(){o._fragment.c()},m:function(t,e){o._mount(t,e)},p:function(t,e){n=e.step,a=e.each_value,r=e.i;var i={};i.index=r+1,!s.step&&t.steps&&(i.step=n,s.step=!0),!s.steps&&t.steps&&(i.steps=e.steps,s.steps=!0),!s.active&&t.active&&(i.active=e.active,s.active=!0),!s.maxStep&&t.maxStep&&(i.maxStep=e.maxStep,s.maxStep=!0),o._set(i),s={}},u:function(){o._unmount()},d:function(){o.destroy(!1)}}}function ft(t){w(this,t),this._state=n({steps:[]},t.data),t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){for(var a,i=e.steps,u=[],d=0;d<i.length;d+=1)u[d]=ht(t,n(n({},e),{each_value:i,step:i[d],i:d}));return{c:function(){a=c("div");for(var t=0;t<u.length;t+=1)u[t].c();this.h()},h:function(){a.className="create-nav svelte-nols97"},m:function(t,e){r(a,t,e);for(var n=0;n<u.length;n+=1)u[n].m(a,null)},p:function(e,r){var s=r.steps;if(e.steps||e.active||e.maxStep){for(var i=0;i<s.length;i+=1){var o=n(n({},r),{each_value:s,step:s[i],i:i});u[i]?u[i].p(e,o):(u[i]=ht(t,o),u[i].c(),u[i].m(a,null))}for(;i<u.length;i+=1)u[i].u(),u[i].d();u.length=s.length}},u:function(){s(a);for(var t=0;t<u.length;t+=1)u[t].u()},d:function(){o(u)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,N(this._beforecreate),N(this._oncreate),N(this._aftercreate),this._lock=!1)}function pt(t,e,n){return function(t,e,n,a,r){var s={method:e,body:a,mode:"cors",credentials:n};window.fetch(t,s).then(function(t){if(200!=t.status)return new Error(t.statusText);try{return t.json()}catch(e){return t.text()}}).then(r).catch(function(t){console.error(t)})}(t,"PUT","include",e,n)}n(ft.prototype,k),n(ft.prototype,lt);var vt,_t=Date.now||function(){return(new Date).getTime()};var mt,gt=dw.backend.currentChart,yt=function(t,e,n){var a,r,s,i,o=0;n||(n={});var c=function(){o=!1===n.leading?0:_t(),a=null,i=t.apply(r,s),a||(r=s=null)},u=function(){var u=_t();o||!1!==n.leading||(o=u);var d=e-(u-o);return r=this,s=arguments,d<=0||d>e?(a&&(clearTimeout(a),a=null),o=u,i=t.apply(r,s),a||(r=s=null)):a||!1===n.trailing||(a=setTimeout(c,d)),i};return u.cancel=function(){clearTimeout(a),o=0,a=r=s=null},u}(function(){var t=vt.get().chartData;pt("/api/charts/"+gt.get("id")+"/data",t)},1e3);function bt(t){var e=t.changed,n=t.current,a=t.previous;e.chartData&&n.chartData&&a&&a.chartData!=n.chartData&&yt()}function xt(t){w(this,t),this._state=n({placeholder:A("upload / paste here")},t.data),this._handlers.update=[bt];var e=this;t.root||(this._oncreate=[]),this._fragment=function(t,e){var n,i,o,u=!1;function h(){u=!0,t.set({chartData:o.value}),u=!1}return{c:function(){n=c("form"),i=c("div"),o=c("textarea"),this.h()},h:function(){d(o,"input",h),o.readOnly=e.readonly,o.id="upload-data-text",f(o,"resize","none"),o.placeholder=e.placeholder,o.className="svelte-h5ftni",i.className="control-group",n.className="upload-form"},m:function(t,s){r(n,t,s),a(i,n),a(o,i),o.value=e.chartData},p:function(t,e){u||(o.value=e.chartData),t.readonly&&(o.readOnly=e.readonly),t.placeholder&&(o.placeholder=e.placeholder)},u:function(){s(n)},d:function(){l(o,"input",h)}}}(this,this._state),this.root._oncreate.push(function(){(function(){vt=this}).call(e),e.fire("update",{changed:{chartData:1,readonly:1,placeholder:1},current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),N(this._oncreate))}function wt(t){var e=t.changed,n=t.current;if(e.selectedDataset&&"--"!=n.selectedDataset){var a=n.selectedDataset;this.set({chartData:a.data}),a.presets&&Object.keys(a.presets).forEach(function(t){dw.backend.currentChart.set(t,a.presets[t])})}}function St(t,e){for(var a,i,u=e.group,d=(e.each_value,e.group_index,u.datasets),l=[],f=0;f<d.length;f+=1)l[f]=Dt(t,n(n({},e),{each_value_1:d,dataset:d[f],dataset_index:f}));return{c:function(){a=c("optgroup");for(var t=0;t<l.length;t+=1)l[t].c();this.h()},h:function(){h(a,"label",i=u.type)},m:function(t,e){r(a,t,e);for(var n=0;n<l.length;n+=1)l[n].m(a,null)},p:function(e,r){u=r.group,r.each_value,r.group_index;var s=u.datasets;if(e.datasetsArray){for(var o=0;o<s.length;o+=1){var c=n(n({},r),{each_value_1:s,dataset:s[o],dataset_index:o});l[o]?l[o].p(e,c):(l[o]=Dt(t,c),l[o].c(),l[o].m(a,null))}for(;o<l.length;o+=1)l[o].u(),l[o].d();l.length=s.length}e.datasetsArray&&i!==(i=u.type)&&h(a,"label",i)},u:function(){s(a);for(var t=0;t<l.length;t+=1)l[t].u()},d:function(){o(l)}}}function Dt(t,n){n.group,n.each_value,n.group_index;var i,o,d,l=n.dataset,h=(n.each_value_1,n.dataset_index,l.title);return{c:function(){i=c("option"),o=u(h),this.h()},h:function(){i.__value=d=l,i.value=i.__value,i.className="demo-dataset"},m:function(t,e){r(i,t,e),a(o,i)},p:function(t,e){e.group,e.each_value,e.group_index,l=e.dataset,e.each_value_1,e.dataset_index,t.datasetsArray&&h!==(h=l.title)&&(o.data=h),t.datasetsArray&&d!==(d=l)&&(i.__value=d),i.value=i.__value},u:function(){s(i)},d:e}}function Nt(t){w(this,t),this._state=n({selectedDataset:"--"},t.data),this._recompute({datasets:1},this._state),this._handlers.update=[wt];var e=this;t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){for(var i,h,f,_,m,g,y,b,x,w,S=A("upload / quick help"),D=A("upload / try a dataset"),N=A("upload / sample dataset"),T=!1,k=e.datasetsArray,j=[],M=0;M<k.length;M+=1)j[M]=St(t,n(n({},e),{each_value:k,group:k[M],group_index:M}));function P(){T=!0,t.set({selectedDataset:v(b)}),T=!1}return{c:function(){i=c("p"),h=u(S),f=u("\n\n"),_=c("div"),m=c("p"),g=u(D),y=u("\n    "),b=c("select"),x=c("option"),w=u(N);for(var t=0;t<j.length;t+=1)j[t].c();this.h()},h:function(){x.__value="--",x.value=x.__value,d(b,"change",P),"selectedDataset"in e||t.root._beforecreate.push(P),b.disabled=e.readonly,b.id="demo-datasets",b.className="svelte-1jdst2k",_.className="demo-datasets"},m:function(t,n){r(i,t,n),a(h,i),r(f,t,n),r(_,t,n),a(m,_),a(g,m),a(y,_),a(b,_),a(x,b),a(w,x);for(var s=0;s<j.length;s+=1)j[s].m(b,null);p(b,e.selectedDataset)},p:function(e,a){var r=a.datasetsArray;if(e.datasetsArray){for(var s=0;s<r.length;s+=1){var i=n(n({},a),{each_value:r,group:r[s],group_index:s});j[s]?j[s].p(e,i):(j[s]=St(t,i),j[s].c(),j[s].m(b,null))}for(;s<j.length;s+=1)j[s].u(),j[s].d();j.length=r.length}T||p(b,a.selectedDataset),e.readonly&&(b.disabled=a.readonly)},u:function(){s(i),s(f),s(_);for(var t=0;t<j.length;t+=1)j[t].u()},d:function(){o(j),l(b,"change",P)}}}(this,this._state),this.root._oncreate.push(function(){e.fire("update",{changed:{datasets:1,readonly:1,selectedDataset:1,datasetsArray:1},current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),N(this._beforecreate),N(this._oncreate))}function Tt(t){var e=this,n=t.changed,a=t.current;n.sheets&&a.sheets.length>1?setTimeout(function(){e.set({selected:a.sheets[0]})},300):n.sheets&&1==a.sheets.length&&pt("/api/charts/"+dw.backend.currentChart.get("id")+"/data",a.sheets[0].csv,function(){window.location.href="describe"}),n.selected&&this.set({chartData:a.selected.csv})}function kt(t,n){var i,o,d,l=n.sheet,h=(n.each_value,n.sheet_index,l.name);return{c:function(){i=c("option"),o=u(h),this.h()},h:function(){i.__value=d=l,i.value=i.__value},m:function(t,e){r(i,t,e),a(o,i)},p:function(t,e){l=e.sheet,e.each_value,e.sheet_index,t.sheets&&h!==(h=l.name)&&(o.data=h),t.sheets&&d!==(d=l)&&(i.__value=d),i.value=i.__value},u:function(){s(i)},d:e}}function At(t,n){var a,i=A("upload / parsing-xls");return{c:function(){a=c("div"),this.h()},h:function(){a.className="alert alert-info"},m:function(t,e){r(a,t,e),a.innerHTML=i},p:e,u:function(){a.innerHTML="",s(a)},d:e}}function jt(t,e){for(var i,h,f,_,m,g=A("upload / select sheet"),y=!1,b=e.sheets,x=[],w=0;w<b.length;w+=1)x[w]=kt(0,n(n({},e),{each_value:b,sheet:b[w],sheet_index:w}));function S(){y=!0,t.set({selected:v(_)}),y=!1}return{c:function(){i=c("p"),h=u(g),f=u("\n    "),_=c("select");for(var t=0;t<x.length;t+=1)x[t].c();this.h()},h:function(){d(_,"change",S),"selected"in e||t.root._beforecreate.push(S),_.disabled=m=!e.sheets.length,_.className="svelte-1jdst2k"},m:function(t,n){r(i,t,n),a(h,i),r(f,t,n),r(_,t,n);for(var s=0;s<x.length;s+=1)x[s].m(_,null);p(_,e.selected)},p:function(t,e){var a=e.sheets;if(t.sheets){for(var r=0;r<a.length;r+=1){var s=n(n({},e),{each_value:a,sheet:a[r],sheet_index:r});x[r]?x[r].p(t,s):(x[r]=kt(0,s),x[r].c(),x[r].m(_,null))}for(;r<x.length;r+=1)x[r].u(),x[r].d();x.length=a.length}y||p(_,e.selected),t.sheets&&m!==(m=!e.sheets.length)&&(_.disabled=m)},u:function(){s(i),s(f),s(_);for(var t=0;t<x.length;t+=1)x[t].u()},d:function(){o(x),l(_,"change",S)}}}function Mt(t,n){var a,i=A("upload / xls / uploading data");return{c:function(){a=c("p")},m:function(t,e){r(a,t,e),a.innerHTML=i},p:e,u:function(){a.innerHTML="",s(a)},d:e}}function Pt(t){w(this,t),this._state=n({selected:!1,sheets:[]},t.data),this._handlers.update=[Tt];var e=this;t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){var n;function a(t){return t.sheets.length?t.sheets.length>1?jt:Mt:At}var i=a(e),o=i(t,e);return{c:function(){n=c("div"),o.c()},m:function(t,e){r(n,t,e),o.m(n,null)},p:function(e,r){i===(i=a(r))&&o?o.p(e,r):(o.u(),o.d(),(o=i(t,r)).c(),o.m(n,null))},u:function(){s(n),o.u()},d:function(){o.d()}}}(this,this._state),this.root._oncreate.push(function(){e.fire("update",{changed:{sheets:1,selected:1},current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),N(this._beforecreate),N(this._oncreate))}function Ct(e,n){var a=new FileReader;a.onload=function(){try{for(var r=new Uint8Array(a.result),s="",i=0,o=0;o<r.length;++o)r[o]>122&&i++,s+=String.fromCharCode(r[o]);var c=t.detect(s);c.confidence<=.95&&i<10&&(c.encoding="utf-8"),(a=new FileReader).onload=function(){return n(null,a.result)},a.readAsText(e,c.encoding)}catch(t){console.warn(t),n(null,a.result)}},a.readAsArrayBuffer(e)}n(xt.prototype,k),n(Nt.prototype,k),Nt.prototype._recompute=function(t,e){var n;t.datasets&&this._differs(e.datasetsArray,e.datasetsArray=(n=e.datasets,Object.keys(n).map(function(t){return n[t]})))&&(t.datasetsArray=!0)},n(Pt.prototype,k);var Lt=[{id:"copy",title:A("upload / copy-paste"),longTitle:A("upload / copy-paste / long"),icon:"fa fa-clipboard",mainPanel:xt,sidebar:Nt,action:function(){}},{id:"upload",title:A("upload / upload-csv"),longTitle:A("upload / upload-csv / long"),icon:"fa-file-excel-o fa",mainPanel:xt,sidebar:Nt,isFileUpload:!0,onFileUpload:function(t){var e=t.target.files[0];"text/"==e.type.substr(0,5)?(mt.set({Sidebar:Nt}),Ct(e,function(t,e){pt("/api/charts/"+dw.backend.currentChart.get("id")+"/data",e,function(){window.location.href="describe"})})):"application/"==e.type.substr(0,12)?(mt.set({Sidebar:Pt,sheets:[]}),function(t,e){var n="undefined"!=typeof FileReader&&(FileReader.prototype||{}).readAsBinaryString,a=new FileReader;a.onload=function(){try{var t=n?a.result:new Uint8Array(a.result),r=XLSX.read(t,{type:n?"binary":"array"});e(null,r.SheetNames.map(function(t){return{name:t,sheet:r.Sheets[t],csv:XLSX.utils.sheet_to_csv(r.Sheets[t])}}))}catch(t){console.error(t),e(null,a.result)}},a.readAsBinaryString(t)}(e,function(t,e){if(t)return mt.set({error:t});mt.set({sheets:e})})):mt.set({error:A("upload / csv-required")})},action:function(){}}];var Ot={addButton:function(t){Lt.push(t),this.set({buttons:Lt});var e=this.get().defaultMethod;t.id==e&&this.btnAction(t)},btnAction:function(t){if(this.set({active:t}),"copy"==t.id){var e=this.store.get().dw_chart;e.get("externalData")&&(e.set("externalData",""),setTimeout(function(){dw.backend.currentChart.save()},1e3))}var n=t.id;"upload"==t.id&&(n="copy",setTimeout(function(){},1e3)),this.store.get().dw_chart.set("metadata.data.upload-method",n),t.action&&t.action(),t.mainPanel&&this.set({MainPanel:t.mainPanel}),t.sidebar&&this.set({Sidebar:t.sidebar})},btnUpload:function(t,e){t.onFileUpload&&t.onFileUpload(e)},dragStart:function(t){"copy"==this.get().active.id&&(t.preventDefault(),this.set({dragover:!0}))},resetDrag:function(){this.set({dragover:!1})},onFileDrop:function(t){if("copy"==this.get().active.id){this.resetDrag(),t.preventDefault();var e=[];if(t.dataTransfer.items){for(var n=0;n<t.dataTransfer.items.length;n++)"file"===t.dataTransfer.items[n].kind&&e.push(t.dataTransfer.items[n].getAsFile());t.dataTransfer.items.clear()}else{for(var a=0;a<t.dataTransfer.files.length;a++)e.push(t.dataTransfer.files[a]);t.dataTransfer.items.clear()}for(var r=0;r<e.length;r++)if("text/"==e[r].type.substr(0,5))return Ct(e[r],function(t,e){pt("/api/charts/"+dw.backend.currentChart.get("id")+"/data",e,function(){window.location.href="describe"})})}}};function Rt(t,n){var a,i=A("upload / drag-csv-here");return{c:function(){a=c("div"),this.h()},h:function(){a.className="draginfo svelte-oe6wy4"},m:function(t,e){r(a,t,e),a.innerHTML=i},u:function(){a.innerHTML="",s(a)},d:e}}function $t(t,e){var n,i,o,h,f,p,v,_,m,g=e.btn,y=(e.each_value,e.btn_index,g.title),b=g.isFileUpload&&Et(t,e);return{c:function(){n=c("li"),i=c("label"),b&&b.c(),o=u("\n                            "),h=c("i"),p=u("\n                            "),v=c("span"),_=u(y),this.h()},h:function(){h.className=f=g.icon+" svelte-oe6wy4",v.className="svelte-oe6wy4",i.className="svelte-oe6wy4",d(n,"click",Ut),n.className=m="action "+(e.active==g?"active":"")+" svelte-oe6wy4",n._svelte={component:t,each_value:e.each_value,btn_index:e.btn_index}},m:function(t,e){r(n,t,e),a(i,n),b&&b.m(i,null),a(o,i),a(h,i),a(p,i),a(v,i),a(_,v)},p:function(e,a){g=a.btn,a.each_value,a.btn_index,g.isFileUpload?b?b.p(e,a):((b=Et(t,a)).c(),b.m(i,o)):b&&(b.u(),b.d(),b=null),e.buttons&&f!==(f=g.icon+" svelte-oe6wy4")&&(h.className=f),e.buttons&&y!==(y=g.title)&&(_.data=y),(e.active||e.buttons)&&m!==(m="action "+(a.active==g?"active":"")+" svelte-oe6wy4")&&(n.className=m),n._svelte.each_value=a.each_value,n._svelte.btn_index=a.btn_index},u:function(){s(n),b&&b.u()},d:function(){b&&b.d(),l(n,"click",Ut)}}}function Et(t,e){var n;e.btn,e.each_value,e.btn_index;return{c:function(){n=c("input"),this.h()},h:function(){d(n,"change",Ht),n.accept=".csv, .tsv, .txt, .xlsx, .xls, .ods, .dbf",n.className="file-upload svelte-oe6wy4",h(n,"type","file"),n._svelte={component:t,each_value:e.each_value,btn_index:e.btn_index}},m:function(t,e){r(n,t,e)},p:function(t,e){e.btn,e.each_value,e.btn_index,n._svelte.each_value=e.each_value,n._svelte.btn_index=e.btn_index},u:function(){s(n)},d:function(){l(n,"change",Ht)}}}function Ft(t,e){var n,o,h,f;function p(e){t.set({error:!1})}return{c:function(){n=c("div"),(o=c("div")).textContent="✕",h=u("\n                    "),f=c("noscript"),this.h()},h:function(){d(o,"click",p),o.className="action close",n.className="alert alert-error"},m:function(t,s){r(n,t,s),a(o,n),a(h,n),a(f,n),f.insertAdjacentHTML("afterend",e.error)},p:function(t,e){t.error&&(i(f),f.insertAdjacentHTML("afterend",e.error))},u:function(){i(f),s(n)},d:function(){l(o,"click",p)}}}function Ht(t){var e=this._svelte.component,n=this._svelte.each_value[this._svelte.btn_index];e.btnUpload(n,t)}function Ut(t){var e=this._svelte.component,n=this._svelte.each_value[this._svelte.btn_index];e.btnAction(n)}function It(t){w(this,t),this._state=n({dragover:!1,MainPanel:xt,Sidebar:Nt,active:Lt[0],buttons:Lt,sheets:[],chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0},t.data);var e=this;t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){for(var i,h,f,p,v,_,m,g,y,b,x,w,S,D,N,T,k,j,M,P,C,L,O=A("upload / title"),R=e.active.longTitle||e.active.title,$={},E={},F=A("Proceed"),H=e.dragover&&Rt(),U=e.buttons,I=[],B=0;B<U.length;B+=1)I[B]=$t(t,n(n({},e),{each_value:U,btn:U[B],btn_index:B}));var q=e.error&&Ft(t,e),z=e.Sidebar;function X(e){var n={};return"chartData"in e&&(n.chartData=e.chartData,$.chartData=!0),"readonly"in e&&(n.readonly=e.readonly,$.readonly=!0),"sheets"in e&&(n.sheets=e.sheets,$.sheets=!0),"datasets"in e&&(n.datasets=e.datasets,$.datasets=!0),{root:t.root,data:n,_bind:function(e,n){t.get();var a={};!$.chartData&&e.chartData&&(a.chartData=n.chartData),!$.readonly&&e.readonly&&(a.readonly=n.readonly),!$.sheets&&e.sheets&&(a.sheets=n.sheets),!$.datasets&&e.datasets&&(a.datasets=n.datasets),t._set(a),$={}}}}if(z){var V=new z(X(e));t.root._beforecreate.push(function(){V._bind({chartData:1,readonly:1,sheets:1,datasets:1},V.get())})}var Z=e.MainPanel;function G(e){var n={};return"chartData"in e&&(n.chartData=e.chartData,E.chartData=!0),"readonly"in e&&(n.readonly=e.readonly,E.readonly=!0),{root:t.root,data:n,_bind:function(e,n){t.get();var a={};!E.chartData&&e.chartData&&(a.chartData=n.chartData),!E.readonly&&e.readonly&&(a.readonly=n.readonly),t._set(a),E={}}}}if(Z){var J=new Z(G(e));t.root._beforecreate.push(function(){J._bind({chartData:1,readonly:1},J.get())})}function K(e){t.onFileDrop(e)}function Q(e){t.dragStart(e)}function W(e){t.dragStart(e)}function Y(e){t.resetDrag()}function tt(e){t.resetDrag()}return{c:function(){i=c("div"),H&&H.c(),h=u("\n    "),f=c("div"),p=c("div"),v=c("div"),_=c("h3"),m=u("\n\n                "),g=c("ul");for(var t=0;t<I.length;t+=1)I[t].c();y=u("\n\n                "),q&&q.c(),b=u("\n\n                "),x=c("h4"),w=u(R),S=u("\n\n                "),V&&V._fragment.c(),D=u("\n        "),N=c("div"),J&&J._fragment.c(),T=u("\n\n            "),k=c("div"),j=c("a"),M=u(F),P=u(" "),C=c("i"),this.h()},h:function(){g.className="import-methods svelte-oe6wy4",v.className="sidebar",p.className="span5",C.className="icon-chevron-right icon-white",j.href="describe",j.className="submit btn btn-primary",j.id="describe-proceed",k.className="buttons pull-right",N.className="span7",f.className="row",f.style.cssText=L=e.dragover?"opacity: 0.5;filter:blur(6px);background:white;pointer-events:none":"",d(i,"drop",K),d(i,"dragover",Q),d(i,"dragenter",W),d(i,"dragend",Y),d(i,"dragleave",tt),i.className="chart-editor dw-create-upload upload-data"},m:function(t,e){r(i,t,e),H&&H.m(i,null),a(h,i),a(f,i),a(p,f),a(v,p),a(_,v),_.innerHTML=O,a(m,v),a(g,v);for(var n=0;n<I.length;n+=1)I[n].m(g,null);a(y,v),q&&q.m(v,null),a(b,v),a(x,v),a(w,x),a(S,v),V&&V._mount(v,null),a(D,f),a(N,f),J&&J._mount(N,null),a(T,N),a(k,N),a(j,k),a(M,j),a(P,j),a(C,j)},p:function(e,a){a.dragover?H||((H=Rt()).c(),H.m(i,h)):H&&(H.u(),H.d(),H=null);var r=a.buttons;if(e.buttons||e.active){for(var s=0;s<r.length;s+=1){var o=n(n({},a),{each_value:r,btn:r[s],btn_index:s});I[s]?I[s].p(e,o):(I[s]=$t(t,o),I[s].c(),I[s].m(g,null))}for(;s<I.length;s+=1)I[s].u(),I[s].d();I.length=r.length}if(a.error?q?q.p(e,a):((q=Ft(t,a)).c(),q.m(v,b)):q&&(q.u(),q.d(),q=null),e.active&&R!==(R=a.active.longTitle||a.active.title)&&(w.data=R),z!==(z=a.Sidebar))V&&V.destroy(),z&&((V=new z(X(a)))._fragment.c(),V._mount(v,null));else{var c={};!$.chartData&&e.chartData&&(c.chartData=a.chartData,$.chartData=!0),!$.readonly&&e.readonly&&(c.readonly=a.readonly,$.readonly=!0),!$.sheets&&e.sheets&&(c.sheets=a.sheets,$.sheets=!0),!$.datasets&&e.datasets&&(c.datasets=a.datasets,$.datasets=!0),V._set(c),$={}}if(Z!==(Z=a.MainPanel))J&&J.destroy(),Z&&((J=new Z(G(a)))._fragment.c(),J._mount(N,T));else{var u={};!E.chartData&&e.chartData&&(u.chartData=a.chartData,E.chartData=!0),!E.readonly&&e.readonly&&(u.readonly=a.readonly,E.readonly=!0),J._set(u),E={}}e.dragover&&L!==(L=a.dragover?"opacity: 0.5;filter:blur(6px);background:white;pointer-events:none":"")&&(f.style.cssText=L)},u:function(){_.innerHTML="",s(i),H&&H.u();for(var t=0;t<I.length;t+=1)I[t].u();q&&q.u()},d:function(){H&&H.d(),o(I),q&&q.d(),V&&V.destroy(!1),J&&J.destroy(!1),l(i,"drop",K),l(i,"dragover",Q),l(i,"dragenter",W),l(i,"dragend",Y),l(i,"dragleave",tt)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this;mt=this;var e=this.store.get().dw_chart.get("metadata.data.upload-method","copy");this.set({defaultMethod:e}),Lt.forEach(function(n){n.id==e&&t.set({active:n})})}).call(e),e.fire("update",{changed:{dragover:1,buttons:1,active:1,error:1,Sidebar:1,chartData:1,readonly:1,sheets:1,datasets:1,MainPanel:1},current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,N(this._beforecreate),N(this._oncreate),N(this._aftercreate),this._lock=!1)}function Bt(t,e){var n={},a={};"$dataReadonly"in e&&(a.readonly=e.$dataReadonly,n.readonly=!0),"datasets"in e&&(a.datasets=e.datasets,n.datasets=!0),"$chart"in e&&(a.chart=e.$chart,n.chart=!0);var r=new It({root:t.root,data:a,_bind:function(e,a){t.get();var r={},s={};!n.readonly&&e.readonly&&(s.dataReadonly=a.readonly),!n.datasets&&e.datasets&&(r.datasets=a.datasets),!n.chart&&e.chart&&(s.chart=a.chart),t.store.set(s),t._set(r),n={}}});return t.root._beforecreate.push(function(){r._bind({readonly:1,datasets:1,chart:1},r.get())}),{c:function(){r._fragment.c()},m:function(t,e){r._mount(t,e)},p:function(t,e){var a={};!n.readonly&&t.$dataReadonly&&(a.readonly=e.$dataReadonly,n.readonly=!0),!n.datasets&&t.datasets&&(a.datasets=e.datasets,n.datasets=!0),!n.chart&&t.$chart&&(a.chart=e.$chart,n.chart=!0),r._set(a),n={}},u:function(){r._unmount()},d:function(){r.destroy(!1)}}}function qt(t,n){var a;return{c:function(){a=u("DESCRIBE")},m:function(t,e){r(a,t,e)},p:e,u:function(){s(a)},d:e}}function zt(t,n){var a;return{c:function(){a=u("VISUALIZE")},m:function(t,e){r(a,t,e)},p:e,u:function(){s(a)},d:e}}function Xt(t,n){var a;return{c:function(){a=u("PUBLISH")},m:function(t,e){r(a,t,e)},p:e,u:function(){s(a)},d:e}}function Vt(t,n){var a;return{c:function(){a=u(":(")},m:function(t,e){r(a,t,e)},p:e,u:function(){s(a)},d:e}}function Zt(t){w(this,t),this._state=n(n(this.store._init(["chart","dataReadonly"]),{datasets:[],steps:[{id:"upload",title:A("Upload Data")},{id:"describe",title:A("Check & Describe")},{id:"visualize",title:A("Visualize")},{id:"publish",title:A("Publish & Embed")}]}),t.data),this.store._add(this,["chart","dataReadonly"]),this._handlers.destroy=[T];var e=this;t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){var n,a,i={},o={};"step"in e&&(o.active=e.step,i.active=!0),"maxStep"in e&&(o.maxStep=e.maxStep,i.maxStep=!0),"steps"in e&&(o.steps=e.steps,i.steps=!0),"$chart"in e&&(o.chart=e.$chart,i.chart=!0);var d=new ft({root:t.root,data:o,_bind:function(e,n){t.get();var a={},r={};!i.active&&e.active&&(a.step=n.active),!i.maxStep&&e.maxStep&&(a.maxStep=n.maxStep),!i.steps&&e.steps&&(a.steps=n.steps),!i.chart&&e.chart&&(r.chart=n.chart),t.store.set(r),t._set(a),i={}}});function l(t){return"upload"==t.step?Bt:"describe"==t.step?qt:"visualize"==t.step?zt:"publish"==t.step?Xt:Vt}t.root._beforecreate.push(function(){d._bind({active:1,maxStep:1,steps:1,chart:1},d.get())});var h=l(e),f=h(t,e);return{c:function(){d._fragment.c(),n=u("\n\n"),a=c("div"),f.c()},m:function(t,e){d._mount(t,e),r(n,t,e),r(a,t,e),f.m(a,null)},p:function(e,n){var r={};!i.active&&e.step&&(r.active=n.step,i.active=!0),!i.maxStep&&e.maxStep&&(r.maxStep=n.maxStep,i.maxStep=!0),!i.steps&&e.steps&&(r.steps=n.steps,i.steps=!0),!i.chart&&e.$chart&&(r.chart=n.$chart,i.chart=!0),d._set(r),i={},h===(h=l(n))&&f?f.p(e,n):(f.u(),f.d(),(f=h(t,n)).c(),f.m(a,null))},u:function(){d._unmount(),s(n),s(a),f.u()},d:function(){d.destroy(!1),f.d()}}}(this,this._state),this.root._oncreate.push(function(){(function(){}).call(e),e.fire("update",{changed:{step:1,maxStep:1,steps:1,$chart:1,$dataReadonly:1,datasets:1},current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,N(this._beforecreate),N(this._oncreate),N(this._aftercreate),this._lock=!1)}function Gt(t,e){this._observers={pre:_(),post:_()},this._handlers={},this._dependents=[],this._computed=_(),this._sortedComputedProperties=[],this._state=n({},t),this._differs=e&&e.immutable?y:g}n(It.prototype,k),n(It.prototype,Ot),n(Zt.prototype,k),n(Gt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var a=t[n];e["$"+a]=this._state[a]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],a=_();function r(s){if(t[s])throw new Error("Cyclical dependency detected");if(!a[s]){a[s]=!0;var i=e[s];i&&(t[s]=!0,i.deps.forEach(r),n.push(i))}}for(var s in this._computed)t=_(),r(s)},compute:function(t,e,n){var a,r=this,s={deps:e,update:function(s,i,o){var c=e.map(function(t){return t in i&&(o=!0),s[t]});if(o){var u=n.apply(null,c);r._differs(u,a)&&(a=u,i[t]=!0,s[t]=a)}}};s.update(this._state,{},!0),this._computed[t]=s,this._sortComputedProperties()},fire:b,get:x,observe:S,on:D,onchange:function(t){return console.warn("store.onchange is deprecated in favour of store.on('state', event => {...})"),this.on("state",function(e){t(e.current,e.changed)})},set:function(t){var e=this._state,a=this._changed={},r=!1;for(var s in t){if(this._computed[s])throw new Error("'"+s+"' is a read-only property");this._differs(t[s],e[s])&&(a[s]=r=!0)}if(r){this._state=n(n({},e),t);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,a);this.fire("state",{changed:a,current:this._state,previous:e});var o=this._dependents.slice();for(i=0;i<o.length;i+=1){var c=o[i],u={};r=!1;for(var d=0;d<c.props.length;d+=1){var l=c.props[d];l in a&&(u["$"+l]=this._state[l],r=!0)}r&&c.component.set(u)}this.fire("update",{changed:a,current:this._state,previous:e})}}});return{App:Zt,store:new Gt({}),data:{}}});
