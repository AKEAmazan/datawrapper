!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/folder",e):(t=t||self).folder=e()}(this,(function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){for(var n in e)t[n]=1;return t}function i(t){t()}function o(t,e){t.appendChild(e)}function r(t,e,n){t.insertBefore(e,n)}function s(t){t.parentNode.removeChild(t)}function a(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function l(t,e,n,i){t.addEventListener(e,n,i)}function f(t,e,n,i){t.removeEventListener(e,n,i)}function d(t,e){t.data=""+e}function h(t,e,n){t.style.setProperty(e,n)}function p(t){return t}function m(e,n,o,r,s){var a,c,u,l=o.call(e,n,r),f=!1;return{t:s?0:1,running:!1,program:null,pending:null,run:function(t,e){var n=this;"function"==typeof l?_.wait().then((function(){l=l(),n._run(t,e)})):this._run(t,e)},_run:function(e,i){a=l.duration||300,c=l.easing||p;var o={start:window.performance.now()+(l.delay||0),b:e,callback:i||t};s&&!f&&(l.css&&l.delay&&(u=n.style.cssText,n.style.cssText+=l.css(0,1)),l.tick&&l.tick(0,1),f=!0),e||(o.group=v.current,v.current.remaining+=1),l.delay?this.pending=o:this.start(o),this.running||(this.running=!0,_.add(this))},start:function(t){if(e.fire((t.b?"intro":"outro")+".start",{node:n}),t.a=this.t,t.delta=t.b-t.a,t.duration=a*Math.abs(t.b-t.a),t.end=t.start+t.duration,l.css){l.delay&&(n.style.cssText=u);var i=function(t,e,n){for(var i=t.a,o=t.b,r=t.delta,s=16.666/t.duration,a="{\n",c=0;c<=1;c+=s){var u=i+r*e(c);a+=100*c+"%{"+n(u,1-u)+"}\n"}return a+"100% {"+n(o,1-o)+"}\n}"}(t,c,l.css);_.addRule(i,t.name="__svelte_"+function(t){for(var e=5381,n=t.length;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(i)),n.style.animation=(n.style.animation||"").split(", ").filter((function(e){return e&&(t.delta<0||!/__svelte/.test(e))})).concat(t.name+" "+t.duration+"ms linear 1 forwards").join(", ")}this.program=t,this.pending=null},update:function(t){var e=this.program;if(e){var n=t-e.start;this.t=e.a+e.delta*c(n/e.duration),l.tick&&l.tick(this.t,1-this.t)}},done:function(){var t=this.program;this.t=t.b,l.tick&&l.tick(this.t,1-this.t),e.fire((t.b?"intro":"outro")+".end",{node:n}),t.b||t.invalidated?l.css&&_.deleteRule(n,t.name):(t.group.callbacks.push((function(){t.callback(),l.css&&_.deleteRule(n,t.name)})),0==--t.group.remaining&&t.group.callbacks.forEach(i)),this.running=!!this.pending},abort:function(t){this.program&&(t&&l.tick&&l.tick(1,0),l.css&&_.deleteRule(n,this.program.name),this.program=this.pending=null,this.running=!1)},invalidate:function(){this.program&&(this.program.invalidated=!0)}}}var v={};function g(){v.current={remaining:0,callbacks:[]}}var _={running:!1,transitions:[],bound:null,stylesheet:null,activeRules:{},promise:null,add:function(t){this.transitions.push(t),this.running||(this.running=!0,requestAnimationFrame(this.bound||(this.bound=this.next.bind(this))))},addRule:function(t,e){if(!this.stylesheet){var n=c("style");document.head.appendChild(n),_.stylesheet=n.sheet}this.activeRules[e]||(this.activeRules[e]=!0,this.stylesheet.insertRule("@keyframes "+e+" "+t,this.stylesheet.cssRules.length))},next:function(){this.running=!1;for(var t=window.performance.now(),e=this.transitions.length;e--;){var n=this.transitions[e];n.program&&t>=n.program.end&&n.done(),n.pending&&t>=n.pending.start&&n.start(n.pending),n.running?(n.update(t),this.running=!0):n.pending||this.transitions.splice(e,1)}if(this.running)requestAnimationFrame(this.bound);else if(this.stylesheet){for(var i=this.stylesheet.cssRules.length;i--;)this.stylesheet.deleteRule(i);this.activeRules={}}},deleteRule:function(t,e){t.style.animation=t.style.animation.split(", ").filter((function(t){return t&&-1===t.indexOf(e)})).join(", ")},wait:function(){return _.promise||(_.promise=Promise.resolve(),_.promise.then((function(){_.promise=null}))),_.promise}};function y(){return Object.create(null)}function b(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function k(t,e){return t!=t?e==e:t!==e}function w(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var i=0;i<n.length;i+=1){var o=n[i];if(!o.__calling)try{o.__calling=!0,o.call(this,e)}finally{o.__calling=!1}}}function N(t){t._lock=!0,R(t._beforecreate),R(t._oncreate),R(t._aftercreate),t._lock=!1}function x(){return this._state}function L(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function R(t){for(;t&&t.length;)t.shift()()}var I={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:x,fire:w,on:L,set:function(t){this._set(e({},t)),this.root._lock||N(this.root)},_recompute:t,_set:function(t){var n=this._state,i={},o=!1;for(var r in t=e(this._staged,t),this._staged={},t)this._differs(t[r],n[r])&&(i[r]=o=!0);o&&(this._state=e(e({},n),t),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(this.fire("state",{changed:i,current:this._state,previous:n}),this._fragment.p(i,this._state),this.fire("update",{changed:i,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:b};function T(t,e,n,i,o){var r={method:e,body:i,mode:"cors",credentials:n};return window.fetch(t,r).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.text()})).then((function(t){try{return JSON.parse(t)}catch(e){return console.warn("malformed json input",t),t}})).then((function(t){return o&&o(t),t})).catch((function(t){console.error(t)}))}function C(t,e,n){return 2===arguments.length&&(n=e,e="include"),T(t,"GET",e,null,n)}var F={};function O(t,e){var n=arguments;if(void 0===e&&(e="core"),t=t.trim(),F[e]||function(t){void 0===t&&(t="core"),"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(F[t]=window.__dw.vis.meta.locale||{}):F[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}(e),!F[e][t])return"MISSING:"+t;var i=F[e][t];return"string"==typeof i&&arguments.length>2&&(i=i.replace(/\$(\d)/g,(function(t,e){return e=2+Number(e),void 0===n[e]?t:n[e]}))),i}function E(t){var e=t-1;return e*e*e+1}function P(t,e){var n=e.delay;void 0===n&&(n=0);var i=e.duration;void 0===i&&(i=400);var o=+getComputedStyle(t).opacity;return{delay:n,duration:i,css:function(t){return"opacity: "+t*o}}}function j(t,e){var n=e.delay;void 0===n&&(n=0);var i=e.duration;void 0===i&&(i=400);var o=e.easing;void 0===o&&(o=E);var r=getComputedStyle(t),s=+r.opacity,a=parseFloat(r.height),c=parseFloat(r.paddingTop),u=parseFloat(r.paddingBottom),l=parseFloat(r.marginTop),f=parseFloat(r.marginBottom),d=parseFloat(r.borderTopWidth),h=parseFloat(r.borderBottomWidth);return{delay:n,duration:i,easing:o,css:function(t){return"overflow: hidden;opacity: "+Math.min(20*t,1)*s+";height: "+t*a+"px;padding-top: "+t*c+"px;padding-bottom: "+t*u+"px;margin-top: "+t*l+"px;margin-bottom: "+t*f+"px;border-top-width: "+t*d+"px;border-bottom-width: "+t*h+"px;"}}}var S=function(t,e,n,i,o){if(t){if("parent"===n){if("root"===e.type)return null;if(["user","team"].indexOf(e.type)>-1)return{type:"root",id:null}}for(var r=0;r<t.length;r++){if((!t[r].type||t[r].type===e.type)&&t[r].id===e.id)return"parent"===n?i:"team"===n?o:t[r];"team"===t[r].type&&(o=t[r]);var s=S(t[r].folders,e,n,t[r],o);if(s)return s}}};function A(t){return{user:"fa fa-user",team:"fa fa-users"}[t]||"im im-folder"}function z(t){return"tables"===t?"fa fa-table":t.indexOf("map")>-1?"fa fa-map-marker":"fa fa-bar-chart-o"}function M(t){return"root"===t.type?O("folders / all"):"user"===t.type?O("folders / my"):t.name}var H={key:function(t){13===t&&this.add()},hide:function(){this.store?(this.set({show:!1}),$(".action-move").removeClass("active")):window.location.hash="#"},add:function(){var t=this;this.set({creating:!0});var e,n,i=this.get(),o=i.position,r={name:i.folderName};"team"===o.type?r.organizationId=o.id:o.type||(r.parentId=o.id),e=window.location.protocol+"//"+dw.backend.__api_domain+"/v3/folders",n=JSON.stringify(r),T(e,"POST","include",n,(function(e){t.updateFolders((function(n){t.set({folderName:"",position:e,create:!1,creating:!1})}))}))},up:function(){var t=this.get(),e=t.position,n=t.folders;if(t.create)this.set({create:!1});else{var i=S(n,e,"parent");this.set({position:i})}},move:function(){var t=this;this.set({moving:!0});var e,n,i=this.get(),o=i.position,r=i.chartId,s={};s="user"===o.type?{organizationId:null,folderId:null}:"team"===o.type?{organizationId:o.id,folderId:null}:{folderId:o.id},e=window.location.protocol+"//"+dw.backend.__api_domain+"/v3/charts/"+r,n=JSON.stringify(s),T(e,"PATCH","include",n,(function(e){t.set({current:o}),t.updateFolders((function(e){t.set({moving:!1,position:S(e,o)})}))}))},updateFolders:function(t){var e=this;C(window.location.protocol+"//"+dw.backend.__api_domain+"/v3/folders","include",(function(n){e.set({folders:n}),"function"==typeof t&&t(n)}))}};function B(){var t=$(".action-move").position();this.set({x:t.left,y:t.top+$(".action-move").outerHeight()+20})}function J(t){var e=this,n=t.changed,i=t.current;t.previous;n.chartId&&i.chartId&&(this.set({loading:!0}),C(window.location.protocol+"//"+dw.backend.__api_domain+"/v3/charts/"+i.chartId,(function(t){e.updateFolders((function(n){var i={type:t.inFolder?"folder":t.organizationId?"team":"user",id:t.inFolder?t.inFolder:t.organizationId?t.organizationId:t.authorId},o=S(n,i)||{type:"root"};e.set({current:i,loading:!1,position:o})}))})))}function q(t,e,n){var i=Object.create(t);return i.element=e[n],i}function G(t){var e=this._svelte,n=e.component,i=e.ctx;n.set({position:i.element})}function W(t,e,n){var i=Object.create(t);return i.element=e[n],i}function D(t,e){var n,i=e.show&&K(t,e);return{c:function(){i&&i.c(),n=document.createComment("")},m:function(t,e){i&&i.m(t,e),r(t,n,e)},p:function(e,o){o.show?i?i.p(e,o):((i=K(t,o)).c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d:function(t){i&&i.d(t),t&&s(n)}}}function K(t,e){var n,i,o,a=[V,U,Q],u=[];function l(t){return t.loading?0:t.create?1:2}return i=l(e),o=u[i]=a[i](t,e),{c:function(){n=c("div"),o.c(),n.className="cont svelte-ftgu5o",h(n,"left",e.x+"px"),h(n,"top",e.y+"px")},m:function(t,e){r(t,n,e),u[i].i(n,null)},p:function(e,r){var s=i;(i=l(r))===s?u[i].p(e,r):(g(),o.o((function(){u[s].d(1),u[s]=null})),(o=u[i])||(o=u[i]=a[i](t,r)).c(),o.i(n,null)),e.x&&h(n,"left",r.x+"px"),e.y&&h(n,"top",r.y+"px")},d:function(t){t&&s(n),u[i].d()}}}function Q(t,e){var n,d,h,p,m,v,_,y,b,k,w,N,x,L,R,I,T,C,F,E,P,j,S,A=O("folders / move");function z(e){t.up()}function M(t){return t.isRoot?X:Y}var $=M(e),H=$(t,e);function B(e){t.hide()}for(var J=e.folderList,G=[],D=0;D<J.length;D+=1)G[D]=Z(t,W(e,J,D));function K(t,e,n){G[t]&&G[t].o((function(){e&&(G[t].d(e),G[t]=null),n&&n()}))}var Q=e.chartList,U=[];for(D=0;D<Q.length;D+=1)U[D]=tt(t,q(e,Q,D));function V(t,e,n){U[t]&&U[t].o((function(){e&&(U[t].d(e),U[t]=null),n&&n()}))}var nt=0===e.chartList.length&&0===e.folderList.length&&et();function it(e){t.set({create:!0})}function ot(e){t.move()}return{c:function(){n=c("div"),d=c("div"),h=c("i"),m=u("\n\n        "),v=c("div"),H.c(),_=u("\n\n        "),(y=c("div")).innerHTML='<i class="im im-x-mark svelte-ftgu5o"></i>',b=u("\n    "),k=c("div");for(var t=0;t<G.length;t+=1)G[t].c();w=u(" ");for(t=0;t<U.length;t+=1)U[t].c();N=u(" "),nt&&nt.c(),x=u("\n    "),L=c("div"),R=c("button"),I=c("i"),T=u("\n\n        "),C=c("button"),F=c("i"),P=u("\n            "),j=u(A),h.className="im im-angle-left svelte-ftgu5o",l(d,"click",z),d.className="up svelte-ftgu5o",d.style.cssText=p=e.isRoot?"visibility: hidden":"",v.className="title svelte-ftgu5o",l(y,"click",B),y.className="close",n.className="header svelte-ftgu5o",k.className="body svelte-ftgu5o",I.className="im im-folder-add",l(R,"click",it),R.className="btn",R.disabled=e.isRoot,F.className=E=e.moving?"fa fa-circle-o-notch fa-spin":"im im-check-mark-circle-o",l(C,"click",ot),C.className="btn btn-primary",C.disabled=e.isRoot,L.className="footer svelte-ftgu5o"},m:function(t,e){r(t,n,e),o(n,d),o(d,h),o(n,m),o(n,v),H.m(v,null),o(n,_),o(n,y),r(t,b,e),r(t,k,e);for(var i=0;i<G.length;i+=1)G[i].i(k,null);o(k,w);for(i=0;i<U.length;i+=1)U[i].i(k,null);o(k,N),nt&&nt.m(k,null),r(t,x,e),r(t,L,e),o(L,R),o(R,I),o(L,T),o(L,C),o(C,F),o(C,P),o(C,j),S=!0},p:function(e,n){if(S&&!e.isRoot||p===(p=n.isRoot?"visibility: hidden":"")||(d.style.cssText=p),$===($=M(n))&&H?H.p(e,n):(H.d(1),(H=$(t,n)).c(),H.m(v,null)),e.folderList){J=n.folderList;for(var i=0;i<J.length;i+=1){var o=W(n,J,i);G[i]?G[i].p(e,o):(G[i]=Z(t,o),G[i].c()),G[i].i(k,w)}for(g();i<G.length;i+=1)K(i,1)}if(e.chartList){Q=n.chartList;for(i=0;i<Q.length;i+=1){var r=q(n,Q,i);U[i]?U[i].p(e,r):(U[i]=tt(t,r),U[i].c()),U[i].i(k,N)}for(g();i<U.length;i+=1)V(i,1)}0===n.chartList.length&&0===n.folderList.length?nt||((nt=et()).c(),nt.m(k,null)):nt&&(nt.d(1),nt=null),S&&!e.isRoot||(R.disabled=n.isRoot),S&&!e.moving||E===(E=n.moving?"fa fa-circle-o-notch fa-spin":"im im-check-mark-circle-o")||(F.className=E),S&&!e.isRoot||(C.disabled=n.isRoot)},i:function(t,e){S||this.m(t,e)},o:i,d:function(t){t&&s(n),f(d,"click",z),H.d(),f(y,"click",B),t&&(s(b),s(k)),a(G,t),a(U,t),nt&&nt.d(),t&&(s(x),s(L)),f(R,"click",it),f(C,"click",ot)}}}function U(t,e){var n,a,d,h,p,v,g,_,y,b,k,w,N,x,L,R,I,T=!1,C=O("folders / create").replace("%folder%",M(e.position));function F(e){t.up()}function E(){T=!0,t.set({folderName:v.value}),T=!1}function j(e){t.key(e.keyCode)}function S(e){t.add()}return{c:function(){var t,i,o;n=c("div"),a=c("div"),d=c("i"),p=u("\n\n        "),v=c("input"),g=u("\n\n        "),_=c("button"),y=c("i"),w=u("\n    "),N=c("div"),x=c("div"),L=u("\n    "),R=c("div"),d.className="im im-angle-left svelte-ftgu5o",l(a,"click",F),a.className="up svelte-ftgu5o",a.style.cssText=h=e.isRoot?"visibility: hidden":"",l(v,"input",E),l(v,"keydown",j),v.autofocus=!0,v.placeholder=O("folders / untitled"),t=v,i="type",null==(o="text")?t.removeAttribute(i):t.setAttribute(i,o),v.className="svelte-ftgu5o",y.className=b=(e.creating?"fa fa-circle-o-notch fa-spin":"im im-plus-circle")+" svelte-ftgu5o",l(_,"click",S),_.disabled=k=0===e.folderName.length,_.className="btn btn-primary svelte-ftgu5o",n.className="header svelte-ftgu5o",x.className="empty svelte-ftgu5o",N.className="body svelte-ftgu5o",R.className="footer svelte-ftgu5o"},m:function(t,i){r(t,n,i),o(n,a),o(a,d),o(n,p),o(n,v),v.value=e.folderName,o(n,g),o(n,_),o(_,y),r(t,w,i),r(t,N,i),o(N,x),x.innerHTML=C,r(t,L,i),r(t,R,i),I=!0,v.focus()},p:function(t,e){t.isRoot&&h!==(h=e.isRoot?"visibility: hidden":"")&&(a.style.cssText=h),!T&&t.folderName&&(v.value=e.folderName),t.creating&&b!==(b=(e.creating?"fa fa-circle-o-notch fa-spin":"im im-plus-circle")+" svelte-ftgu5o")&&(y.className=b),t.folderName&&k!==(k=0===e.folderName.length)&&(_.disabled=k),t.position&&C!==(C=O("folders / create").replace("%folder%",M(e.position)))&&(x.innerHTML=C)},i:function(e,n){I||(t.root._intro&&t.root._aftercreate.push((function(){m(t,N,P,{duration:200},!0).run(1)})),this.m(e,n))},o:i,d:function(t){t&&s(n),f(a,"click",F),f(v,"input",E),f(v,"keydown",j),f(_,"click",S),t&&(s(w),s(N),s(L),s(R))}}}function V(e,n){var a,l,f,d,p,m=O("folders / loading");return{c:function(){a=c("div"),l=c("i"),f=u("  \n        "),d=u(m),h(l,"margin","0px 6px 0px 10px"),l.className="fa fa-circle-o-notch fa-spin svelte-ftgu5o",a.className="header svelte-ftgu5o",h(a,"border-bottom","none")},m:function(t,e){r(t,a,e),o(a,l),o(a,f),o(a,d),p=!0},p:t,i:function(t,e){p||this.m(t,e)},o:i,d:function(t){t&&s(a)}}}function X(t,e){var n,i=M(e.position);return{c:function(){n=u(i)},m:function(t,e){r(t,n,e)},p:function(t,e){t.position&&i!==(i=M(e.position))&&d(n,i)},d:function(t){t&&s(n)}}}function Y(t,e){var n,i,a,l,f=M(e.position);return{c:function(){n=c("a"),i=u(f),a=u(" "),(l=c("i")).className="im im-external-link svelte-ftgu5o",n.href=e.openLink,n.target="_blank",n.className="svelte-ftgu5o"},m:function(t,e){r(t,n,e),o(n,i),o(n,a),o(n,l)},p:function(t,e){t.position&&f!==(f=M(e.position))&&d(i,f),t.openLink&&(n.href=e.openLink)},d:function(t){t&&s(n)}}}function Z(t,e){var n,i,a,h,p,v,g,_,y,b,k=M(e.element);return{c:function(){n=c("div"),i=c("i"),h=u("  \n            "),p=c("div"),v=u(k),g=u("\n            "),_=c("i"),i.className=a=A(e.element.type)+" svelte-ftgu5o",p.className="svelte-ftgu5o",_.className="im im-angle-right svelte-ftgu5o",n._svelte={component:t,ctx:e},l(n,"click",G),n.className="li folder svelte-ftgu5o"},m:function(t,e){r(t,n,e),o(n,i),o(n,h),o(n,p),o(p,v),o(n,g),o(n,_),b=!0},p:function(t,o){e=o,b&&!t.folderList||a===(a=A(e.element.type)+" svelte-ftgu5o")||(i.className=a),b&&!t.folderList||k===(k=M(e.element))||d(v,k),n._svelte.ctx=e},i:function(e,i){b||(t.root._intro&&(y&&y.invalidate(),t.root._aftercreate.push((function(){y||(y=m(t,n,j,{duration:200},!0)),y.run(1)}))),this.m(e,i))},o:function(e){b&&(y||(y=m(t,n,j,{duration:200},!1)),y.run(0,(function(){e(),y=null})),b=!1)},d:function(t){t&&s(n),f(n,"click",G),t&&y&&y.abort()}}}function tt(t,e){var n,i,a,l,f,h,p,v,g=e.element.title;return{c:function(){n=c("div"),i=c("i"),l=u("  \n            "),f=c("div"),h=u(g),i.className=a="fa "+z(e.element.type)+"  svelte-ftgu5o",f.className="svelte-ftgu5o",n.className="li chart svelte-ftgu5o"},m:function(t,e){r(t,n,e),o(n,i),o(n,l),o(n,f),o(f,h),v=!0},p:function(t,e){v&&!t.chartList||a===(a="fa "+z(e.element.type)+"  svelte-ftgu5o")||(i.className=a),v&&!t.chartList||g===(g=e.element.title)||d(h,g)},i:function(e,i){v||(t.root._intro&&(p&&p.invalidate(),t.root._aftercreate.push((function(){p||(p=m(t,n,P,{duration:200},!0)),p.run(1)}))),this.m(e,i))},o:function(e){v&&(p||(p=m(t,n,P,{duration:200},!1)),p.run(0,(function(){e(),p=null})),v=!1)},d:function(t){t&&(s(n),p&&p.abort())}}}function et(t,e){var n,i,a=O("folders / empty");return{c:function(){n=c("div"),i=u(a),n.className="empty svelte-ftgu5o"},m:function(t,e){r(t,n,e),o(n,i)},d:function(t){t&&s(n)}}}function nt(t){var i=this;!function(t,e){t._handlers=y(),t._slots=y(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}(this,t),this._state=e({x:0,y:0,chartId:null,position:{type:"root",id:null},folderName:"",loading:!0},t.data),this._recompute({position:1,folders:1},this._state),this._intro=!0,this._handlers.state=[J],J.call(this,{changed:n({},this._state),current:this._state}),this._fragment=D(this,this._state),this.root._oncreate.push((function(){B.call(i),i.fire("update",{changed:n({},i._state),current:i._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),N(this))}function it(t,n){this._handlers={},this._dependents=[],this._computed=y(),this._sortedComputedProperties=[],this._state=e({},t),this._differs=n&&n.immutable?k:b}return e(nt.prototype,I),e(nt.prototype,H),nt.prototype._recompute=function(t,e){t.position&&this._differs(e.isRoot,e.isRoot="root"===e.position.type)&&(t.isRoot=!0),(t.position||t.folders)&&(this._differs(e.folderList,e.folderList=function(t){var e=t.position,n=t.folders;return n&&n.length?"root"===e.type?n:S(n,e).folders:[]}(e))&&(t.folderList=!0),this._differs(e.chartList,e.chartList=function(t){var e=t.position,n=t.folders;return n&&n.length?"root"===e.type?[]:S(n,e).charts:[]}(e))&&(t.chartList=!0)),(t.folders||t.position)&&this._differs(e.openLink,e.openLink=function(t){var e=t.folders,n=t.position,i=S(e,n,"team");return"user"===n.type?"/mycharts":"team"===n.type?"/team/"+n.id:i?"/team/"+i.id+"/"+n.id:"/mycharts/"+n.id}(e))&&(t.openLink=!0)},e(it.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var i=t[n];e["$"+i]=this._state[i]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,n){var i=this,o=this._state;this._state=e(e({},o),t);for(var r=0;r<this._sortedComputedProperties.length;r+=1)this._sortedComputedProperties[r].update(this._state,n);this.fire("state",{changed:n,previous:o,current:this._state}),this._dependents.filter((function(t){for(var e={},o=!1,r=0;r<t.props.length;r+=1){var s=t.props[r];s in n&&(e["$"+s]=i._state[s],o=!0)}if(o)return t.component._stage(e),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:n,previous:o,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],i=y();function o(r){var s=e[r];s&&(s.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between "+e+" <-> "+r);o(e)})),i[r]||(i[r]=!0,n.push(s)))}for(var r in this._computed)o(t=r)},compute:function(t,n,i){var o,r=this,s={deps:n,update:function(e,s,a){var c=n.map((function(t){return t in s&&(a=!0),e[t]}));if(a){var u=i.apply(null,c);r._differs(u,o)&&(o=u,s[t]=!0,e[t]=o)}}};this._computed[t]=s,this._sortComputedProperties();var a=e({},this._state),c={};s.update(a,c,!0),this._set(a,c)},fire:w,get:x,on:L,set:function(t){var e=this._state,n=this._changed={},i=!1;for(var o in t){if(this._computed[o])throw new Error("'"+o+"' is a read-only computed property");this._differs(t[o],e[o])&&(n[o]=i=!0)}i&&this._set(t,n)}}),{App:nt,store:new it({})}}));
