{
  "version": 3,
  "file": "describe.css",
  "sources": [
    "../../../../src/describe/App.html",
    "../../../../src/describe/Handsontable.html"
  ],
  "sourcesContent": [
    "<div class=\"chart-editor\">\n    <div class=\"row\">\n        <div class=\"span4\">\n            <h3 class=\"first\">{{ \"Überprüfe dass die Daten richtig aussehen\" }}</h3>\n\n            <p>{{ \"Interpretiert Datawrapper deine Daten korrekt? In der nebenstehenden Tabelle sollten Zahlenspalten in blau, Datums-Spalten in grün und Textspalten in schwarz angezeigt werden.\" }}</p>\n\n            <Checkbox label=\"{{ \"Erste Zeile als Beschriftung\" }}\" bind:value=\"firstRowIsHeader\" />\n            <Checkbox label=\"transpose\" bind:value=\"transpose\" />\n        </div>\n        <div class=\"span8\">\n            <div class=\"input-append\">\n                <input type=\"text\" on:keypress=\"keyPress(event)\" placeholder=\"{{\"Search data table\"}}\" bind:value=\"search\" ref:search />\n                <div class=\"btn-group\">\n                  <button class=\"btn\" on:click=\"nextResult(-1)\">\n                    <i class=\"fa fa-chevron-up\"></i></button>\n                  <button class=\"btn\" on:click=\"nextResult(+1)\">\n                    <i class=\"fa fa-chevron-down\"></i></button>\n                </div>\n            </div>\n\n            <div class=\"results\">\n            {{#if searchResults.length > 0}}\n                {{searchIndexSafe+1}} of {{searchResults.length}} cells matching\n            {{elseif search}}\n                No matches found\n            {{/if}}\n            </div>\n\n            <Handsontable\n                bind:data=\"chartData\"\n                bind:transpose\n                bind:firstRowIsHeader\n                bind:search\n                bind:searchResults\n                bind:searchIndex />\n\n            <div class=\"buttons below-table pull-right\">\n                <button class=\"btn transpose\" on:click=\"toggleTranspose()\">{{\"Daten transponieren\"}}</button>\n                <button class=\"btn computed-columns\"><i class=\"fa fa-calculator\"></i> {{\"Spalte hinzufügen\"}}...</button>\n\n                <button class=\"btn disabled\" id=\"reset-data-changes\"><i class=\"fa fa-undo\"></i> {{\"Änderungen zurücksetzen\"}}...</button>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script>\n    import Handsontable from './Handsontable.html';\n    import Checkbox from '../controls/Checkbox.html';\n\n    export default {\n        components: { Handsontable, Checkbox },\n        computed: {\n            searchIndexSafe (searchIndex, searchResults) {\n                if (searchIndex<0) searchIndex+=searchResults.length;\n                searchIndex = searchIndex % searchResults.length;\n                return searchIndex;\n            }\n        },\n        oncreate() {\n            console.log('chart', this.store.get('dw_chart'));\n            window.addEventListener('keypress', (event) => {\n                console.log('event',event);\n                if (event.ctrlKey && event.key == 'f') {\n                    console.log('search!');\n                    event.preventDefault();\n                    if (this.refs.search != window.document.activeElement) {\n                        this.refs.search.focus();\n                    } else {\n                        this.nextResult(+1);\n                    }\n                }\n            });\n        },\n        methods: {\n            nextResult (diff) {\n                let {searchIndex, searchResults} = this.get();\n                searchIndex += diff;\n                if (searchIndex<0) searchIndex+=searchResults.length;\n                searchIndex = searchIndex % searchResults.length;\n                this.set({searchIndex});\n            },\n            keyPress (event) {\n                if (event.key == 'F3') this.nextResult(event.shiftKey ? -1 : 1);\n            },\n            toggleTranspose() {\n                this.set({transpose: !this.get('transpose')});\n            }\n        },\n        data() {\n            return {\n                search: '',\n                chartData: '',\n                transpose: false,\n                firstRowIsHeader: true,\n                searchIndex: 0,\n                searchResults: []\n            };\n        }\n    };\n</script>\n\n<style>.results {\n  color: gray;\n  display: inline-block;\n  vertical-align: text-bottom;\n  margin-left: 1ex;\n}\n.below-table {\n  margin-top: 20px;\n}\n</style>\n",
    "<div id=\"data-preview\" ref:hot />\n\n<script>\n    /* global dw,chart */\n    import HOT from 'Handsontable';\n\n    export default {\n        methods: {\n            update() {\n                const {data, transpose, firstRowIsHeader, skipRows, hot} = this.get();\n\n                if (!data) return;\n\n                // get chart\n                const chart = this.store.get('dw_chart');\n\n                // pass dataset through chart to apply changes and computed columns\n                const ds = chart.dataset(dw.datasource.delimited({\n                    csv: data,\n                    transpose,\n                    firstRowIsHeader,\n                    skipRows\n                }).parse()).dataset();\n\n                this.set({columnOrder: ds.columnOrder()});\n                console.log('col order 1', this.get('columnOrder'));\n\n                // construct HoT data array\n                const hot_data = [[]];\n                ds.eachColumn(c => hot_data[0].push(c.title()));\n                ds.eachRow(r => {\n                    const row = [];\n                    ds.eachColumn(col => row.push(col.val(r)));\n                    hot_data.push(row);\n                });\n\n                // pass data to hot\n                hot.loadData(hot_data);\n\n                hot.updateSettings({\n                    cells: (row, col) => {\n                        const {readonly} = this.get();\n                        return {\n                            readOnly: readonly || (ds.column(col).isComputed && row === 0),\n                            renderer: getCellRenderer(this, ds, HOT, {})\n                            // rowHeaders: _range(hot_data.length).map(r => 'R'+r)\n                        };\n                    },\n                    manualColumnMove: []\n                });\n                hot.render();\n            }\n        },\n        computed: {\n            currentResult (searchResults, searchIndex) {\n                if (!searchResults || !searchResults.length) return null;\n                const l = searchResults.length;\n                if (searchIndex < 0 || searchIndex >= l) {\n                    while (searchIndex<0) searchIndex += l;\n                    if (searchIndex > l) searchIndex %= l;\n                }\n                console.log(searchResults[searchIndex]);\n                return searchResults[searchIndex];\n            }\n        },\n        oncreate() {\n\n            const hot = new HOT(this.refs.hot, {\n                data: [],\n                rowHeaders: (i) => {\n                    const ti = hot.getPlugin('ColumnSorting').translateRow(i);\n                    return ti+1;\n                },\n                colHeaders: true,\n                fixedRowsTop: 1,\n                filters: true,\n                dropdownMenu: true,\n                startRows: 13,\n                startCols: 8,\n                fillHandle: false,\n                stretchH: 'all',\n                height: 400,\n                manualColumnMove: true,\n                selectionMode: 'range',\n                // comments: true,\n                // contextMenu: true,\n\n                // sorting\n                columnSorting: true,\n                sortIndicator: true,\n                sortFunction: function(sortOrder, columnMeta) {\n                    return function(a, b) {\n                        var plugin = hot.getPlugin('columnSorting');\n                        var sortFunction;\n\n                        if (a[0] === 0) return -1;\n\n                        switch (columnMeta.type) {\n                            case 'date':\n                                sortFunction = plugin.dateSort;\n                                break;\n                            case 'numeric':\n                                sortFunction = plugin.numericSort;\n                                break;\n                            default:\n                                sortFunction = plugin.defaultSort;\n                        }\n\n                        return sortFunction(sortOrder, columnMeta)(a, b);\n                    };\n                },\n\n                // search\n                search: 'search'\n            });\n\n            window.HT = hot;\n            console.log(hot, window.HT);\n            this.set({hot});\n\n            HOT.hooks.add('afterSetDataAtCell', (a,b,c,d) => {\n                console.log('afterSetDataAtCell', a,b,c,d);\n                // this.set({table});\n            });\n\n            HOT.hooks.add('afterColumnMove', (srcColumns, tgtIndex) => {\n                if (!srcColumns.length) return;\n                const {columnOrder} = this.get();\n                const newOrder = columnOrder.slice(0);\n                const after = columnOrder[tgtIndex];\n                const elements = newOrder.splice(srcColumns[0], srcColumns.length);\n                const insertAt = after ? newOrder.indexOf(after) : newOrder.length;\n                newOrder.splice(insertAt, 0, ...elements);\n                this.store.get('dw_chart').set('metadata.data.column-order', newOrder.slice(0));\n                this.set({columnOrder: newOrder});\n                // update selection\n                HOT.hooks.once('afterRender', () => {\n                    setTimeout(() => {\n                        hot.selectCell(0, insertAt, hot.countRows()-1, insertAt+elements.length-1);\n                    }, 10);\n                });\n                this.update();\n            });\n\n            this.observe('data', () => this.update());\n\n            this.observe('search', (query) => {\n                const searchResults = hot.search.query(query);\n                this.set({searchResults});\n                hot.render();\n            });\n\n            this.observe('currentResult', (res) => {\n                // console.log('cur search res', res);\n                if (!res || !hot) return;\n                // this is a weird hack to deal with HoT's problems to scroll\n                // all the way down after hot.scrollViewportTo(hot.countRows()-1, res.col);\n                // the first scrollViewportTo will trigger a render event\n                hot.render(); // to update the hightlight colors\n                hot.scrollViewportTo(res.row, res.col);\n                setTimeout(() => {\n                    // one more time\n                    hot.scrollViewportTo(res.row, res.col);\n                }, 100);\n            });\n\n        },\n        data() {\n            return {\n                data: '',\n                readonly: false,\n                skipRows: 0,\n                firstRowIsHeader: true,\n                searchIndex: 0,\n                transpose: false,\n                search: '',\n                searchResults: []\n            };\n        }\n    };\n\n    function getCellRenderer(app, dataset, Handsontable, metadata) {\n        const colTypeIcons = {\n            date: 'fa fa-clock-o'\n        };\n        function HtmlCellRender(instance, TD, row, col, prop, value, cellProperties) {\n            var escaped = dw.utils.purifyHtml(Handsontable.helper.stringify(value));\n            TD.innerHTML = escaped; // this is faster than innerHTML. See: https://github.com/warpech/jquery-handsontable/wiki/JavaScript-&-DOM-performance-tips\n        }\n        return function(instance, td, row, col, prop, value, cellProperties) {\n            const column = dataset.column(col);\n            const {searchResults, currentResult} = app.get();\n            if (row > 0) {\n                var formatter = chart.columnFormatter(column);\n                value = formatter(column.val(row - 1), true);\n            }\n            if (parseInt(value) < 0) { // if row contains negative number\n                td.classList.add('negative');\n            }\n            td.classList.add(column.type()+'Type');\n\n            if (row === 0) {\n                td.classList.add('firstRow');\n                if (colTypeIcons[column.type()]) {\n                    value = '<i class=\"'+colTypeIcons[column.type()]+'\"></i> ' + value;\n                }\n            } else {\n                td.classList.add(row % 2 ? 'oddRow' : 'evenRow');\n            }\n            // if (metadata.columnFormat.get(column.name()).ignore) {\n            //     td.classList.add('ignored');\n            // }\n            // if(selectedColumns.indexOf(col) > -1) {\n            //     td.classList.add('area'); //add blue area background if this cell is in selected column\n            // }\n            searchResults.forEach(res => {\n                if (res.row == row && res.col == col) {\n                    td.classList.add('htSearchResult');\n                }\n            });\n            if (currentResult && currentResult.row == row && currentResult.col == col) {\n                td.classList.add('htCurrentSearchResult');\n            }\n            if (row > 0 && !column.type(true).isValid(column.val(row-1))) {\n                td.classList.add('parsingError');\n            }\n            if (cellProperties.readOnly) td.classList.add('readOnly');\n\n            if (chart.dataCellChanged(col, row)) {\n                td.classList.add('changed');\n            }\n            Reflect.apply(HtmlCellRender, this, arguments);\n        };\n    }\n\n</script>\n\n<style>:global(#data-preview) {\n  width: 770px;\n  /*height: 400px;*/\n  overflow: auto;\n}\n:global(#data-preview) tr td,\n:global(#data-preview) tr th {\n  font-family: 'Roboto Mono', fixed;\n  font-size: 12px;\n}\n:global(#data-preview) tr td {\n  padding: 3px 6px;\n}\n:global(#data-preview) tr td.textType {\n  color: #000000;\n}\n:global(#data-preview) tr td.dateType {\n  color: #39A832;\n  text-align: center;\n}\n:global(#data-preview) tr td.numberType {\n  color: #297EA8;\n  text-align: right;\n}\n:global(#data-preview) tr td.parsingError {\n  background: #fee;\n  color: #c00;\n}\n:global(#data-preview) tr td.readOnly.firstRow {\n  background: #EAEAEA;\n  border-right-color: #aaa;\n  color: #777;\n}\n:global(#data-preview) tr td.changed {\n  position: relative;\n}\n:global(#data-preview) tr td.changed:after {\n  content: ' ';\n  width: 0;\n  height: 0;\n  border-top: 7px solid orange;\n  border-right: 7px solid transparent;\n  display: block;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n:global(#data-preview) tr td.htSearchResult {\n  background: #ffd;\n}\n:global(#data-preview) tr td.htCurrentSearchResult {\n  background: #fffe83;\n}\n:global(#data-preview) tbody tr:first-child td {\n  background: #f3f3f3;\n  font-weight: bold;\n  border-bottom: 1px solid #999;\n}\n:global(#data-preview) .htCommentCell:after {\n  border-left: 8px solid transparent;\n  border-top: 8px solid orange;\n}\n</style>\n"
  ],
  "names": [],
  "mappings": "AAuGO,QAAQ,kBAAC,CAAC,AACf,KAAK,CAAE,IAAI,CACX,OAAO,CAAE,YAAY,CACrB,cAAc,CAAE,WAAW,CAC3B,WAAW,CAAE,GAAG,AAClB,CAAC,AACD,YAAY,kBAAC,CAAC,AACZ,UAAU,CAAE,IAAI,AAClB,CAAC;AC8Hc,aAAa,AAAE,CAAC,AAC7B,KAAK,CAAE,KAAK,CAEZ,QAAQ,CAAE,IAAI,AAChB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,CACpB,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,AAAC,CAAC,AAC5B,WAAW,CAAE,aAAa,CAAC,CAAC,KAAK,CACjC,SAAS,CAAE,IAAI,AACjB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,AAAC,CAAC,AAC5B,OAAO,CAAE,GAAG,CAAC,GAAG,AAClB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,SAAS,AAAC,CAAC,AACrC,KAAK,CAAE,OAAO,AAChB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,SAAS,AAAC,CAAC,AACrC,KAAK,CAAE,OAAO,CACd,UAAU,CAAE,MAAM,AACpB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,WAAW,AAAC,CAAC,AACvC,KAAK,CAAE,OAAO,CACd,UAAU,CAAE,KAAK,AACnB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,aAAa,AAAC,CAAC,AACzC,UAAU,CAAE,IAAI,CAChB,KAAK,CAAE,IAAI,AACb,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,SAAS,SAAS,AAAC,CAAC,AAC9C,UAAU,CAAE,OAAO,CACnB,kBAAkB,CAAE,IAAI,CACxB,KAAK,CAAE,IAAI,AACb,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,AAAC,CAAC,AACpC,QAAQ,CAAE,QAAQ,AACpB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,QAAQ,MAAM,AAAC,CAAC,AAC1C,OAAO,CAAE,GAAG,CACZ,KAAK,CAAE,CAAC,CACR,MAAM,CAAE,CAAC,CACT,UAAU,CAAE,GAAG,CAAC,KAAK,CAAC,MAAM,CAC5B,YAAY,CAAE,GAAG,CAAC,KAAK,CAAC,WAAW,CACnC,OAAO,CAAE,KAAK,CACd,QAAQ,CAAE,QAAQ,CAClB,IAAI,CAAE,CAAC,CACP,GAAG,CAAE,CAAC,AACR,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,eAAe,AAAC,CAAC,AAC3C,UAAU,CAAE,IAAI,AAClB,CAAC,AACO,aAAa,AAAC,CAAC,EAAE,CAAC,EAAE,sBAAsB,AAAC,CAAC,AAClD,UAAU,CAAE,OAAO,AACrB,CAAC,AACO,aAAa,AAAC,CAAC,KAAK,CAAC,EAAE,YAAY,CAAC,EAAE,AAAC,CAAC,AAC9C,UAAU,CAAE,OAAO,CACnB,WAAW,CAAE,IAAI,CACjB,aAAa,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,AAC/B,CAAC,AACO,aAAa,AAAC,CAAC,cAAc,MAAM,AAAC,CAAC,AAC3C,WAAW,CAAE,GAAG,CAAC,KAAK,CAAC,WAAW,CAClC,UAAU,CAAE,GAAG,CAAC,KAAK,CAAC,MAAM,AAC9B,CAAC"
}