<div class="create-nav">
    {#each steps as step,i}
    <EditorNavStep on:select="select(step, i)"
        index="{i+1}" bind:step bind:steps bind:active />
    {/each}
</div>

{#if $user.id != $authorId && $user.isAdmin}
<div class="alert alert-warning" style="text-align:center;margin-top:10px;">
 This chart belongs to <a target="_blank" href="/admin/chart/by/{$authorId}">{$author.name || $author.email || `User ID ${$authorId}`}</a>. Great power comes with great responsibility, so be careful with what you're doing!
</div>
{/if}

<style type="text/css">
    .create-nav {
        display: flex;
        justify-content: space-between;
    }
</style>
<script>

    import EditorNavStep from './EditorNavStep.html';
    import _findWhere from 'underscore-es/findWhere';

    export default {
        components: { EditorNavStep },
        methods: {
            select(step, index) {
                this.set({active: step.id});
                const {lastEditStep} = this.store.get();
                this.store.set({lastEditStep: Math.max(lastEditStep, index+1)})
            }
        },
        oncreate() {
            const {active, steps} = this.get();
            const {lastEditStep} = this.store.get();
            const step = _findWhere(steps, {id:active});
            this.store.set({lastEditStep: Math.max(lastEditStep, steps.indexOf(step)+1)});
        },
        data() {
            return {
                steps: []
            };
        }
    }
</script>
