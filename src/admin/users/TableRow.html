<tr class="user role-{user.role}">
    <td class="id out">
        <a href="?currentUser={user.id}" on:click="navigate(event, user.id)">
            {user.id}
        </a>
    </td>
    {#if !edit}
    <td class="name out">{user.name || ''}</td>
    <td class="email out">{user.email}</td>
    <td>
        <i class="icon-{status.icon}" title="Editor"></i>
        {__(status.name, 'admin-users')}
    </td>
    <td class="creation out">{user.createdAt}</td>
    <td class="center">
        <a href="/admin/chart/by/{user.id}">{user.chartCount}</a>
    </td>
    <td class="actions">
        <button class="action" on:click="set({ edit: true })" data-test="action-edit">
            <i class="icon-pencil" title="{__('edit', 'admin-users')}"></i>
        </button>
        <button class="action">
            <i class="icon-envelope" title="{__('reset the password and send a mail', 'admin-users')}"></i>
        </button>
    </td>
    {:else}
    <td>
        <input type="text" bind:value="user.name" data-test="input-name" />
    </td>
    <td class="email">
        <input type="email" bind:value="user.email" data-test="input-email" />
    </td>
    <td>
        <select name="status">
            {#each statusOptions as status}
            <option value="{status.slug}" selected="{isCurrentStatus(status.slug)}">
                {__(status.name, 'admin-users')}
            </option>
            {/each}
        </select>
    </td>
    <td class="creation out">2019-01-31 11:46:25</td>
    <td class="center">
        <a href="/admin/chart/by/{user.id}">{user.chartCount}</a>
    </td>
    <td class="actions">
        <button class="action" on:click="save()" data-test="action-save">
            <i class="icon-ok" title="{__('save', 'admin-users')}"></i>
        </button>
        <button class="action" on:click="set({ edit: false })" data-test="action-close">
            <i class="icon-remove" title="{__('cancel', 'admin-users')}"></i>
        </button>
    </td>
    {/if}
</tr>

<style>
    input,
    select {
        max-width: 150px;
    }

    .actions {
        white-space: nowrap;
        width: 30px;
    }

    .action {
        border: 0;
        margin: 0 20px 0 0;
        padding: 0;
        background: transparent;
        display: inline;
    }

    .role-0 {
        color: #c00;
    }
</style>

<script>
    import { __ } from '../../shared/l10n';

    export default {
        data() {
            return {
                user: {},
                edit: false,

                // TODO: status options should probably be dynamic â€“ how to load them?
                statusOptions: [
                    { slug: 0, name: 'Administrator', icon: 'fire' },
                    { slug: 1, name: 'Graphic Editor', icon: 'user' },
                    { slug: 2, name: 'Pending', icon: 'user' },
                    { slug: 3, name: 'Pending', icon: 'user' },
                    { slug: 5, name: 'Editor', icon: 'user' }
                ]
            };
        },

        computed: {
            isCurrentStatus: ({ user }) => status => user.role === status,
            status: ({ user, statusOptions }) => statusOptions.find(({ slug }) => slug === user.role)
        },

        helpers: {
            __
        },

        methods: {
            save() {
                this.set({ edit: false });
                const {
                    user: { id, name, email, role }
                } = this.get();
                this.fire('save', { id, name, email, role });
            },

            navigate(event, userId) {
                event.preventDefault();
                this.fire('navigate', userId);
            }
        }
    };
</script>
