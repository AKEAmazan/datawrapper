<div class="row dw-create-visualize chart-editor" style="margin-top: -20px">
    <div class="visconfig">
        <div class="span12 vis-options">
            <h1>{ @html __('team-create / h1') }</h1>

            <p>
                { @html __('team-create / p') }
            </p>

            <Text
                placeholder="{ __('team-create / untitled') }"
                label="{ __('team-create / name') }"
                help="{ __('team-create / help') }"
                bind:value="name"
            />

            <button on:click="create()" class="btn btn-primary" disabled="{ name.length == 0 }">
                <i class="fa { loading ? 'fa-spin fa-circle-o-notch' : 'fa-plus' }"></i>&nbsp; { __('team-create / button') }
            </button>
        </div>
    </div>
</div>

<script>
    /* globals dw */
    import { Text } from '@datawrapper/controls';
    import { postJSON } from '@datawrapper/shared/fetch';
    import { __ } from '@datawrapper/shared/l10n';

    export default {
        components: { Text },
        data() {
            return {
                name: ''
            };
        },
        helpers: { __ },
        methods: {
            create() {
                const { name, loading } = this.get();
                if (loading) return;

                this.set({ loading: true });

                postJSON(`${window.location.protocol}//${dw.backend.__api_domain}/v3/teams`, JSON.stringify({ name }), function(res) {
                    window.location = `/team/${res.id}/settings`;
                });
            }
        }
    };
</script>
