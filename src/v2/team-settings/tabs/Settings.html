<p style="margin-bottom: 10px">
    {@html __('teams / defaults / p') }
</p>

<div class="row">
    <div class="span5">
        <FormBlock label="{__('teams / name' )}" help="{__('teams / name / help' )}">
            <input type="text" bind:value="team.name" placeholder="" />
        </FormBlock>

        <FormBlock label="{ __('teams / defaults / theme' ) }" help="{ __('teams / defaults / theme / p' ) }">
            <!-- prettier-ignore -->
            <BaseSelect
                bind:value="defaultTheme"
                labelWidth="100px"
                options="{themes}"
            />
        </FormBlock>

        <FormBlock label="{ __('teams / defaults / folder' ) }" help="{ __('teams / defaults / folder / p' ) }">
            <!-- prettier-ignore -->
            <BaseSelect
                bind:value="settings.default.folder"
                labelWidth="100px"
                options="{folders}"
            />
        </FormBlock>

        <FormBlock label="{ __('teams / defaults / folder-status' ) }" help="{ __('teams / defaults / folder-status / p' ) }">
            <!-- prettier-ignore -->
            <BaseSelect
                bind:value="settings.folders"
                options="{[ {label: __('teams / defaults / expanded' ), value: 'expanded'}, {label: __('teams / defaults / collapsed' ), value: 'collapsed'}] }"
            />
        </FormBlock>

        <FormBlock label="{ __('teams / defaults / locale' ) }" help="{ __('teams / defaults / locale / p' ) }">
            <!-- prettier-ignore -->
            <BaseSelect
                bind:value="settings.default.locale"
                options="{localeOptions}"
            />
        </FormBlock>

        <FormBlock label="{ __('teams / defaults / embedcode' ) }" help="{ __('teams / defaults / embedcode / p' ) }">
            <!-- prettier-ignore -->
            <BaseSelect
                bind:value="settings.embed.preferred_embed"
                options="{embedCodes}"
            />
        </FormBlock>

        {#if settings.embed.preferred_embed == "custom"}
        <div>
            <input
                type="text"
                label="{ __('teams / custom / title' ) }"
                bind:value="settings.embed.custom_embed.title"
                placeholder="e.g. Custom CMS Embed"
            />

            <!-- prettier-ignore -->
            <TextArea
                label="{ __('teams / custom / help' ) }"
                bind:value="settings.embed.custom_embed.text"
                placeholder="e.g. This is a custom embed code for our CMS"
            />

            <!-- prettier-ignore -->
            <TextArea
                label="{ __('teams / custom / embedcode' ) }"
                bind:value="settings.embed.custom_embed.template"
                placeholder=""
                help="{ __('teams / custom / embedcode / help' ) }"
            />
        </div>
        {/if}

        <Switch label="{ __('teams / restrict-themes' ) }" bind:value="settings.restrictDefaultThemes" />
    </div>
</div>
<script>
    import FormBlock from '../../shared/FormBlock.html';
    import TextArea from '@datawrapper/controls/TextArea.html';
    import BaseSelect from '@datawrapper/controls/BaseSelect.html';
    import Switch from '@datawrapper/controls/Switch.html';
    import { __ } from '@datawrapper/shared/l10n';
    import storeTeamSettings from '../storeTeamSettings';

    export default {
        components: { TextArea, BaseSelect, Switch, FormBlock },
        data() {
            return {
                embedCodes: [
                    { value: 'responsive', label: __('teams / defaults / responsive-iframe') },
                    { value: 'iframe', label: __('teams / defaults / iframe') },
                    { value: 'custom', label: __('teams / defaults / custom') }
                ],
                themes: [],
                folders: [],
                locales: [],
                defaultTheme: '',
                settings: {},
                team: {}
            };
        },
        computed: {
            localeOptions({ locales }) {
                return [
                    {
                        value: null,
                        label: __('teams / defaults / none', 'organizations')
                    },
                    ...locales
                ];
            }
        },
        helpers: { __ },
        onstate({ changed, current }) {
            if (current.settings && (changed.settings || changed.team || changed.defaultTheme)) {
                storeTeamSettings(current.team, current.settings, current.defaultTheme).then(() => {
                    this.fire('change', {
                        team: current.team,
                        settings: current.settings
                    });
                });
            }
        }
    };
</script>
