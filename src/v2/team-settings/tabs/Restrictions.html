<div class="row">
    <div class="span7">
        <h3>{__('teams / disable / h2 / themes')}</h3>

        <p style="margin-bottom: 10px">
            {@html __('teams / disable / themes / p') }
        </p>

        <Switch label="{ __('teams / restrict-themes' ) }" bind:value="settings.restrictDefaultThemes" />
        <br />
        <h3>{__('teams / disable / h2 / vis')}</h3>

        <p style="margin-bottom: 10px">
            {@html __('teams / disable / p') }
        </p>

        <Switch label="{__('teams / disable / h2 / vis')}" bind:value="settings.disableVisualizations.enabled">
            <p style="margin-top: 10px">
                { @html __('teams / disable / p2' ) }
            </p>

            <div class="namespace">{ @html __('teams / disable / charts' ) }</div>

            <div style="columns: auto 3;">
                {#each charts as vis}
                <Checkbox label="{vis.title}" bind:value="settings.disableVisualizations.visualizations[vis.id]" />
                {/each}
            </div>

            <div class="namespace">{ @html __('teams / disable / maps' ) }</div>

            <div style="columns: auto 3;">
                {#each maps as vis}
                <Checkbox label="{vis.title}" bind:value="settings.disableVisualizations.visualizations[vis.id]" />
                {/each}
            </div>

            <div class="namespace">{ @html __('teams / disable / archived' ) }</div>

            <div style="columns: auto 3;">
                {#each archived as vis}
                <Checkbox label="{vis.title}" bind:value="settings.disableVisualizations.visualizations[vis.id]" />
                {/each}
            </div>

            <div style="margin-top: 10px;">
                <Switch label="{ __('teams / disable / enable-admins' ) }" bind:value="settings.disableVisualizations.allowAdmins" />
            </div>
        </Switch>
    </div>
</div>
<style>
    .namespace {
        font-weight: bold;
        margin: 16px 0px 8px 0px;
    }
</style>

<script>
    import { Switch, Checkbox } from '@datawrapper/controls';
    import { __ } from '@datawrapper/shared/l10n';
    import storeTeamSettings from '../storeTeamSettings';

    export default {
        components: { Switch, Checkbox },
        data() {
            return {
                visualizations: [],
                visualizationArchive: []
            };
        },
        computed: {
            charts({ visualizations, visualizationArchive }) {
                return visualizations.filter(
                    el => el.title && el['svelte-workflow'] === 'chart' && el.namespace !== 'map' && visualizationArchive.indexOf(el.id) === -1
                );
            },
            maps({ visualizations, visualizationArchive }) {
                return visualizations.filter(
                    el => el.title && (el.namespace === 'map' || el.id === 'locator-map') && visualizationArchive.indexOf(el.id) === -1
                );
            },
            archived({ visualizations, visualizationArchive }) {
                return visualizations.filter(el => el.title && visualizationArchive.indexOf(el.id) > -1);
            }
        },
        helpers: { __ },
        oncreate() {
            const { charts, maps, archived, settings } = this.get();
            if (Array.isArray(settings.disableVisualizations.visualizations)) {
                // initialize visualizations
                settings.disableVisualizations.visualizations = {};
            }
            [...charts, ...maps, ...archived].forEach(({ id }) => {
                if (settings.disableVisualizations.visualizations[id] === undefined) {
                    settings.disableVisualizations.visualizations[id] = false;
                }
            });
            this.set({ settings });
        },
        onstate({ changed, current }) {
            if (current.settings && changed.settings) {
                storeTeamSettings(current.team, current.settings, current.defaultTheme).then(() => {
                    this.fire('change', {
                        team: current.team,
                        settings: current.settings
                    });
                });
            }
        }
    };
</script>
