<:Window on:click='windowClick(event)'/>

<div class="control-group vis-option-type-select">
    <label class="control-label">
        {@html label }
    </label>

    <div class="controls form-inline {disabled? 'disabled' :''}">
        <div class="btn-group">
            <button ref:button on:click="toggle(event)" class="btn dropdown-toggle">
                {@html currentLabel}
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" style="display:{visible?'block':'none'};">
                {#if options.length}
                    {#each options as opt}
                        <li class="{value==opt.value?'selected':''}">
                            <a on:click="select(event, opt)" href="#/{opt.value}">{@html opt.label}</a>
                        </li>
                    {/each}
                {/if}
            </ul>
        </div>
    </div>
</div>

<style type="text/css">
    li.selected {
        background: #18a1cd33;
    }
    .dropdown-toggle {
        background: white;
    }
    span.caret {
        margin-left: 5px;
    }
    button * {
        pointer-events: none;
    }
</style>

<script type="text/javascript">
export default {
    computed: {
        currentLabel({ value, options }) {
            for (let i=0; i<options.length; i++) {
                if (options[i].value == value) return options[i].label;
            }
            return '(select an item)';
        }
    },
    methods: {
        toggle() {
            const {visible} = this.get();
            this.set({visible: !visible});
        },
        select(event, opt) {
            event.preventDefault();
            this.set({ value: opt.value });
            this.fire('change', opt.value);
        },
        windowClick(event) {
            if (!this.refs) return;
            if (event.target == this.refs.button) return;
            this.set({visible:false});
        }
    },
    data () {
        return {
            disabled: false,
            visible: false,
            width: 'auto',
            options: [],
            optgroups: [],
        };
    }
};
</script>

